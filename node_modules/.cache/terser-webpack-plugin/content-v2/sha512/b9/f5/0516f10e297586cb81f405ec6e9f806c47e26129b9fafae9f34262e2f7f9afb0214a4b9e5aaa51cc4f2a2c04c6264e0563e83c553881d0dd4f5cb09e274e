{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{221:function(s,t){s.exports=\"data:image/png;base64,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\"},222:function(s,t,a){s.exports=a.p+\"assets/img/k8s_scheduler.45cf5f02.png\"},223:function(s,t,a){s.exports=a.p+\"assets/img/k8s_fix.a11b20e0.png\"},224:function(s,t,a){s.exports=a.p+\"assets/img/k8s_expend.7ec5e67e.png\"},225:function(s,t,a){s.exports=a.p+\"assets/img/k8s_schdule.a9aa07e6.png\"},226:function(s,t,a){s.exports=a.p+\"assets/img/k8s_master.f890248c.png\"},227:function(s,t,a){s.exports=a.p+\"assets/img/k8s_node.c47d8adf.png\"},228:function(s,t,a){s.exports=a.p+\"assets/img/harbor.d0279e60.png\"},229:function(s,t,a){s.exports=a.p+\"assets/img/harbor_admin.1639de8c.png\"},230:function(s,t,a){s.exports=a.p+\"assets/img/harbor_public.15703d1a.png\"},231:function(s,t,a){s.exports=a.p+\"assets/img/harbor_public_list.5dbf2b26.png\"},232:function(s,t,a){s.exports=a.p+\"assets/img/harbor_push.c26f187c.png\"},319:function(s,t,a){\"use strict\";a.r(t);var e=a(28),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":s.$parent.slotKey}},[e(\"h1\",{attrs:{id:\"kubernetes\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#kubernetes\"}},[s._v(\"#\")]),s._v(\" Kubernetes\")]),s._v(\" \"),e(\"h2\",{attrs:{id:\"第-1-章-kubernetes-概述\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#第-1-章-kubernetes-概述\"}},[s._v(\"#\")]),s._v(\" 第 1 章 Kubernetes 概述\")]),s._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:a(221),alt:\"\"}})]),s._v(\" \"),e(\"ul\",[e(\"li\",[e(\"p\",[s._v(\"官网：https://kubernetes.io\")])]),s._v(\" \"),e(\"li\",[e(\"p\",[s._v(\"Github：https://github.com/kubernetes/kubernetes\")])]),s._v(\" \"),e(\"li\",[e(\"p\",[s._v(\"由来：谷歌的Borg系统, 后经Go语言重写并捐献给CNCF基金会开源\")])]),s._v(\" \"),e(\"li\",[e(\"p\",[s._v(\"含义：词根源于希腊语：舵手/飞行员，K8S -》K 8个字母 S\")])]),s._v(\" \"),e(\"li\",[e(\"p\",[s._v(\"重要作用：开源的容器编排框架工具（生态极其丰富）\")])]),s._v(\" \"),e(\"li\",[e(\"p\",[s._v(\"学习意义：解决跑裸docker 的若干痛点\")]),s._v(\" \"),e(\"blockquote\",[e(\"p\",[s._v(\"使用Docker容器话封装应用程序的缺点：\")]),s._v(\" \"),e(\"ul\",[e(\"li\",[s._v(\"单击使用, 无法有效集群\")]),s._v(\" \"),e(\"li\",[s._v(\"随着容器数量的上升, 管理成本攀升\")]),s._v(\" \"),e(\"li\",[s._v(\"没有有效的容灾/自愈机制\")]),s._v(\" \"),e(\"li\",[s._v(\"没有预设编排模板, 无法实现快速、大规模容器调度\")]),s._v(\" \"),e(\"li\",[s._v(\"没有统一的配置管理中心工具\")]),s._v(\" \"),e(\"li\",[s._v(\"没有容器生命周期管理工具\")]),s._v(\" \"),e(\"li\",[s._v(\"没有图形化运维管理工具\")]),s._v(\" \"),e(\"li\",[s._v(\"...\")])])])])]),s._v(\" \"),e(\"h2\",{attrs:{id:\"第-2-章-kubernetes-优势\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#第-2-章-kubernetes-优势\"}},[s._v(\"#\")]),s._v(\" 第 2 章 Kubernetes 优势\")]),s._v(\" \"),e(\"ul\",[e(\"li\",[s._v(\"自动装箱, 水平扩展, 自我修复\")]),s._v(\" \"),e(\"li\",[s._v(\"服务发现和负载均衡\")]),s._v(\" \"),e(\"li\",[s._v(\"自动发布（默认滚动发布模式）和回滚\")]),s._v(\" \"),e(\"li\",[s._v(\"集中化配置管理和秘钥管理\")]),s._v(\" \"),e(\"li\",[s._v(\"存储编排\")]),s._v(\" \"),e(\"li\",[s._v(\"任务批处理运行\")]),s._v(\" \"),e(\"li\",[s._v(\"...\")])]),s._v(\" \"),e(\"h2\",{attrs:{id:\"第-3-章-kubernetes-快速入门\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#第-3-章-kubernetes-快速入门\"}},[s._v(\"#\")]),s._v(\" 第 3 章 Kubernetes 快速入门\")]),s._v(\" \"),e(\"h3\",{attrs:{id:\"_3-1-四组基本概念\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-1-四组基本概念\"}},[s._v(\"#\")]),s._v(\" 3.1 四组基本概念\")]),s._v(\" \"),e(\"ul\",[e(\"li\",[e(\"p\",[s._v(\"Pod/Pod控制器\")])]),s._v(\" \"),e(\"li\",[e(\"p\",[s._v(\"Name/Namespace\")])]),s._v(\" \"),e(\"li\",[e(\"p\",[s._v(\"Label/Label选择器\")])]),s._v(\" \"),e(\"li\",[e(\"p\",[s._v(\"Service/Ingress\")])])]),s._v(\" \"),e(\"h4\",{attrs:{id:\"_3-1-1-pod-pod控制器\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-1-1-pod-pod控制器\"}},[s._v(\"#\")]),s._v(\" 3.1.1 Pod/Pod控制器\")]),s._v(\" \"),e(\"ul\",[e(\"li\",[e(\"p\",[e(\"strong\",[s._v(\"Pod\")])]),s._v(\" \"),e(\"ul\",[e(\"li\",[e(\"p\",[s._v(\"Pod是K8S里能够被运行的最小的逻辑单元（原子单元）；\")])]),s._v(\" \"),e(\"li\",[e(\"p\",[s._v(\"1个Pod里面可以运行多个容器, 它们共享UTS+NET+IPC名字空间；\")])]),s._v(\" \"),e(\"li\",[e(\"p\",[s._v(\"可以把Pod理解成豌豆荚, 而同一个Pod内的每个容器是一颗颗豌豆；\")])]),s._v(\" \"),e(\"li\",[e(\"p\",[s._v(\"一个Pod里运行多个容器, 又叫：边车（SideCar）模式。\")])])])]),s._v(\" \"),e(\"li\",[e(\"p\",[e(\"strong\",[s._v(\"Pod控制器\")])]),s._v(\" \"),e(\"ul\",[e(\"li\",[e(\"p\",[s._v(\"Pod控制器是Pod启动的一种模板, 用来保证在 K8S 里启动的 Pod 应始终按照人们的预期运行 (副本数、生命周期、健康状态检查...)。\")])]),s._v(\" \"),e(\"li\",[e(\"p\",[s._v(\"K8S 内提供了众多的 Pod 控制器，常用的有以下几种：\")]),s._v(\" \"),e(\"ul\",[e(\"li\",[s._v(\"Deployment\")]),s._v(\" \"),e(\"li\",[s._v(\"DaemonSet\")]),s._v(\" \"),e(\"li\",[s._v(\"ReplicaSet\")]),s._v(\" \"),e(\"li\",[s._v(\"StatefulSet\")]),s._v(\" \"),e(\"li\",[s._v(\"Job\")]),s._v(\" \"),e(\"li\",[s._v(\"Cronjob\")])])])])])]),s._v(\" \"),e(\"h4\",{attrs:{id:\"_3-1-2-name-namespace\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-1-2-name-namespace\"}},[s._v(\"#\")]),s._v(\" 3.1.2 Name/Namespace\")]),s._v(\" \"),e(\"ul\",[e(\"li\",[e(\"strong\",[s._v(\"Name\")]),s._v(\" \"),e(\"ul\",[e(\"li\",[s._v(\"由于 K8S 内部, 使用“资源”来定义每一种逻辑概念（功能）故每种“资源”, 都应该有自己的“名称”。\")]),s._v(\" \"),e(\"li\",[s._v(\"“资源”有 api 版本（apiVersion）类别（kind）、元数据（metadata）、定义清单（spec）、状态（status）等配置信息。\")]),s._v(\" \"),e(\"li\",[s._v(\"“名称”通常定义在“资源”的“元数据“信息里。\")])])]),s._v(\" \"),e(\"li\",[e(\"strong\",[s._v(\"Namespace\")]),s._v(\" \"),e(\"ul\",[e(\"li\",[s._v(\"随着项目增多、人员增加、集群规模的扩大, 需要一种能够隔离 K8S 内各种“资源”的方法, 这就是名称空间。\")]),s._v(\" \"),e(\"li\",[s._v(\"名称空间可以理解为 K8S 内部的虚拟集群组。\")]),s._v(\" \"),e(\"li\",[s._v(\"不同名称空间内的“资源”, 名称可以相同, 相同名称空间内的同种“资源”, “名称” 不能相同。\")]),s._v(\" \"),e(\"li\",[s._v(\"合理的使用 K8S 的名称空间使得集群管理员能够更好的对交付到 K8S 里的服务器进行分类管理和浏览。\")]),s._v(\" \"),e(\"li\",[s._v(\"K8S里默认存在的名称空间有：default、kube-system、kube-public。\")]),s._v(\" \"),e(\"li\",[s._v(\"查询 K8S 里特定“资源”要带上相应的名称空间。\")])])])]),s._v(\" \"),e(\"h4\",{attrs:{id:\"_3-1-3-label-label选择器\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-1-3-label-label选择器\"}},[s._v(\"#\")]),s._v(\" 3.1.3 Label/Label选择器\")]),s._v(\" \"),e(\"ul\",[e(\"li\",[e(\"strong\",[s._v(\"Label\")]),s._v(\" \"),e(\"ul\",[e(\"li\",[s._v(\"标签是 K8S 特色的管理方式, 便于分类管理资源对象。\")]),s._v(\" \"),e(\"li\",[s._v(\"一个标签可以对应多个资源, 一个资源也可以有多个标签, 它们是多对多的关系。\")]),s._v(\" \"),e(\"li\",[s._v(\"一个资源拥有多个标签, 可以实现不同维度的管理。\")]),s._v(\" \"),e(\"li\",[s._v(\"标签的组成: key=value。\")]),s._v(\" \"),e(\"li\",[s._v(\"与标签类似的还有一种“注释”（annotations）。\")])])]),s._v(\" \"),e(\"li\",[e(\"strong\",[s._v(\"Label 选择器\")]),s._v(\" \"),e(\"ul\",[e(\"li\",[s._v(\"给资源打上标签后, 可以使用标签选择器过滤指定的标签。\")]),s._v(\" \"),e(\"li\",[s._v(\"标签选择器目前有两个：基于等值关系（等于、不等于）和基于集合关系（属于、不属于、存在）。\")]),s._v(\" \"),e(\"li\",[s._v(\"许多资源支持内嵌标签选择器字段\\n\"),e(\"ul\",[e(\"li\",[s._v(\"matchLabels\")]),s._v(\" \"),e(\"li\",[s._v(\"matchExpressions\")])])])])])]),s._v(\" \"),e(\"h4\",{attrs:{id:\"_3-1-4-service-ingress\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-1-4-service-ingress\"}},[s._v(\"#\")]),s._v(\" 3.1.4 Service/Ingress\")]),s._v(\" \"),e(\"ul\",[e(\"li\",[e(\"strong\",[s._v(\"Service\")]),s._v(\" \"),e(\"ul\",[e(\"li\",[s._v(\"在 K8S 的世界里, 虽然没个 Pod 都会被分配一个单独的 IP 地址, 但这个 IP 地址会随着 Pod 的销毁而消失。\")]),s._v(\" \"),e(\"li\",[s._v(\"Service（服务）就是用来解决这个问题的核心概念。\")]),s._v(\" \"),e(\"li\",[s._v(\"一个 Service 可以看作一组提供相同服务的 Pod 的对外访问接口。\")]),s._v(\" \"),e(\"li\",[s._v(\"Service 作用于哪些 Pod 是通过标签选择器来定义的。\")])])]),s._v(\" \"),e(\"li\",[e(\"strong\",[s._v(\"Ingress\")]),s._v(\" \"),e(\"ul\",[e(\"li\",[s._v(\"Ingress 是 K8S 集群里工作在 OSI 网络参考模型下, 第 7 层的应用, 对外暴露的接口。\")]),s._v(\" \"),e(\"li\",[s._v(\"Service 只能进行 L4 浏览调度, 表现形式是 ip+port。\")]),s._v(\" \"),e(\"li\",[s._v(\"Ingress 则可以调度不同的业务域、不同 URL 访问路径的业务流量。\")])])])]),s._v(\" \"),e(\"h2\",{attrs:{id:\"第-4-章-kubernetes-核心功能\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#第-4-章-kubernetes-核心功能\"}},[s._v(\"#\")]),s._v(\" 第 4 章 Kubernetes 核心功能\")]),s._v(\" \"),e(\"h3\",{attrs:{id:\"_4-1-调度\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_4-1-调度\"}},[s._v(\"#\")]),s._v(\" 4.1 调度\")]),s._v(\" \"),e(\"p\",[s._v(\"Kubernetes 可以把用户提交的容器放到 Kubernetes 管理的集群的某一台节点上去。Kubernetes 的调度器是执行这项能力的组件，它会观察正在被调度的这个容器的大小、规格。\")]),s._v(\" \"),e(\"p\",[s._v(\"比如说它所需要的 CPU 以及它所需要的 memory，然后在集群中找一台相对比较空闲的机器来进行一次 placement，也就是一次放置的操作。在这个例子中，它可能会把红颜色的这个容器放置到第二个空闲的机器上，来完成一次调度的工作。\")]),s._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:a(222),alt:\"\"}})]),s._v(\" \"),e(\"h3\",{attrs:{id:\"_4-2-自动修复\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_4-2-自动修复\"}},[s._v(\"#\")]),s._v(\" 4.2 自动修复\")]),s._v(\" \"),e(\"p\",[s._v(\"Kubernetes 有一个节点健康检查的功能，它会监测这个集群中所有的宿主机，当宿主机本身出现故障，或者软件出现故障的时候，这个节点健康检查会自动对它进行发现。\")]),s._v(\" \"),e(\"p\",[s._v(\"下面 Kubernetes 会把运行在这些失败节点上的容器进行自动迁移，迁移到一个正在健康运行的宿主机上，来完成集群内容器的一个自动恢复。\")]),s._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:a(223),alt:\"\"}})]),s._v(\" \"),e(\"h3\",{attrs:{id:\"_4-3-水平伸缩\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_4-3-水平伸缩\"}},[s._v(\"#\")]),s._v(\" 4.3 水平伸缩\")]),s._v(\" \"),e(\"p\",[s._v(\"Kubernetes 有业务负载检查的能力，它会监测业务上所承担的负载，如果这个业务本身的 CPU 利用率过高，或者响应时间过长，它可以对这个业务进行一次扩容。\")]),s._v(\" \"),e(\"p\",[s._v(\"比如说在下面的例子中，黄颜色的过度忙碌，Kubernetes 就可以把黄颜色负载从一份变为三份。接下来，它就可以通过负载均衡把原来打到第一个黄颜色上的负载平均分到三个黄颜色的负载上去，以此来提高响应的时间。\")]),s._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:a(224),alt:\"\"}})]),s._v(\" \"),e(\"h2\",{attrs:{id:\"第-5-章-kubernetes-的架构\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#第-5-章-kubernetes-的架构\"}},[s._v(\"#\")]),s._v(\" 第 5 章 Kubernetes 的架构\")]),s._v(\" \"),e(\"p\",[s._v(\"Kubernetes 架构是一个比较典型的二层架构和 server-client 架构。Master 作为中央的管控节点，会去与 Node 进行一个连接。\")]),s._v(\" \"),e(\"p\",[s._v(\"所有 UI 的、clients、这些 user 侧的组件，只会和 Master 进行连接，把希望的状态或者想执行的命令下发给 Master，Master 会把这些命令或者状态下发给相应的节点，进行最终的执行。\")]),s._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:a(225),alt:\"\"}})]),s._v(\" \"),e(\"h3\",{attrs:{id:\"_5-1-master\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_5-1-master\"}},[s._v(\"#\")]),s._v(\" 5.1 Master\")]),s._v(\" \"),e(\"p\",[s._v(\"Kubernetes 的 Master 包含四个主要的组件：API Server、Controller、Scheduler 以及 etcd。如下图所示：\")]),s._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:a(226),alt:\"\"}})]),s._v(\" \"),e(\"ul\",[e(\"li\",[s._v(\"**API Server：**顾名思义是用来处理 API 操作的，Kubernetes 中所有的组件都会和 API Server 进行连接，组件与组件之间一般不进行独立的连接，都依赖于 API Server 进行消息的传送；\")]),s._v(\" \"),e(\"li\",[s._v(\"**Controller：**是控制器，它用来完成对集群状态的一些管理。比如刚刚我们提到的两个例子之中，第一个自动对容器进行修复、第二个自动进行水平扩张，都是由 Kubernetes 中的 Controller 来进行完成的；\")]),s._v(\" \"),e(\"li\",[s._v(\"**Scheduler：**是调度器，“调度器”顾名思义就是完成调度的操作，就是我们刚才介绍的第一个例子中，把一个用户提交的 Container，依据它对 CPU、对 memory 请求大小，找一台合适的节点，进行放置；\")]),s._v(\" \"),e(\"li\",[s._v(\"**etcd：**是一个分布式的一个存储系统，API Server 中所需要的这些原信息都被放置在 etcd 中，etcd 本身是一个高可用系统，通过 etcd 保证整个 Kubernetes 的 Master 组件的高可用性。\")])]),s._v(\" \"),e(\"p\",[s._v(\"我们刚刚提到的 API Server，它本身在部署结构上是一个可以水平扩展的一个部署组件；Controller 是一个可以进行热备的一个部署组件，它只有一个 active，它的调度器也是相应的，虽然只有一个 active，但是可以进行热备。\")]),s._v(\" \"),e(\"h3\",{attrs:{id:\"_5-2-node\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_5-2-node\"}},[s._v(\"#\")]),s._v(\" 5.2 \"),e(\"strong\",[s._v(\"Node\")])]),s._v(\" \"),e(\"p\",[s._v(\"Kubernetes 的 Node 是真正运行业务负载的，每个业务负载会以 Pod 的形式运行。一个 Pod 中运行的一个或者多个容器，真正去运行这些 Pod 的组件的是叫做 \"),e(\"strong\",[s._v(\"kubelet\")]),s._v(\"，也就是 Node 上最为关键的组件，它通过 API Server 接收到所需要 Pod 运行的状态，然后提交到我们下面画的这个 Container Runtime 组件中。\")]),s._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:a(227),alt:\"\"}})]),s._v(\" \"),e(\"p\",[s._v(\"在 OS 上去创建容器所需要运行的环境，最终把容器或者 Pod 运行起来，也需要对存储跟网络进行管理。Kubernetes 并不会直接进行网络存储的操作，他们会靠 Storage Plugin 或者是网络的 Plugin 来进行操作。用户自己或者云厂商都会去写相应的 \"),e(\"strong\",[s._v(\"Storage Plugin\")]),s._v(\" 或者 \"),e(\"strong\",[s._v(\"Network Plugin\")]),s._v(\"，去完成存储操作或网络操作。\")]),s._v(\" \"),e(\"p\",[s._v(\"在 Kubernetes 自己的环境中，也会有 Kubernetes 的 Network，它是为了提供 Service network 来进行搭网组网的。真正完成 service 组网的组件的是 \"),e(\"strong\",[s._v(\"Kube-proxy\")]),s._v(\"，它是利用了 iptable 的能力来进行组建 Kubernetes 的 Network，就是 cluster network，以上就是 Node 上面的四个组件。\")]),s._v(\" \"),e(\"p\",[s._v(\"Kubernetes 的 Node 并不会直接和 user 进行 interaction，它的 interaction 只会通过 Master。而 User 是通过 Master 向节点下发这些信息的。Kubernetes 每个 Node 上，都会运行我们刚才提到的这几个组件。\")]),s._v(\" \"),e(\"p\",[s._v(\"下面我们以一个例子再去看一下 Kubernetes 架构中的这些组件，是如何互相进行 interaction 的。\")]),s._v(\" \"),e(\"h2\",{attrs:{id:\"第-6-章-环境搭建\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#第-6-章-环境搭建\"}},[s._v(\"#\")]),s._v(\" 第 6 章 环境搭建\")]),s._v(\" \"),e(\"h3\",{attrs:{id:\"_6-1-准备环境\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-1-准备环境\"}},[s._v(\"#\")]),s._v(\" 6.1 准备环境\")]),s._v(\" \"),e(\"table\",[e(\"thead\",[e(\"tr\",[e(\"th\",[s._v(\"主机\")]),s._v(\" \"),e(\"th\",[s._v(\"服务\")]),s._v(\" \"),e(\"th\",[s._v(\"备注\")])])]),s._v(\" \"),e(\"tbody\",[e(\"tr\",[e(\"td\",[s._v(\"node-01\")]),s._v(\" \"),e(\"td\"),s._v(\" \"),e(\"td\")]),s._v(\" \"),e(\"tr\",[e(\"td\",[s._v(\"node-02\")]),s._v(\" \"),e(\"td\"),s._v(\" \"),e(\"td\")]),s._v(\" \"),e(\"tr\",[e(\"td\",[s._v(\"node-03\")]),s._v(\" \"),e(\"td\"),s._v(\" \"),e(\"td\")]),s._v(\" \"),e(\"tr\",[e(\"td\",[s._v(\"node-04\")]),s._v(\" \"),e(\"td\"),s._v(\" \"),e(\"td\")]),s._v(\" \"),e(\"tr\",[e(\"td\",[s._v(\"node-05\")]),s._v(\" \"),e(\"td\"),s._v(\" \"),e(\"td\")])])]),s._v(\" \"),e(\"ol\",[e(\"li\",[e(\"p\",[s._v(\"关闭 SELinux 和 firewalld\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"systemctl stop firewalld               \"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#临时关闭\")]),s._v(\"\\n\\nsystemctl disable firewalld            \"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#永久关闭,即设置开机的时候不自动启动\")]),s._v(\"\\n\")])])]),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[s._v(\"永久关闭selinux可以使用vi命令打开/etc/sysconfig/selinux 文件将SELINUXTYPE=(disable或permissive）\\n\")])])]),e(\"p\",[s._v(\"永久关闭selinux可以使用vi命令打开/etc/sysconfig/selinux 文件将SELINUXTYPE=(disable或permissive）\")])]),s._v(\" \"),e(\"li\",[e(\"p\",[s._v(\"为全部服务器安装 epel-release 源\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"yum \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" epel-release -y\\n\")])])])]),s._v(\" \"),e(\"li\",[e(\"p\",[s._v(\"为全部服务器安装常用工具\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"yum \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"wget\")]),s._v(\" telnet net-tools tree nmap sysstat lrzsz dos2unix bind-utils -y\\n\")])])])])]),s._v(\" \"),e(\"h3\",{attrs:{id:\"_6-2-dns-服务初始化\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-2-dns-服务初始化\"}},[s._v(\"#\")]),s._v(\" 6.2 DNS 服务初始化\")]),s._v(\" \"),e(\"h4\",{attrs:{id:\"_6-2-1-安装-bind9-软件\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-2-1-安装-bind9-软件\"}},[s._v(\"#\")]),s._v(\" 6.2.1 安装 bind9 软件\")]),s._v(\" \"),e(\"p\",[s._v(\"在 node-01 上执行命令\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"yum \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"bind\")]),s._v(\" -y\\n\")])])]),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-01 ~\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# rpm -qa bind\")]),s._v(\"\\nbind-9.11.4-9.P2.el7.x86_64\\n\")])])]),e(\"h4\",{attrs:{id:\"_6-2-2-配置-bind9\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-2-2-配置-bind9\"}},[s._v(\"#\")]),s._v(\" 6.2.2 配置 bind9\")]),s._v(\" \"),e(\"ul\",[e(\"li\",[e(\"p\",[s._v(\"主配置文件\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"vi\")]),s._v(\" /etc/named.conf\\n\")])])]),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"listen-on port \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"53\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10.10\")]),s._v(\".50.50\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\nallow-query     \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\" any\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\nforwarders      \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10.10\")]),s._v(\".50.1\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\ndnssec-enable no\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\ndnssec-validation no\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\")])])]),e(\"p\",[s._v(\"​\\t检查配置, 没有保存就是 OK\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"name-checkconf\\n\")])])])]),s._v(\" \"),e(\"li\",[e(\"p\",[s._v(\"区域配置文件\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"vi\")]),s._v(\" /etc/named.rfc1912.zones \\n\")])])]),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[s._v('zone \"host.com\" IN {\\n        type master;\\n        file \"host.com.zone\";\\n        allow-update { 10.10.50.50; };\\n};\\n\\nzone \"thtf.com\" IN {\\n        type master;\\n        file \"thtf.com.zone\";\\n        allow-update { 10.10.50.50; };\\n};\\n')])])])]),s._v(\" \"),e(\"li\",[e(\"p\",[s._v(\"区域数据文件\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"vi\")]),s._v(\"  /var/named/host.com.zone\\n\")])])]),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[s._v(\"$ORIGIN host.com.\\n$TTL 600    ; 10 minutes\\n@       IN SOA  dns.host.com. dnsadmin.host.com. (\\n                2020032001 ; serial\\n                10800      ; refresh (3 hours)\\n                900        ; retry (15 minutes)\\n                604800     ; expire (1 week)\\n                86400      ; minimum (1 day)\\n                )\\n            NS   dns.host.com.\\n$TTL 60 ; 1 minute\\ndns                A    10.10.50.50\\nnode-01            A    10.10.50.50           \\nnode-02            A    10.10.50.20\\nnode-03            A    10.10.50.233\\nnode-04            A    10.10.50.99\\nnode-05            A    10.10.50.40\\n\")])])]),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"vi\")]),s._v(\"  /var/named/thtf.com.zone\\n\")])])]),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[s._v(\"$ORIGIN thtf.com.\\n$TTL 600    ; 10 minutes\\n@           IN SOA  dns.thtf.com. dnsadmin.thtf.com. (\\n                2020032001 ; serial\\n                10800      ; refresh (3 hours)\\n                900        ; retry (15 minutes)\\n                604800     ; expire (1 week)\\n                86400      ; minimum (1 day)\\n                )\\n                NS   dns.thtf.com.\\n$TTL 60 ; 1 minute\\ndns                A    10.10.50.50\\n\")])])]),e(\"p\",[s._v(\"检查配置, 没有保存就是 OK\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"named-checkconf\\n\")])])])])]),s._v(\" \"),e(\"h4\",{attrs:{id:\"_6-2-3-启动-bind9\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-2-3-启动-bind9\"}},[s._v(\"#\")]),s._v(\" 6.2.3 启动 bind9\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-01 ~\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# systemctl start named\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-01 ~\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# netstat -lntup|grep 53\")]),s._v(\"\\ntcp        \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\"      \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10.10\")]),s._v(\".50.50:53          \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0.0\")]),s._v(\".0.0:*               LISTEN      \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"26226\")]),s._v(\"/named         \\ntcp        \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\"      \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:953           \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0.0\")]),s._v(\".0.0:*               LISTEN      \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"26226\")]),s._v(\"/named         \\ntcp6       \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\"      \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" :::53                   :::*                    LISTEN      \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"26226\")]),s._v(\"/named         \\ntcp6       \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\"      \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" ::1:953                 :::*                    LISTEN      \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"26226\")]),s._v(\"/named         \\nudp        \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\"      \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10.10\")]),s._v(\".50.50:53          \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0.0\")]),s._v(\".0.0:*                           \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"26226\")]),s._v(\"/named         \\nudp6       \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\"      \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" :::53                   :::*                                \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"26226\")]),s._v(\"/named \\n\")])])]),e(\"h4\",{attrs:{id:\"_6-2-4-检查-dns-服务\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-2-4-检查-dns-服务\"}},[s._v(\"#\")]),s._v(\" 6.2.4 检查 DNS 服务\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-01 ~\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# dig -t A node-01.host.com @10.10.50.50 +short\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10.10\")]),s._v(\".50.50\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-01 ~\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# dig -t A node-02.host.com @10.10.50.50 +short\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10.10\")]),s._v(\".50.20\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-01 ~\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# dig -t A node-03.host.com @10.10.50.50 +short\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10.10\")]),s._v(\".50.233\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-01 ~\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# dig -t A node-04.host.com @10.10.50.50 +short\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10.10\")]),s._v(\".50.99\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-01 ~\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# dig -t A node-05.host.com @10.10.50.50 +short\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10.10\")]),s._v(\".50.40\\n\")])])]),e(\"h4\",{attrs:{id:\"_6-2-5-配置-dns-客户端\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-2-5-配置-dns-客户端\"}},[s._v(\"#\")]),s._v(\" 6.2.5 配置 DNS 客户端\")]),s._v(\" \"),e(\"p\",[s._v(\"全部主机执行下面操作\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"vi\")]),s._v(\" /etc/sysconfig/network-scripts/ifcfg-eth0\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[s._v(\"DNS1\")]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10.10\")]),s._v(\".50.50\\n\")])])]),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"vi\")]),s._v(\" /etc/resolv.conf\\nsearch host.com\\nnameserver \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10.10\")]),s._v(\".50.50\\n\")])])]),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[s._v(\"systemctl restart network\\n\")])])]),e(\"h3\",{attrs:{id:\"_6-3-准备签发证书环境\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-3-准备签发证书环境\"}},[s._v(\"#\")]),s._v(\" 6.3 准备签发证书环境\")]),s._v(\" \"),e(\"p\",[s._v(\"在 node-02 上\")]),s._v(\" \"),e(\"h4\",{attrs:{id:\"_6-3-1-安装-cfssl\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-3-1-安装-cfssl\"}},[s._v(\"#\")]),s._v(\" 6.3.1 安装 cfssl\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"wget\")]),s._v(\" https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 -O /usr/bin/cfssl\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"wget\")]),s._v(\" https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64 -O /usr/bin/cfssl-json\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"wget\")]),s._v(\" https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64 -O /usr/bin/cfssl-certinfo\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"chmod\")]),s._v(\" +x /usr/bin/cfssl*\\n\")])])]),e(\"h4\",{attrs:{id:\"_6-3-2-创建生成ca证书csr的json配置文件\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-3-2-创建生成ca证书csr的json配置文件\"}},[s._v(\"#\")]),s._v(\" 6.3.2 创建生成ca证书csr的json配置文件\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"mkdir\")]),s._v(\" /opt/certs\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"vi\")]),s._v(\"  /opt/certs/ca-csr.json\\n\")])])]),e(\"div\",{staticClass:\"language-json extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-json\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    \"),e(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"CN\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"thtf\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n    \"),e(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"hosts\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"\\n    \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n    \"),e(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"key\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n        \"),e(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"algo\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"rsa\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n        \"),e(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"size\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2048\")]),s._v(\"\\n    \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n    \"),e(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"names\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"\\n        \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n            \"),e(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"C\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"CN\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n            \"),e(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"ST\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"beijing\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n            \"),e(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"L\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"beijing\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n            \"),e(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"O\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"thtf\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n            \"),e(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"OU\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"ops\"')]),s._v(\"\\n        \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n    \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n    \"),e(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"ca\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n        \"),e(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"expiry\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"175200h\"')]),s._v(\"\\n    \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])])]),e(\"blockquote\",[e(\"p\",[s._v(\"CN：Common Name, 浏览器使用该字段验证网站是否合法, 一般写的是域名。非常重要。\")]),s._v(\" \"),e(\"p\",[s._v(\"C：Country, 国家\")]),s._v(\" \"),e(\"p\",[s._v(\"ST：State, 州, 省\")]),s._v(\" \"),e(\"p\",[s._v(\"L：Locality 地区 城市\")]),s._v(\" \"),e(\"p\",[s._v(\"O： Organization Name 组织名称 公司名称\")]),s._v(\" \"),e(\"p\",[s._v(\"OU：Organization Unit Name 组织单位名称 公司部门\")])]),s._v(\" \"),e(\"h4\",{attrs:{id:\"_6-3-3-生成ca证书文件\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-3-3-生成ca证书文件\"}},[s._v(\"#\")]),s._v(\" 6.3.3 生成ca证书文件\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-02 ~\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# cd /opt/certs\")]),s._v(\"\\n\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-02 certs\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# cfssl gencert -initca ca-csr.json | cfssl-json -bare ca\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2020\")]),s._v(\"/04/14 \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),s._v(\":53:46 \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"INFO\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\" generating a new CA key and certificate from CSR\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2020\")]),s._v(\"/04/14 \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),s._v(\":53:46 \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"INFO\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\" generate received request\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2020\")]),s._v(\"/04/14 \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),s._v(\":53:46 \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"INFO\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\" received CSR\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2020\")]),s._v(\"/04/14 \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),s._v(\":53:46 \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"INFO\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\" generating key: rsa-2048\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2020\")]),s._v(\"/04/14 \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),s._v(\":53:46 \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"INFO\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\" encoded CSR\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2020\")]),s._v(\"/04/14 \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),s._v(\":53:46 \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"INFO\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\" signed certificate with serial number \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"35390055852589240424773939585539235500209661940\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-02 certs\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# ll\")]),s._v(\"\\n总用量 \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"16\")]),s._v(\"\\n-rw-r--r-- \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\" root root  \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"989\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"月  \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"14\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),s._v(\":53 ca.csr\\n-rw-r--r-- \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\" root root  \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"325\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"月  \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"14\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),s._v(\":53 ca-csr.json\\n-rw------- \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\" root root \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1675\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"月  \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"14\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),s._v(\":53 ca-key.pem\\n-rw-r--r-- \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\" root root \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1338\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"月  \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"14\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10\")]),s._v(\":53 ca.pem\\n\")])])]),e(\"h3\",{attrs:{id:\"_6-4-部署-docker\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-4-部署-docker\"}},[s._v(\"#\")]),s._v(\" 6.4 部署 docker\")]),s._v(\" \"),e(\"p\",[s._v(\"node-03 node-04 node-05上\")]),s._v(\" \"),e(\"h4\",{attrs:{id:\"_6-4-1-安装\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-4-1-安装\"}},[s._v(\"#\")]),s._v(\" 6.4.1 安装\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"curl\")]),s._v(\" -fsSL https://get.docker.com \"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"|\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"bash\")]),s._v(\" -s docker --mirror Aliyun\\n\")])])]),e(\"h4\",{attrs:{id:\"_6-4-2-配置\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-4-2-配置\"}},[s._v(\"#\")]),s._v(\" 6.4.2 配置\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"mkdir\")]),s._v(\"  /etc/docker\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"vi\")]),s._v(\"  /etc/docker/daemon.json\\n\")])])]),e(\"div\",{staticClass:\"language-json extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-json\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n  \"),e(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"graph\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/data/docker\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n  \"),e(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"storage-driver\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"overlay2\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n  \"),e(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"insecure-registries\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"registry.access.redhat.com\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"quay.io\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"harbor.thtf.com\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n  \"),e(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"registry-mirrors\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"https://q2gr04ke.mirror.aliyuncs.com\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n  \"),e(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"bip\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"172.7.21.1/24\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n  \"),e(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"exec-opts\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"native.cgroupdriver=systemd\"')]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n  \"),e(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"live-restore\"')]),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token boolean\"}},[s._v(\"true\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n##########\\nbip要根据宿主机ip变化 \\n\")])])]),e(\"h4\",{attrs:{id:\"_6-4-3-启动\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-4-3-启动\"}},[s._v(\"#\")]),s._v(\" 6.4.3 启动\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"mkdir\")]),s._v(\" -p /data/docker\\nsystemctl start docker\\nsystemctl \"),e(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"enable\")]),s._v(\" docker\\ndocker --version\\n\")])])]),e(\"h3\",{attrs:{id:\"_6-5-部署私有仓库-harbor\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-5-部署私有仓库-harbor\"}},[s._v(\"#\")]),s._v(\" 6.5 部署私有仓库 harbor\")]),s._v(\" \"),e(\"p\",[s._v(\"在 node-05 上\")]),s._v(\" \"),e(\"h4\",{attrs:{id:\"_6-5-1-下载软件并解压\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-5-1-下载软件并解压\"}},[s._v(\"#\")]),s._v(\" 6.5.1 下载软件并解压\")]),s._v(\" \"),e(\"p\",[s._v(\"harbor官网github地址 https://github.com/goharbor/harbor\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"tar\")]),s._v(\" xf harbor-offline-installer-v1.8.3.tgz -C /opt/\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"mv\")]),s._v(\" harbor/ harbor-v1.8.3\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"ln\")]),s._v(\" -s /opt/harbor-v1.8.3/ /opt/harbor\\n\")])])]),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[s._v(\"lrwxrwxrwx 1 root root  19 4月  14 12:13 harbor -> /opt/harbor-v1.8.3/\\ndrwxr-xr-x 2 root root 100 4月  14 12:12 harbor-v1.8.3\\ndrwxr-xr-x 2 root root  49 4月  14 12:13 install_package\\n\")])])]),e(\"h4\",{attrs:{id:\"_6-5-2-配置\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-5-2-配置\"}},[s._v(\"#\")]),s._v(\" 6.5.2 配置\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"mkdir\")]),s._v(\" -p /data/harbor/logs\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"vi\")]),s._v(\" /opt/harbor/harbor.yml\\n\")])])]),e(\"p\",[s._v(\"修改配置：\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-yml extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-yml\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"hostname\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" harbor.thtf.com\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"http\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n  \"),e(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"port\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"180\")]),s._v(\"\\n harbor_admin_password\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"Harbor12345\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"data_volume\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" /data/harbor\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"log\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"\\n    \"),e(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"level\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"  info\\n    \"),e(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"rotate_count\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"  \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"50\")]),s._v(\"\\n    rotate_size\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\"200M\\n    \"),e(\"span\",{pre:!0,attrs:{class:\"token key atrule\"}},[s._v(\"location\")]),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),s._v(\" /data/harbor/logs\\n\")])])]),e(\"h4\",{attrs:{id:\"_6-5-3-安装-docker-compose\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-5-3-安装-docker-compose\"}},[s._v(\"#\")]),s._v(\" 6.5.3 安装 docker-compose\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"yum \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" docker-compose -y\\n\")])])]),e(\"h4\",{attrs:{id:\"_6-5-4-安装-harbor\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-5-4-安装-harbor\"}},[s._v(\"#\")]),s._v(\" 6.5.4 安装 harbor\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 进入 harbor 根目录\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-05 harbor\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# ll\")]),s._v(\"\\n总用量 \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"569632\")]),s._v(\"\\n-rw-r--r-- \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\" root root \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"583269670\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"9\")]),s._v(\"月  \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"16\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2019\")]),s._v(\" harbor.v1.8.3.tar.gz\\n-rw-r--r-- \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\" root root      \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4528\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"月  \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"14\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"12\")]),s._v(\":19 harbor.yml\\n-rwxr-xr-x \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\" root root      \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"5088\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"9\")]),s._v(\"月  \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"16\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2019\")]),s._v(\" install.sh\\n-rw-r--r-- \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\" root root     \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"11347\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"9\")]),s._v(\"月  \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"16\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2019\")]),s._v(\" LICENSE\\n-rwxr-xr-x \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\" root root      \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1654\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"9\")]),s._v(\"月  \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"16\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2019\")]),s._v(\" prepare\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-05 harbor\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# ./install.sh \")]),s._v(\"\\n\")])])]),e(\"h4\",{attrs:{id:\"_6-5-5-检查-harbor-启动情况\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-5-5-检查-harbor-启动情况\"}},[s._v(\"#\")]),s._v(\" 6.5.5 检查 harbor 启动情况\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-05 harbor\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# docker-compose ps\")]),s._v(\"\\n      Name                     Command               State             Ports          \\n--------------------------------------------------------------------------------------\\nharbor-core         /harbor/start.sh                 Up                               \\nharbor-db           /entrypoint.sh postgres          Up      \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"5432\")]),s._v(\"/tcp                 \\nharbor-jobservice   /harbor/start.sh                 Up                               \\nharbor-log          /bin/sh -c /usr/local/bin/ \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"..\")]),s._v(\".   Up      \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:1514-\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10514\")]),s._v(\"/tcp\\nharbor-portal       nginx -g daemon off\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"             Up      \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"80\")]),s._v(\"/tcp                   \\nnginx               nginx -g daemon off\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"             Up      \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0.0\")]),s._v(\".0.0:180-\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"80\")]),s._v(\"/tcp      \\nredis               docker-entrypoint.sh redis \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"..\")]),s._v(\".   Up      \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6379\")]),s._v(\"/tcp                 \\nregistry            /entrypoint.sh /etc/regist \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"..\")]),s._v(\".   Up      \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"5000\")]),s._v(\"/tcp                 \\nregistryctl         /harbor/start.sh                 Up                               \\n\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-05 harbor\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# docker ps -a\")]),s._v(\"\\nCONTAINER ID        IMAGE                                               COMMAND                  CREATED             STATUS                             PORTS                       NAMES\\n118479faae3c        goharbor/nginx-photon:v1.8.3                        \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"nginx -g \\'daemon of…\"')]),s._v(\"   \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"27\")]),s._v(\" seconds ago      Up \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"25\")]),s._v(\" seconds \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"health: starting\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"   \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0.0\")]),s._v(\".0.0:180-\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"80\")]),s._v(\"/tcp         nginx\\na01be83050a8        goharbor/harbor-portal:v1.8.3                       \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"nginx -g \\'daemon of…\"')]),s._v(\"   \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"28\")]),s._v(\" seconds ago      Up \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"26\")]),s._v(\" seconds \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"health: starting\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"   \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"80\")]),s._v(\"/tcp                      harbor-portal\\nbd00d3fa85cc        goharbor/harbor-jobservice:v1.8.3                   \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/harbor/start.sh\"')]),s._v(\"       \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"28\")]),s._v(\" seconds ago      Up \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"26\")]),s._v(\" seconds                                                  harbor-jobservice\\n30e39e116f97        goharbor/harbor-core:v1.8.3                         \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/harbor/start.sh\"')]),s._v(\"       \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"29\")]),s._v(\" seconds ago      Up \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"27\")]),s._v(\" seconds \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"health: starting\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"                               harbor-core\\n3ecf74bd9a7b        goharbor/redis-photon:v1.8.3                        \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"docker-entrypoint.s…\"')]),s._v(\"   \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"30\")]),s._v(\" seconds ago      Up \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"28\")]),s._v(\" seconds                      \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6379\")]),s._v(\"/tcp                    redis\\n9acf04233a0d        goharbor/harbor-db:v1.8.3                           \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/entrypoint.sh post…\"')]),s._v(\"   \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"30\")]),s._v(\" seconds ago      Up \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"28\")]),s._v(\" seconds \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"health: starting\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"   \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"5432\")]),s._v(\"/tcp                    harbor-db\\n0795ebef5a5d        goharbor/harbor-registryctl:v1.8.3                  \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/harbor/start.sh\"')]),s._v(\"       \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"30\")]),s._v(\" seconds ago      Up \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"28\")]),s._v(\" seconds \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"health: starting\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"                               registryctl\\ne36367cf43e8        goharbor/registry-photon:v2.7.1-patch-2819-v1.8.3   \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/entrypoint.sh /etc…\"')]),s._v(\"   \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"30\")]),s._v(\" seconds ago      Up \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"28\")]),s._v(\" seconds \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"health: starting\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"   \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"5000\")]),s._v(\"/tcp                    registry\\n33d5234e3edf        goharbor/harbor-log:v1.8.3                          \"),e(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/bin/sh -c /usr/loc…\"')]),s._v(\"   \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"31\")]),s._v(\" seconds ago      Up \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"29\")]),s._v(\" seconds \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"health: starting\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\"   \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:1514-\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10514\")]),s._v(\"/tcp   harbor-log\\n\\n\")])])]),e(\"h4\",{attrs:{id:\"_6-5-6-配置-harbor-的-dns-内网解析\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-5-6-配置-harbor-的-dns-内网解析\"}},[s._v(\"#\")]),s._v(\" 6.5.6 配置 harbor 的 dns 内网解析\")]),s._v(\" \"),e(\"p\",[s._v(\"在 node-01 上\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"vi\")]),s._v(\" /var/named/thtf.com.zone\\n\")])])]),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[s._v(\"$ORIGIN thtf.com.\\n$TTL 600    ; 10 minutes\\n@           IN SOA  dns.thtf.com. dnsadmin.thtf.com. (\\n                2020032002 ; serial\\n                10800      ; refresh (3 hours)\\n                900        ; retry (15 minutes)\\n                604800     ; expire (1 week)\\n                86400      ; minimum (1 day)\\n                )\\n                NS   dns.thtf.com.\\n$TTL 60 ; 1 minute\\ndns                A    10.10.50.50\\nharbor             A    10.10.50.40\\n\")])])]),e(\"blockquote\",[e(\"p\",[s._v(\"2020032002 ; serial 前滚一个序号\")]),s._v(\" \"),e(\"p\",[s._v(\"harbor             A    10.10.50.40\")])]),s._v(\" \"),e(\"p\",[s._v(\"重启 named\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"systemctl restart named\\n\")])])]),e(\"p\",[s._v(\"检查\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-01 ~\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# dig -t A harbor.thtf.com +short\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10.10\")]),s._v(\".50.40\\n\")])])]),e(\"h4\",{attrs:{id:\"_6-5-6-安装-nginx-并配置\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-5-6-安装-nginx-并配置\"}},[s._v(\"#\")]),s._v(\" 6.5.6 安装 Nginx 并配置\")]),s._v(\" \"),e(\"p\",[s._v(\"在 node-05 上\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[s._v(\"yum \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" nginx -y\\n\")])])]),e(\"p\",[s._v(\"修改配置文件\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"vi\")]),s._v(\" /etc/nginx/conf.d/harbor.thtf.com.conf\\n\")])])]),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[s._v(\"server {\\n    listen       80;\\n    server_name  harbor.thtf.com;\\n\\n    client_max_body_size 1000m;\\n\\n    location / {\\n        proxy_pass http://127.0.0.1:180;\\n    }\\n}\\n\")])])]),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-05 harbor\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# nginx -t\")]),s._v(\"\\nnginx: the configuration \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"file\")]),s._v(\" /etc/nginx/nginx.conf syntax is ok\\nnginx: configuration \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"file\")]),s._v(\" /etc/nginx/nginx.conf \"),e(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"test\")]),s._v(\" is successful\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-05 harbor\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# systemctl start nginx\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-05 harbor\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# systemctl enable nginx\")]),s._v(\"\\nCreated symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.\\n\")])])]),e(\"h4\",{attrs:{id:\"_6-5-7-测试\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_6-5-7-测试\"}},[s._v(\"#\")]),s._v(\" 6.5.7 测试\")]),s._v(\" \"),e(\"ol\",[e(\"li\",[s._v(\"浏览器输入：harbor.thtf.com\")])]),s._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:a(228),alt:\"\"}})]),s._v(\" \"),e(\"ol\",{attrs:{start:\"2\"}},[e(\"li\",[e(\"p\",[s._v(\"输入用户名：admin 密码：Harbor12345\")]),s._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:a(229),alt:\"\"}})])]),s._v(\" \"),e(\"li\",[e(\"p\",[s._v(\"新建项目：public 访问级别：公开\")]),s._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:a(230),alt:\"\"}})]),s._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:a(231),alt:\"\"}})])]),s._v(\" \"),e(\"li\",[e(\"p\",[s._v(\"下载镜像并给镜像打 tag\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-05 harbor\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# docker pull nginx:1.7.9\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1.7\")]),s._v(\".9: Pulling from library/nginx\\nImage docker.io/library/nginx:1.7.9 uses outdated schema1 manifest format. Please upgrade to a schema2 image \"),e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"for\")]),s._v(\" better future compatibility. More information at https://docs.docker.com/registry/spec/deprecated-schema-v1/\\na3ed95caeb02: Pull complete \\n6f5424ebd796: Pull complete \\nd15444df170a: Pull complete \\ne83f073daa67: Pull complete \\na4d93e421023: Pull complete \\n084adbca2647: Pull complete \\nc9cec474c523: Pull complete \\nDigest: sha256:e3456c851a152494c3e4ff5fcc26f240206abac0c9d794affb40e0714846c451\\nStatus: Downloaded newer image \"),e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"for\")]),s._v(\" nginx:1.7.9\\ndocker.io/library/nginx:1.7.9\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-05 harbor\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# docker images|grep nginx\")]),s._v(\"\\ngoharbor/nginx-photon           v1.8.3                     3a016e0dc7de        \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7\")]),s._v(\" months ago        37MB\\nnginx                           \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1.7\")]),s._v(\".9                      84581e99d807        \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"5\")]),s._v(\" years ago         \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"91\")]),s._v(\".7MB\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-05 harbor\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# docker tag 84581e99d807 harbor.thtf.com/public/nginx:v1.7.9\")]),s._v(\"\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-05 harbor\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# docker images|grep nginx\")]),s._v(\"\\ngoharbor/nginx-photon           v1.8.3           \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"vi\")]),s._v(\" \"),e(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"vi\")]),s._v(\"           3a016e0dc7de        \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7\")]),s._v(\" months ago        37MB\\nnginx                           \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1.7\")]),s._v(\".9                      84581e99d807        \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"5\")]),s._v(\" years ago         \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"91\")]),s._v(\".7MB\\nharbor.thtf.com/public/nginx     v1.7.9                     84581e99d807        \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"5\")]),s._v(\" years ago         \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"91\")]),s._v(\".7MB\\n\\n\")])])])]),s._v(\" \"),e(\"li\",[e(\"p\",[s._v(\"登录 harbor 并上传仓库\")]),s._v(\" \"),e(\"div\",{staticClass:\"language-shell extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[e(\"code\",[e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-05 harbor\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# docker login harbor.thtf.com\")]),s._v(\"\\nAuthenticating with existing credentials\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"..\")]),s._v(\".\\nWARNING\"),e(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"!\")]),s._v(\" Your password will be stored unencrypted \"),e(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"in\")]),s._v(\" /root/.docker/config.json.\\nConfigure a credential helper to remove this warning. See\\nhttps://docs.docker.com/engine/reference/commandline/login/\"),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#credentials-store\")]),s._v(\"\\n\\nLogin Succeeded\\n\\n\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"root@node-05 harbor\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),e(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# docker push harbor.thtf.com/public/nginx:v1.7.9\")]),s._v(\"\\nThe push refers to repository \"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"harbor.thtf.com/public/nginx\"),e(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n5f70bf18a086: Pushed \\n4b26ab29a475: Pushed \\nccb1d68e3fb7: Pushed \\ne387107e2065: Pushed \\n63bf84221cce: Pushed \\ne02dce553481: Pushed \\ndea2e4984e29: Pushed \\nv1.7.9: digest: sha256:b1f5935eb2e9e2ae89c0b3e2e148c19068d91ca502e857052f14db230443e4c2 size: \"),e(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"3012\")]),s._v(\"\\n\\n\")])])]),e(\"p\",[s._v(\"可以看到NGINX镜像已经上传到public下\")]),s._v(\" \"),e(\"p\",[e(\"img\",{attrs:{src:a(232),alt:\"\"}})])])])])}),[],!1,null,null,null);t.default=n.exports}}]);","extractedComments":[]}