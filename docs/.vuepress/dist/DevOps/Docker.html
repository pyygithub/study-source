<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker | PYY在线笔记文档</title>
    <meta name="description" content="PYY在线笔记文档">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/study/img/logo.png">
    
    <link rel="preload" href="/study/assets/css/0.styles.adf990bf.css" as="style"><link rel="preload" href="/study/assets/js/app.805d6976.js" as="script"><link rel="preload" href="/study/assets/js/2.d79867de.js" as="script"><link rel="preload" href="/study/assets/js/3.373a8979.js" as="script"><link rel="prefetch" href="/study/assets/js/10.8f6cc0bc.js"><link rel="prefetch" href="/study/assets/js/11.80afb327.js"><link rel="prefetch" href="/study/assets/js/12.202c1bb3.js"><link rel="prefetch" href="/study/assets/js/13.c0659ce7.js"><link rel="prefetch" href="/study/assets/js/14.2e675df6.js"><link rel="prefetch" href="/study/assets/js/15.478fef0f.js"><link rel="prefetch" href="/study/assets/js/16.e3882713.js"><link rel="prefetch" href="/study/assets/js/17.15b2bc97.js"><link rel="prefetch" href="/study/assets/js/18.e3f7e58b.js"><link rel="prefetch" href="/study/assets/js/19.7df53965.js"><link rel="prefetch" href="/study/assets/js/20.095604ea.js"><link rel="prefetch" href="/study/assets/js/21.025c2b93.js"><link rel="prefetch" href="/study/assets/js/4.66dbe83c.js"><link rel="prefetch" href="/study/assets/js/5.f2f75567.js"><link rel="prefetch" href="/study/assets/js/6.40dc09d8.js"><link rel="prefetch" href="/study/assets/js/7.f16429f3.js"><link rel="prefetch" href="/study/assets/js/8.ace670df.js"><link rel="prefetch" href="/study/assets/js/9.7fd67b26.js">
    <link rel="stylesheet" href="/study/assets/css/0.styles.adf990bf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study/" class="home-link router-link-active"><img src="/study/img/logo.png" alt="PYY在线笔记文档" class="logo"> <span class="site-name can-hide">PYY在线笔记文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/study/大数据/" class="nav-link">
  大数据
</a></div><div class="nav-item"><a href="/study/DevOps/" class="nav-link router-link-active">
  DevOps
</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/af08f637aff8" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/pyy-admin-x" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/study/大数据/" class="nav-link">
  大数据
</a></div><div class="nav-item"><a href="/study/DevOps/" class="nav-link router-link-active">
  DevOps
</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/af08f637aff8" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/pyy-admin-x" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Dev Ops</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study/DevOps/" class="sidebar-link">介绍</a></li><li><a href="/study/DevOps/Docker.html" class="active sidebar-link">Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#第-1-章-容器技术的由来" class="sidebar-link">第 1 章 容器技术的由来</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_1-1-容器概述" class="sidebar-link">1.1 容器概述</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_1-2-容器技术由来" class="sidebar-link">1.2 容器技术由来</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#第-2-章-docker-介绍" class="sidebar-link">第 2 章 Docker 介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_2-1-docker-起源" class="sidebar-link">2.1 Docker 起源</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_2-2-docker-是什么" class="sidebar-link">2.2 Docker 是什么</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_2-3-docker-技术优势" class="sidebar-link">2.3 Docker 技术优势</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#第-3-章-docker-容器引擎" class="sidebar-link">第 3 章 Docker 容器引擎</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_3-1-介绍" class="sidebar-link">3.1 介绍</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_3-2-docker引擎安装部署配置" class="sidebar-link">3.2 Docker引擎安装部署配置</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_3-3-启动第一个-docker-容器" class="sidebar-link">3.3 启动第一个 docker 容器</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#第-4-章-docker-镜像的结构详解" class="sidebar-link">第 4 章 Docker 镜像的结构详解</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#第-5-章-docker-镜像管理" class="sidebar-link">第 5 章 Docker 镜像管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_5-1-docker-hub-官网" class="sidebar-link">5.1 Docker Hub 官网</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_5-2-注册一个-dockerhub-账号" class="sidebar-link">5.2 注册一个 dockerhub 账号</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_5-3-搜索一个镜像" class="sidebar-link">5.3 搜索一个镜像</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_5-4-拉取一个镜像" class="sidebar-link">5.4 拉取一个镜像</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_5-5-查看本地镜像" class="sidebar-link">5.5 查看本地镜像</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_5-6-给镜像打标签（tag）" class="sidebar-link">5.6 给镜像打标签（tag）</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_5-7-推送镜像" class="sidebar-link">5.7 推送镜像</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_5-8-再给镜像打一个标签（tag）" class="sidebar-link">5.8 再给镜像打一个标签（tag）</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_5-9-再次推送镜像" class="sidebar-link">5.9 再次推送镜像</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_5-10-删除镜像" class="sidebar-link">5.10 删除镜像</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#第-6-章-docker-镜像特性" class="sidebar-link">第 6 章 Docker 镜像特性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_6-1-镜像特性" class="sidebar-link">6.1 镜像特性</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_6-2-docker-文件系统" class="sidebar-link">6.2 Docker 文件系统</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#第-7-章-docker-容器的基本操作" class="sidebar-link">第 7 章 Docker 容器的基本操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_7-1-启动容器（运行镜像）" class="sidebar-link">7.1 启动容器（运行镜像）</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_7-2-查看容器" class="sidebar-link">7.2 查看容器</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_7-3-进入容器" class="sidebar-link">7.3 进入容器</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_7-4-停止-启动-重启容器" class="sidebar-link">7.4 停止/启动/重启容器</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_7-5-删除容器" class="sidebar-link">7.5 删除容器</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_7-6-修改-提交容器" class="sidebar-link">7.6 修改/提交容器</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_7-7-导出-导入镜像" class="sidebar-link">7.7 导出/导入镜像</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_7-8-查看容器日志" class="sidebar-link">7.8 查看容器日志</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#第-8-章-docker-容器的高级操作" class="sidebar-link">第 8 章 Docker 容器的高级操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_8-1-下载-nginx-镜像" class="sidebar-link">8.1 下载 Nginx 镜像</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_8-2-映射端口" class="sidebar-link">8.2 映射端口</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_8-3-挂载数据卷" class="sidebar-link">8.3 挂载数据卷</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_8-4-传递环境变量" class="sidebar-link">8.4 传递环境变量</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_8-5-容器内安装软件" class="sidebar-link">8.5 容器内安装软件</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#第-9-章-容器的生命周期" class="sidebar-link">第 9 章 容器的生命周期</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#第-10-章-dockerfile" class="sidebar-link">第 10 章 Dockerfile</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_10-1-dockerfile-概述" class="sidebar-link">10.1 Dockerfile 概述</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_10-2-dockerfile-的规则" class="sidebar-link">10.2 Dockerfile 的规则</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_10-3-dockerfile-核心指令" class="sidebar-link">10.3 Dockerfile 核心指令</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#第-11-章-docker-网络模型" class="sidebar-link">第 11 章 Docker 网络模型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_11-1-nat-默认" class="sidebar-link">11.1 NAT (默认)</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_11-2-none" class="sidebar-link">11.2 None</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_11-3-host" class="sidebar-link">11.3 Host</a></li><li class="sidebar-sub-header"><a href="/study/DevOps/Docker.html#_11-4-联合网络" class="sidebar-link">11.4 联合网络</a></li></ul></li></ul></li><li><a href="/study/DevOps/Jenkins与Docker的自动化CICD实战.html" class="sidebar-link">/DevOps/Jenkins与Docker的自动化CICD实战.html</a></li><li><a href="/study/DevOps/Kubernetes.html" class="sidebar-link">Kubernetes</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>大数据</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="docker"><a href="#docker" class="header-anchor">#</a> Docker</h1> <h2 id="第-1-章-容器技术的由来"><a href="#第-1-章-容器技术的由来" class="header-anchor">#</a> 第 1 章 容器技术的由来</h2> <h3 id="_1-1-容器概述"><a href="#_1-1-容器概述" class="header-anchor">#</a> 1.1 容器概述</h3> <p>容器是一种基础工具。泛指任何可以用于容纳其它物品的工具，可以部分或完全封闭，被用于容纳、储存、运输物品。物体可以被放置在容器中，而容器则可以保护内容物。</p> <p>容器的类型：瓶、罐、箱、篮、桶、瓮、碗、柜、盆、鞘 ...</p> <h3 id="_1-2-容器技术由来"><a href="#_1-2-容器技术由来" class="header-anchor">#</a> 1.2 容器技术由来</h3> <p><img src="/study/assets/img/docker_1.81794ad2.png" alt=""></p> <p>这里我们需要将上面的程序运行在同一个宿主机上，但是有相互隔离。</p> <p><img src="/study/assets/img/docker_os1.cd6cdf76.png" alt=""></p> <p>我们利用虚拟化技术完全可以解决，但是虚拟化技术成本有点大（需要单独安装操作系统），此时就可以使用容器化技术来解决这个问题，对比虚拟化技术极大的节约了系统开销。</p> <p>那么我们如果想要用到这些容器化技术完成应用A和应用B的隔离，我们应该让它们在哪些层次或纬度上隔离呢？</p> <p><img src="/study/assets/img/docker_namespce.93e879d1.png" alt=""></p> <h2 id="第-2-章-docker-介绍"><a href="#第-2-章-docker-介绍" class="header-anchor">#</a> 第 2 章 Docker 介绍</h2> <h3 id="_2-1-docker-起源"><a href="#_2-1-docker-起源" class="header-anchor">#</a> 2.1 Docker 起源</h3> <p><img src="C:%5CUsers%5Cwolf%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200407161120899.png" alt="image-20200407161120899"></p> <h3 id="_2-2-docker-是什么"><a href="#_2-2-docker-是什么" class="header-anchor">#</a> 2.2 Docker 是什么</h3> <ul><li><p>Docker 基于容器技术的<strong>轻量级</strong>虚拟化解决方案。</p></li> <li><p>Docker 是<strong>容器引擎</strong>，把Linux的 cgroup、namespce 等容器底层技术进行封装抽象为用户提供了创建和管理容器的便捷界面（包括命令行和API）。</p></li> <li><p>Docker 是一个开源项目，诞生于 2013 年初，基于 Google 公司推出的 Go 语言实现。</p></li> <li><p>微软，红帽Linux，IBM，Oracle等主流IT厂商已经在自己的产品里增加对 Docker 的支持。</p></li> <li><p>相比其他早期的容器技术，Docker 引入了一整套容器管理的生态系统，包括分层的镜像模型，容器注册库，友好的 Rest API。</p></li></ul> <h3 id="_2-3-docker-技术优势"><a href="#_2-3-docker-技术优势" class="header-anchor">#</a> 2.3 Docker 技术优势</h3> <p><img src="/study/assets/img/docker_os2.999edcb6.png" alt=""></p> <table><thead><tr><th>指标</th> <th>容器技术</th> <th>虚拟机技术</th></tr></thead> <tbody><tr><td>占用磁盘空间</td> <td>小，甚至几十KB（镜像层的情况）</td> <td>非常大，上GB</td></tr> <tr><td>启动速度</td> <td>块，几秒钟</td> <td>慢，几分钟</td></tr> <tr><td>运行形态</td> <td>直接运行于宿主机的内核上，不同容器共享同一个linux内核</td> <td>运行于Hypervisior上</td></tr> <tr><td>并发性</td> <td>一台宿主机可以启动成千上百万个容器</td> <td>逊于宿主机</td></tr> <tr><td>性能</td> <td>接近宿主机本地进程</td> <td>低</td></tr> <tr><td>资源利用率</td> <td>高</td> <td>低</td></tr></tbody></table> <h2 id="第-3-章-docker-容器引擎"><a href="#第-3-章-docker-容器引擎" class="header-anchor">#</a> 第 3 章 Docker 容器引擎</h2> <h3 id="_3-1-介绍"><a href="#_3-1-介绍" class="header-anchor">#</a> 3.1 介绍</h3> <p>Docker 引擎可以从 Docker 网站下载，也可以基于 GitHub 上的源码进行构建。无论是开源版本还是商业版本，都有 Linux 和 Windows 版本。</p> <p>Docker 引擎主要有两个版本：企业版（EE）和社区版（CE）</p> <p>每个季度，企业版和社区版都会发布一个稳定版本。社区版会提供4个月的支持，而企业版会提供12个月的支持。</p> <p>从 2017 年第一季度开始，Docker 版本号遵循 YY.MM-xx 格式，类似于 Ubuntu等项目。例如，2018 年 6月第一次发布社区版为 18.06.0-ce。</p> <blockquote><p>注：2017 年第一季度以前，Docker版本号遵循大版本号.小版本号的格式。采用新格式前的最后一个版本是 Docker 1.13。</p></blockquote> <h3 id="_3-2-docker引擎安装部署配置"><a href="#_3-2-docker引擎安装部署配置" class="header-anchor">#</a> 3.2 Docker引擎安装部署配置</h3> <ol><li><p>安装 epel 源</p> <div class="language-sh extra-class"><pre class="language-sh"><code>yum <span class="token function">install</span> epel-release -y
</code></pre></div><blockquote><p><strong>EPEL的全称叫 Extra Packages for Enterprise Linux</strong> 。EPEL是由 Fedora 社区打造，为 RHEL 及衍生发行版如 CentOS、Scientific Linux 等提供高质量软件包的项目。装上了 EPEL之后，就相当于添加了一个第三方源。</p></blockquote></li> <li><p>查看 epel 源中是否包括 docker</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># yum list docker --show-duplicates</span>
Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
<span class="token punctuation">..</span>.
Available Packages
docker.x86_64                    <span class="token number">2</span>:1.13.1-102.git7f2769b.el7.centos                    extras
docker.x86_64                    <span class="token number">2</span>:1.13.1-103.git7f2769b.el7.centos                    extras
docker.x86_64                    <span class="token number">2</span>:1.13.1-108.git4ef4b30.el7.centos                    extras
docker.x86_64                    <span class="token number">2</span>:1.13.1-109.gitcccb291.el7.centos                    extras

</code></pre></div><p>这里我们会发现 docker 的版本是 1.13.1 是17年之前的版本，如果你想要使用 ce 版，可以按照下面步骤执行。</p></li> <li><p>安装 yum-utils 工具，为了使用 yum-config-manager 去安装一个yum源</p> <div class="language-shell extra-class"><pre class="language-shell"><code>yum <span class="token function">install</span> -y yum-utils
</code></pre></div></li> <li><p>添加 dockerce 的yum 源</p> <div class="language-shell extra-class"><pre class="language-shell"><code>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre></div><p>此时在通过 <code>yum list docker-ce --show-duplicates</code>查看，就会有很多 docker-ce版本</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># yum list docker-ce --show-duplicates</span>
Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
 * base: mirror.bit.edu.cn
 * epel: mirrors.tuna.tsinghua.edu.cn
 * extras: mirror.bit.edu.cn
 * updates: mirror.bit.edu.cn
Available Packages
docker-ce.x86_64                   <span class="token number">17.03</span>.0.ce-1.el7.centos                   docker-
docker-ce.x86_64                   <span class="token number">3</span>:18.09.2-3.el7                           docker-ce-stable
<span class="token punctuation">..</span>.
docker-ce.x86_64                   <span class="token number">3</span>:19.03.3-3.el7                           docker-ce-stable
docker-ce.x86_64                   <span class="token number">3</span>:19.03.4-3.el7                           docker-ce-stable
docker-ce.x86_64                   <span class="token number">3</span>:19.03.5-3.el7                           docker-ce-stable
docker-ce.x86_64                   <span class="token number">3</span>:19.03.6-3.el7                           docker-ce-stable
docker-ce.x86_64                   <span class="token number">3</span>:19.03.7-3.el7                           docker-ce-stable
docker-ce.x86_64                   <span class="token number">3</span>:19.03.8-3.el7                           docker-ce-stable
</code></pre></div></li> <li><p>安装 docker-ce</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#安装最新版本</span>
yum <span class="token function">install</span> docker-ce
<span class="token comment">#安装指定版本</span>
yum <span class="token function">install</span> docker-ce-<span class="token operator">&lt;</span>VERSION STRING<span class="token operator">&gt;</span>
</code></pre></div></li> <li><p>启动 docker 引擎</p> <div class="language- extra-class"><pre class="language-text"><code>#开机启动
systemctl enable docker
#启动 docker
systemctl start docker
#查看 docker 版本
docker version
</code></pre></div></li> <li><p>docker 引擎配置</p> <div class="language-json extra-class"><pre class="language-json"><code>vi /etc/docker/daemon.json

<span class="token punctuation">{</span>
  <span class="token property">&quot;graph&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/data/docker&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;storage-driver&quot;</span><span class="token operator">:</span> <span class="token string">&quot;overlay2&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;registry-mirrors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://q2gr04ke.mirror.aliyuncs.com&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;insecure-registries&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
  <span class="token property">&quot;exec-opts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;native.cgroupdriver=systemd&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;live-restore&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>graph：镜像与容器的保存位置</p></li> <li><p>storage-driver：要使用的存储驱动程序</p></li> <li><p>insecure-registries: 设置私有仓库地址可以设为http</p></li> <li><p>registry-mirrors： 国内的镜像加速器</p></li> <li><p>exec-opts：运行时执行选项</p></li> <li><p>live-restore：docker引擎死掉了，用docker 引擎起来的容器还可以运行</p></li></ul></li> <li><p>重启 docker</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#确保 /data/docker 存在</span>
<span class="token function">mkdir</span> -p /data/docker
<span class="token comment">#重启 docker </span>
systemctl restart docker
</code></pre></div></li></ol> <h3 id="_3-3-启动第一个-docker-容器"><a href="#_3-3-启动第一个-docker-容器" class="header-anchor">#</a> 3.3 启动第一个 docker 容器</h3> <p>运行 hello-world</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker run hello-world</span>

Hello from Docker<span class="token operator">!</span>
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 <span class="token number">1</span>. The Docker client contacted the Docker daemon.
 <span class="token number">2</span>. The Docker daemon pulled the <span class="token string">&quot;hello-world&quot;</span> image from the Docker Hub.
    <span class="token punctuation">(</span>amd64<span class="token punctuation">)</span>
 <span class="token number">3</span>. The Docker daemon created a new container from that image <span class="token function">which</span> runs the
    executable that produces the output you are currently reading.
 <span class="token number">4</span>. The Docker daemon streamed that output to the Docker client, <span class="token function">which</span> sent it
    to your terminal.

To try something <span class="token function">more</span> ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu <span class="token function">bash</span>

Share images, automate workflows, and <span class="token function">more</span> with a <span class="token function">free</span> Docker ID:
 https://hub.docker.com/

For <span class="token function">more</span> examples and ideas, visit:
 https://docs.docker.com/get-started/

</code></pre></div><ol><li><p>Docker客户端联系Docker守护进程。</p></li> <li><p>Docker守护进程从Docker中心提取“hello-world”映像。</p></li> <li><p>Docker守护进程从运行可执行文件，生成您当前正在读取的输出。</p></li> <li><p>Docker守护进程将输出流到发送它的Docker客户机的终端。</p></li></ol> <h2 id="第-4-章-docker-镜像的结构详解"><a href="#第-4-章-docker-镜像的结构详解" class="header-anchor">#</a> 第 4 章 Docker 镜像的结构详解</h2> <p><img src="/study/assets/img/docker_image.e35a6b94.png" alt=""></p> <h2 id="第-5-章-docker-镜像管理"><a href="#第-5-章-docker-镜像管理" class="header-anchor">#</a> 第 5 章 Docker 镜像管理</h2> <h3 id="_5-1-docker-hub-官网"><a href="#_5-1-docker-hub-官网" class="header-anchor">#</a> 5.1 Docker Hub 官网</h3> <p><img src="/study/assets/img/docker_hub.131fa074.png" alt=""></p> <h3 id="_5-2-注册一个-dockerhub-账号"><a href="#_5-2-注册一个-dockerhub-账号" class="header-anchor">#</a> 5.2 注册一个 dockerhub 账号</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker login docker.io</span>
Login with your Docker ID to push and pull images from Docker Hub. If you don't have a Docker ID, <span class="token function">head</span> over to https://hub.docker.com to create one.
Username: panyangyang
Password:
WARNING<span class="token operator">!</span> Your password will be stored unencrypted <span class="token keyword">in</span> /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/<span class="token comment">#credentials-store</span>

Login Succeeded
</code></pre></div><h3 id="_5-3-搜索一个镜像"><a href="#_5-3-搜索一个镜像" class="header-anchor">#</a> 5.3 搜索一个镜像</h3> <ul><li><p>命令行搜索</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker serch alpine</span>
docker: <span class="token string">'serch'</span> is not a docker command.
See <span class="token string">'docker --help'</span>
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker search alpine</span>
NAME                                   DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED
alpine                                 A minimal Docker image based on Alpine Linux…   <span class="token number">6313</span>                <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
mhart/alpine-node                      Minimal Node.js built on Alpine Linux           <span class="token number">462</span>
anapsix/alpine-java                    Oracle Java <span class="token number">8</span> <span class="token punctuation">(</span>and <span class="token number">7</span><span class="token punctuation">)</span> with GLIBC <span class="token number">2.28</span> over A…   <span class="token number">440</span>                                     <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
frolvlad/alpine-glibc                  Alpine Docker image with glibc <span class="token punctuation">(</span>~12MB<span class="token punctuation">)</span>          <span class="token number">237</span>                                     <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
gliderlabs/alpine                      Image based on Alpine Linux will <span class="token builtin class-name">help</span> you wi…   <span class="token number">181</span>
alpine/git                             A  simple <span class="token function">git</span> container running <span class="token keyword">in</span> alpine li…   <span class="token number">122</span>                                     <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
mvertes/alpine-mongo                   light MongoDB container                         <span class="token number">110</span>                                     <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
yobasystems/alpine-mariadb             MariaDB running on Alpine Linux <span class="token punctuation">[</span>docker<span class="token punctuation">]</span> <span class="token punctuation">[</span>am…   <span class="token number">62</span>                                      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
alpine/socat                           Run socat <span class="token builtin class-name">command</span> <span class="token keyword">in</span> alpine container           <span class="token number">50</span>                                      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
kiasaki/alpine-postgres                PostgreSQL docker image based on Alpine Linux   <span class="token number">45</span>                                      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
davidcaste/alpine-tomcat               Apache Tomcat <span class="token number">7</span>/8 using Oracle Java <span class="token number">7</span>/8 with…   <span class="token number">42</span>                                      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
zzrot/alpine-caddy                     Caddy Server Docker Container running on Alp…   <span class="token number">36</span>                                      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
jfloff/alpine-python                   A small, <span class="token function">more</span> complete, Python Docker image …   <span class="token number">35</span>                                      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
hermsi/alpine-sshd                     Dockerize your OpenSSH-server with <span class="token function">rsync</span> and…   <span class="token number">30</span>                                      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
byrnedo/alpine-curl                    Alpine linux with <span class="token function">curl</span> installed and <span class="token builtin class-name">set</span> as …   <span class="token number">30</span>                                      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
etopian/alpine-php-wordpress           Alpine WordPress Nginx PHP-FPM WP-CLI           <span class="token number">24</span>                                      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
hermsi/alpine-fpm-php                  Dockerize your FPM PHP <span class="token number">7.4</span> upon a lightweigh…   <span class="token number">24</span>                                      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
zenika/alpine-chrome                   Chrome running <span class="token keyword">in</span> headless mode <span class="token keyword">in</span> a tiny Al…   <span class="token number">19</span>                                      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
bashell/alpine-bash                    Alpine Linux with /bin/bash as a default she…   <span class="token number">16</span>                                      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
davidcaste/alpine-java-unlimited-jce   Oracle Java <span class="token number">8</span> <span class="token punctuation">(</span>and <span class="token number">7</span><span class="token punctuation">)</span> with GLIBC <span class="token number">2.21</span> over A…   <span class="token number">13</span>                                      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
spotify/alpine                         Alpine image with <span class="token variable"><span class="token variable">`</span><span class="token function">bash</span><span class="token variable">`</span></span> and <span class="token variable"><span class="token variable">`</span><span class="token function">curl</span><span class="token variable">`</span></span><span class="token builtin class-name">.</span>            <span class="token number">11</span>                                      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
roribio16/alpine-sqs                   Dockerized ElasticMQ server + web UI over Al…   <span class="token number">8</span>                                       <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
cfmanteiga/alpine-bash-curl-jq         Docker Alpine image with Bash, <span class="token function">curl</span> and jq p…   <span class="token number">5</span>                                       <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
hermsi/alpine-varnish                  Dockerize Varnish upon a lightweight alpine-…   <span class="token number">3</span>                                       <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
goodguykoi/alpine-curl-internal        simple alpine image with <span class="token function">curl</span> installed no C…   <span class="token number">0</span>                                       <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>

</code></pre></div></li> <li><p>dockerhub 网页搜索</p> <p><img src="/study/assets/img/docker_search.8adfcad4.png" alt=""></p></li></ul> <h3 id="_5-4-拉取一个镜像"><a href="#_5-4-拉取一个镜像" class="header-anchor">#</a> 5.4 拉取一个镜像</h3> <ul><li><p>直接下载</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker pull alpine</span>
Using default tag: latest
latest: Pulling from library/alpine
aad63a933944: Pull complete
Digest: sha256:b276d875eeed9c7d3f1cfa7edb06b22ed22b14219a7d67c52c56612330348239
Status: Downloaded newer image <span class="token keyword">for</span> alpine:latest
docker.io/library/alpine:latest
</code></pre></div></li> <li><p>下载指定 tag</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker pull alpine:3.10.1</span>
<span class="token number">3.10</span>.1: Pulling from library/alpine
050382585609: Pull complete
Digest: sha256:6a92cd1fcdc8d8cdec60f33dda4db2cb1fcdcacf3410a8e05b3741f44a9b5998
Status: Downloaded newer image <span class="token keyword">for</span> alpine:3.10.1
docker.io/library/alpine:3.10.1
</code></pre></div><blockquote><p>镜像结构：registry_name/repository_name/image_name:tag_name</p> <p>例如：docker.io/library/alpine:3.10.1</p></blockquote></li></ul> <h3 id="_5-5-查看本地镜像"><a href="#_5-5-查看本地镜像" class="header-anchor">#</a> 5.5 查看本地镜像</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
alpine              <span class="token number">3.11</span>.5              a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
alpine              latest              a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
alpine              <span class="token number">3.10</span>.1              b7b28af77ffe        <span class="token number">9</span> months ago        <span class="token number">5</span>.58MB
hello-world         latest              fce289e99eb9        <span class="token number">15</span> months ago       <span class="token number">1</span>.84kB

</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker image ls</span>
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
alpine              <span class="token number">3.11</span>.5              a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
alpine              latest              a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
alpine              <span class="token number">3.10</span>.1              b7b28af77ffe        <span class="token number">9</span> months ago        <span class="token number">5</span>.58MB
hello-world         latest              fce289e99eb9        <span class="token number">15</span> months ago       <span class="token number">1</span>.84kB
</code></pre></div><h3 id="_5-6-给镜像打标签（tag）"><a href="#_5-6-给镜像打标签（tag）" class="header-anchor">#</a> 5.6 给镜像打标签（tag）</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker tag a187dde48cd2 docker.io/panyangyang/alpine:v3.11.5</span>
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE
alpine               <span class="token number">3.11</span>.5              a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
alpine               latest              a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
panyangyang/alpine   v3.11.5             a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
alpine               <span class="token number">3.10</span>.1              b7b28af77ffe        <span class="token number">9</span> months ago        <span class="token number">5</span>.58MB
hello-world          latest              fce289e99eb9        <span class="token number">15</span> months ago       <span class="token number">1</span>.84kB
</code></pre></div><h3 id="_5-7-推送镜像"><a href="#_5-7-推送镜像" class="header-anchor">#</a> 5.7 推送镜像</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker push docker.io/panyangyang/alpine:v3.11.5</span>
The push refers to repository <span class="token punctuation">[</span>docker.io/panyangyang/alpine<span class="token punctuation">]</span>
beee9f30bc1f: Mounted from library/alpine
v3.11.5: digest: sha256:cb8a924afdf0229ef7515d9e5b3024e23b3eb03ddbba287f4a19c6ac90b8d221 size: <span class="token number">528</span>
</code></pre></div><p><img src="/study/assets/img/docker_push.6088b099.png" alt=""></p> <h3 id="_5-8-再给镜像打一个标签（tag）"><a href="#_5-8-再给镜像打一个标签（tag）" class="header-anchor">#</a> 5.8 再给镜像打一个标签（tag）</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker images | grep alpine</span>
alpine               <span class="token number">3.11</span>.5              a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
alpine               latest              a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
panyangyang/alpine   v3.11.5             a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
alpine               <span class="token number">3.10</span>.1              b7b28af77ffe        <span class="token number">9</span> months ago        <span class="token number">5</span>.58MB
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker tag a187dde48cd2 panyangyang/alpine:latest</span>
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker images | grep alpine</span>
alpine               <span class="token number">3.11</span>.5              a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
alpine               latest              a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
panyangyang/alpine   latest              a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
panyangyang/alpine   v3.11.5             a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
alpine               <span class="token number">3.10</span>.1              b7b28af77ffe        <span class="token number">9</span> months ago        <span class="token number">5</span>.58MB
</code></pre></div><h3 id="_5-9-再次推送镜像"><a href="#_5-9-再次推送镜像" class="header-anchor">#</a> 5.9 再次推送镜像</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker push docker.io/panyangyang/alpine:latest</span>
The push refers to repository <span class="token punctuation">[</span>docker.io/panyangyang/alpine<span class="token punctuation">]</span>
beee9f30bc1f: Layer already exists
latest: digest: sha256:cb8a924afdf0229ef7515d9e5b3024e23b3eb03ddbba287f4a19c6ac90b8d221 size: <span class="token number">528</span>
</code></pre></div><p><img src="/study/assets/img/docker_push1.dd2fc4e9.png" alt=""></p> <h3 id="_5-10-删除镜像"><a href="#_5-10-删除镜像" class="header-anchor">#</a> 5.10 删除镜像</h3> <ul><li><p>删除镜像标签</p> <blockquote><p>删除镜像</p> <p>docker rmi [ 镜像名 or 镜像 id ]</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE
alpine               <span class="token number">3.11</span>.5              a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
alpine               latest              a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
panyangyang/alpine   latest              a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
panyangyang/alpine   v3.11.5             a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
alpine               <span class="token number">3.10</span>.1              b7b28af77ffe        <span class="token number">9</span> months ago        <span class="token number">5</span>.58MB
hello-world          latest              fce289e99eb9        <span class="token number">15</span> months ago       <span class="token number">1</span>.84kB
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker rmi docker.io/panyangyang/alpine:latest</span>
Untagged: panyangyang/alpine:latest
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker images | grep alpine</span>
alpine               <span class="token number">3.11</span>.5              a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
alpine               latest              a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
panyangyang/alpine   v3.11.5             a187dde48cd2        <span class="token number">2</span> weeks ago         <span class="token number">5</span>.6MB
alpine               <span class="token number">3.10</span>.1              b7b28af77ffe        <span class="token number">9</span> months ago        <span class="token number">5</span>.58MB

</code></pre></div></li> <li><p>删除镜像</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker rmi a187dde48cd2</span>
Error response from daemon: conflict: unable to delete a187dde48cd2 <span class="token punctuation">(</span>must be forced<span class="token punctuation">)</span> - image is referenced <span class="token keyword">in</span> multiple repositories
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker rmi -f a187dde48cd2</span>
Untagged: alpine:3.11.5
Untagged: alpine:latest
Untagged: alpine@sha256:b276d875eeed9c7d3f1cfa7edb06b22ed22b14219a7d67c52c56612330348239
Untagged: panyangyang/alpine:v3.11.5
Untagged: panyangyang/alpine@sha256:cb8a924afdf0229ef7515d9e5b3024e23b3eb03ddbba287f4a19c6ac90b8d221
Deleted: sha256:a187dde48cd289ac374ad8539930628314bc581a481cdb41409c9289419ddb72
Deleted: sha256:beee9f30bc1f711043e78d4a2be0668955d4b761d587d6f60c2c8dc081efb203
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker images | grep alpine</span>
alpine              <span class="token number">3.10</span>.1              b7b28af77ffe        <span class="token number">9</span> months ago        <span class="token number">5</span>.58MB
</code></pre></div><p>上面这两种方式都是针对本地 docker 镜像的操作。dockerhub仓库中依然存在，可以使用 <code>docker pull</code> 命令拉取。</p></li></ul> <h2 id="第-6-章-docker-镜像特性"><a href="#第-6-章-docker-镜像特性" class="header-anchor">#</a> 第 6 章 Docker 镜像特性</h2> <p><img src="/study/assets/img/docker_feature.a07dec31.png" alt=""></p> <h3 id="_6-1-镜像特性"><a href="#_6-1-镜像特性" class="header-anchor">#</a> 6.1 镜像特性</h3> <p>容器创建是需要指定使用的镜像，每个镜像都由唯一的标识Image ID，默认是128位，可以使用前16位作为缩略形式，也可以使用镜像镜像名和版本号两个部分组合成唯一表示，例如nginx:latest，如果省略版本号，默认使用的是最新版本标签，也就是latest，所以如果默认直接写nginx，其实系统执行的实际命令就是nginx:latest。</p> <h3 id="_6-2-docker-文件系统"><a href="#_6-2-docker-文件系统" class="header-anchor">#</a> 6.2 Docker 文件系统</h3> <p>Linux系统包含内核空间<code>kernal</code>和用户空间<code>rootfs</code>两部分，Docker容器只使用各自的<code>rootfs</code>但共用主机<code>host</code>的内核<code>kernal</code>，这样就产生了镜像结构分层。</p> <p><code>rootfs</code>是Docker容器在启动时内部进程可见的文件系统，也就是Docker容器的根目录。<code>rootfs</code>包含一个操作系统运行所需的文件系统。例如：可能包含典型类UNIX系统中的目录系统<code>/dev/</code>、<code>/proc</code>、<code>/bin</code>、<code>/etc</code>、<code>/usr</code>、<code>/tmp</code>...及运行Docker容器所需的配置文件、工具等。</p> <p><img src="/study/assets/img/docker_fs1.5c6240a4.png" alt=""></p> <p>rootfs</p> <p>在传统Linux内核启动时，首先会挂载一个只读的<code>rootfs</code>，当系统检测其完整性之后，再将其切换为读写模式。而在Docker架构中，当<code>docker daemon</code>为Docker容器改在<code>rootfs</code>时，会沿用Linux内核启动时的做法，也就是将<code>rootfs</code>设置为只读模式。当挂载完毕后，利用联合挂载<code>union mount</code>技术在已有的只读<code>rootfs</code>上再挂载一个读写层。这样，可读写的层处于Docker容器文件系统的最顶层，其下可能联合挂载了多个只读的层，只有在Docker容器运行过程中文件系统发生变化时，才会把变化的文件内容写到可读写层，并隐藏只读层中的旧版本文件。</p> <p>由于所有Docker容器都共用<code>host</code>主机的<code>kernal</code>内核，所以在容器中是不能对Linux内核<code>kernal</code>进行升级的。</p> <p><img src="/study/assets/img/docker_fs2.7a89bc66.png" alt=""></p> <p>所有Docker容器都共用host主机的kernal内核</p> <p>Docker支持通过扩展现有镜像来创建新的镜像，实际上Docker Hub中99%的镜像都是通过在Base镜像中安装和配置需要的软件构建出来的。</p> <p><img src="/study/assets/img/docker_fs3.d2ccefd8.png" alt=""></p> <p>Docker支持通过扩展现有镜像来创建新的镜像</p> <p>一个Docker镜像<code>Images</code>由多个可读的镜像层<code>Read Layer</code>，然后运行的容器会在这个Docker的镜像上多加一层可写的容器层<code>Read-Write Layer</code>，任何对文件的更改都只存在于此容器层，因此任何对容器的操作均不会影响到镜像。</p> <p><img src="/study/assets/img/docker_fs4.317c7017.png" alt=""></p> <p>Docker分层结构</p> <p>容器是如何获取镜像层文件而又不影响镜像层的呢？</p> <p>Docker中如果需要获取某个文件，容器层会从上到下去下一层的镜像层中去获取文件，如果该层文件不存在，那么就会去下一层镜像中寻找，直到最后一层。对于用户而言，用户面对的是一个叠加后的文件系统。</p> <p>任何对于文件的操作都会记录在容器层，例如：修改文件时容器层会把在镜像层找到的文件拷贝到容器层然后进行修改，删除文件时则会在容器层内记录删除文件的条目。</p> <p><img src="/study/assets/img/docker_fs5.7060d626.png" alt=""></p> <p>容器层会从上到下去下一层的镜像层中去获取文件</p> <p>当容器启动时，一个新的可写层<code>writable</code>被加载到镜像的顶部，这一层通常被称为容器层<code>container</code>，容器层之下的都叫做镜像层。</p> <p>典型的Linux在启动后，会将<code>rootfs</code>置为只读<code>readonly</code>并进行一些列检查，然后将其切换为可读写<code>readwrite</code>供用户使用。在Docker中起初也是将<code>rootfs</code>以只读的<code>readonly</code>的方式加载并检查，然后接下来利用<code>union mount</code>联合挂载将一个<code>readwrite</code>文件系统挂载在<code>readonly</code>的<code>rootfs</code>之上，并且允许再次将下层的文件系统设定为只读<code>readonly</code>，并向上叠加。这样一组只读<code>readonly</code>和一个可写<code>writeable</code>的结果就构成了一个容器<code>container</code>的运行目录，每个镜像被称为一层<code>layer</code>。</p> <p><img src="/study/assets/img/docker_fs6.66bf41b9.png" alt=""></p> <p>Docker镜像为什么要采用分层结果呢？</p> <ul><li>每个软件都是基于某个镜像去运行的，因此一旦某个底层环境出现问题，就不需要去修改全部基于该镜像的软件的镜像，只需要修改底层环境的镜像。</li> <li>共享资源，其它相同环境的软件镜像都共同去享用同一个环境镜像，而不需要每个软件镜像要去创建一个底层环境。</li></ul> <h2 id="第-7-章-docker-容器的基本操作"><a href="#第-7-章-docker-容器的基本操作" class="header-anchor">#</a> 第 7 章 Docker 容器的基本操作</h2> <h3 id="_7-1-启动容器（运行镜像）"><a href="#_7-1-启动容器（运行镜像）" class="header-anchor">#</a> 7.1 启动容器（运行镜像）</h3> <blockquote><p>docker run 是日常用的最频繁的命令之一，同样也是较为复杂的命令之一</p> <p>命令格式：docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</p> <p>OPTIONS: 选项</p> <p>-i：表示启动一个可交互的容器，并持续打开标准输入</p> <p>-t：表示使用终端关联到容器的标准输入输出上</p> <p>-d：表示将容器放置在后台运行</p> <p>--rm：退出后即删除容器</p> <p>--name：表示定义容器的唯一名称</p> <p>IMAGE：表示要运行的镜像</p> <p>COMMAD：表示启动容器时要运行的命令</p> <p>ARG: 参数</p></blockquote> <h4 id="_7-1-1-交互式启动一个容器"><a href="#_7-1-1-交互式启动一个容器" class="header-anchor">#</a> 7.1.1 交互式启动一个容器</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker images | grep alpine</span>
alpine              <span class="token number">3.10</span>.1              b7b28af77ffe        <span class="token number">9</span> months ago        <span class="token number">5</span>.58MB
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker run -it alpine:3.10.1 /bin/sh</span>
/ <span class="token comment"># ip addr</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
<span class="token number">10</span>: eth0@if11: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.2/16 brd <span class="token number">172.17</span>.255.255 scope global eth0
       valid_lft forever preferred_lft forever
/ <span class="token comment"># cat /etc/issue</span>
Welcome to Alpine Linux <span class="token number">3.10</span>
Kernel <span class="token punctuation">\</span>r on an <span class="token punctuation">\</span>m <span class="token punctuation">(</span><span class="token punctuation">\</span>l<span class="token punctuation">)</span>

/ <span class="token comment"># exit</span>
</code></pre></div><h4 id="_7-1-2-非交互式启动一个容器（退出即删除）"><a href="#_7-1-2-非交互式启动一个容器（退出即删除）" class="header-anchor">#</a> 7.1.2 非交互式启动一个容器（退出即删除）</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker run --rm alpine:3.10.1 /bin/echo helloword</span>
helloword
</code></pre></div><h4 id="_7-1-3-非交互式启动一个后台运行容器"><a href="#_7-1-3-非交互式启动一个后台运行容器" class="header-anchor">#</a> 7.1.3 非交互式启动一个后台运行容器</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker run -d --name myalpine alpine:3.10.1 /bin/sleep 300</span>
5b9ef79b22e0b341c60db85ee443cb14deff85a41c2fb9e0abd00405e6c445bd
</code></pre></div><blockquote><p>300秒后自动结束</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span>
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES
5b9ef79b22e0        alpine:3.10.1       <span class="token string">&quot;/bin/sleep 300&quot;</span>    <span class="token number">52</span> seconds ago      Up <span class="token number">51</span> seconds                                  myalpine
3f656d915af5        alpine:3.10.1       <span class="token string">&quot;/bin/sh&quot;</span>           <span class="token number">10</span> minutes ago      Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">8</span> minutes ago                       sad_sutherland
d6cea5dc8306        hello-world         <span class="token string">&quot;/hello&quot;</span>            <span class="token number">2</span> days ago          Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">2</span> days ago                          upbeat_gagarin
5f481479f560        hello-world         <span class="token string">&quot;/hello&quot;</span>            <span class="token number">2</span> days ago          Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">2</span> days ago                          vibrant_jang
</code></pre></div><h3 id="_7-2-查看容器"><a href="#_7-2-查看容器" class="header-anchor">#</a> 7.2 查看容器</h3> <h4 id="_7-2-1-查看运行中的容器"><a href="#_7-2-1-查看运行中的容器" class="header-anchor">#</a> 7.2.1 查看运行中的容器</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
8fa336f37fce        alpine:3.10.1       <span class="token string">&quot;/bin/sleep 300&quot;</span>    <span class="token number">3</span> seconds ago       Up <span class="token number">2</span> seconds                            myalpine1
</code></pre></div><h4 id="_7-2-2-查看所有容器"><a href="#_7-2-2-查看所有容器" class="header-anchor">#</a> 7.2.2 查看所有容器</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span>
CONTAINER ID        IMAGE               COMMAND             CREATED              STATUS                      PORTS               NAMES
8fa336f37fce        alpine:3.10.1       <span class="token string">&quot;/bin/sleep 300&quot;</span>    About a minute ago   Up About a minute                               myalpine1
5b9ef79b22e0        alpine:3.10.1       <span class="token string">&quot;/bin/sleep 300&quot;</span>    <span class="token number">20</span> minutes ago       Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">15</span> minutes ago                       myalpine
3f656d915af5        alpine:3.10.1       <span class="token string">&quot;/bin/sh&quot;</span>           <span class="token number">30</span> minutes ago       Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">28</span> minutes ago                       sad_sutherland
d6cea5dc8306        hello-world         <span class="token string">&quot;/hello&quot;</span>            <span class="token number">2</span> days ago           Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">2</span> days ago                           upbeat_gagarin
5f481479f560        hello-world         <span class="token string">&quot;/hello&quot;</span>            <span class="token number">2</span> days ago           Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">2</span> days ago                           vibrant_jang
</code></pre></div><h4 id="_7-2-3-查看docker在宿主机上的进程"><a href="#_7-2-3-查看docker在宿主机上的进程" class="header-anchor">#</a> 7.2.3 查看docker在宿主机上的进程</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># ps aux | grep sleep | grep -v grep</span>
root      <span class="token number">8204</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>   <span class="token number">1540</span>   <span class="token number">248</span> ?        Ss   <span class="token number">22</span>:37   <span class="token number">0</span>:00 /bin/sleep <span class="token number">300</span>
</code></pre></div><h3 id="_7-3-进入容器"><a href="#_7-3-进入容器" class="header-anchor">#</a> 7.3 进入容器</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it c41274eb760f /bin/sh</span>
/ <span class="token comment"># ps aux</span>
PID   <span class="token environment constant">USER</span>     TIME  COMMAND
    <span class="token number">1</span> root      <span class="token number">0</span>:00 /bin/sleep <span class="token number">300</span>
    <span class="token number">6</span> root      <span class="token number">0</span>:00 /bin/sh
   <span class="token number">11</span> root      <span class="token number">0</span>:00 <span class="token function">ps</span> aux
/ <span class="token comment">#</span>

</code></pre></div><h3 id="_7-4-停止-启动-重启容器"><a href="#_7-4-停止-启动-重启容器" class="header-anchor">#</a> 7.4 停止/启动/重启容器</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 停止容器</span>
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker stop c41274eb760f</span>
c41274eb760f
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span>
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                       PORTS               NAMES
c41274eb760f        alpine:3.10.1       <span class="token string">&quot;/bin/sleep 300&quot;</span>    <span class="token number">2</span> minutes ago       Exited <span class="token punctuation">(</span><span class="token number">137</span><span class="token punctuation">)</span> <span class="token number">6</span> seconds ago                       myalpine2
8fa336f37fce        alpine:3.10.1       <span class="token string">&quot;/bin/sleep 300&quot;</span>    <span class="token number">11</span> minutes ago      Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">6</span> minutes ago                         myalpine1
5b9ef79b22e0        alpine:3.10.1       <span class="token string">&quot;/bin/sleep 300&quot;</span>    <span class="token number">30</span> minutes ago      Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">25</span> minutes ago                        myalpine
3f656d915af5        alpine:3.10.1       <span class="token string">&quot;/bin/sh&quot;</span>           <span class="token number">40</span> minutes ago      Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">38</span> minutes ago                        sad_sutherland
d6cea5dc8306        hello-world         <span class="token string">&quot;/hello&quot;</span>            <span class="token number">2</span> days ago          Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">2</span> days ago                            upbeat_gagarin
5f481479f560        hello-world         <span class="token string">&quot;/hello&quot;</span>            <span class="token number">2</span> days ago          Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">2</span> days ago                            vibrant_jang

<span class="token comment"># 启动容器</span>
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker start c41274eb760f</span>
c41274eb760f
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker ps -aa</span>
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES
c41274eb760f        alpine:3.10.1       <span class="token string">&quot;/bin/sleep 300&quot;</span>    <span class="token number">3</span> minutes ago       Up <span class="token number">15</span> seconds                                   myalpine2
8fa336f37fce        alpine:3.10.1       <span class="token string">&quot;/bin/sleep 300&quot;</span>    <span class="token number">12</span> minutes ago      Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">7</span> minutes ago                        myalpine1
5b9ef79b22e0        alpine:3.10.1       <span class="token string">&quot;/bin/sleep 300&quot;</span>    <span class="token number">31</span> minutes ago      Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">26</span> minutes ago                       myalpine
3f656d915af5        alpine:3.10.1       <span class="token string">&quot;/bin/sh&quot;</span>           <span class="token number">40</span> minutes ago      Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">39</span> minutes ago                       sad_sutherland
d6cea5dc8306        hello-world         <span class="token string">&quot;/hello&quot;</span>            <span class="token number">2</span> days ago          Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">2</span> days ago                           upbeat_gagarin
5f481479f560        hello-world         <span class="token string">&quot;/hello&quot;</span>            <span class="token number">2</span> days ago          Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">2</span> days ago                           vibrant_jang

<span class="token comment"># 重启容器</span>
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker restart c41274eb760f</span>
c41274eb760f
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span>
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES
c41274eb760f        alpine:3.10.1       <span class="token string">&quot;/bin/sleep 300&quot;</span>    <span class="token number">3</span> minutes ago       Up <span class="token number">3</span> seconds                                    myalpine2
8fa336f37fce        alpine:3.10.1       <span class="token string">&quot;/bin/sleep 300&quot;</span>    <span class="token number">12</span> minutes ago      Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">7</span> minutes ago                        myalpine1
5b9ef79b22e0        alpine:3.10.1       <span class="token string">&quot;/bin/sleep 300&quot;</span>    <span class="token number">31</span> minutes ago      Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">26</span> minutes ago                       myalpine
3f656d915af5        alpine:3.10.1       <span class="token string">&quot;/bin/sh&quot;</span>           <span class="token number">41</span> minutes ago      Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">39</span> minutes ago                       sad_sutherland
d6cea5dc8306        hello-world         <span class="token string">&quot;/hello&quot;</span>            <span class="token number">2</span> days ago          Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">2</span> days ago                           upbeat_gagarin
5f481479f560        hello-world         <span class="token string">&quot;/hello&quot;</span>            <span class="token number">2</span> days ago          Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">2</span> days ago                           vibrant_jang

</code></pre></div><blockquote><p>上面操作也可以使用 容器名称（NAMES) 替换 容器ID（CONTAINER ID)</p></blockquote> <h3 id="_7-5-删除容器"><a href="#_7-5-删除容器" class="header-anchor">#</a> 7.5 删除容器</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker rm myalpine2</span>
Error response from daemon: You cannot remove a running container c41274eb760fabd08daff92a6f35ba84ba06b9212a4fbd3c9ea6bb638f7d272b. Stop the container before attempting removal or force remove
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker rm myalpine1</span>
myalpine1
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker rm -f myalpine2</span>
myalpine2
</code></pre></div><h4 id="_7-5-1-常用清除-docker-中容器状态为-exited-的容器脚本"><a href="#_7-5-1-常用清除-docker-中容器状态为-exited-的容器脚本" class="header-anchor">#</a> 7.5.1  常用清除 docker 中容器状态为 <code>Exited</code> 的容器脚本</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># for i in `docker ps -a|grep -i exit|awk '{print $1}'`;do docker rm -f $i;done</span>
3f656d915af5
d6cea5dc8306
5f481479f560
</code></pre></div><h3 id="_7-6-修改-提交容器"><a href="#_7-6-修改-提交容器" class="header-anchor">#</a> 7.6 修改/提交容器</h3> <h4 id="_7-5-1-修改容器"><a href="#_7-5-1-修改容器" class="header-anchor">#</a> 7.5.1 修改容器</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it 5b9ef79b22e0 /bin/sh</span>
/ <span class="token comment"># pwd</span>
/
/ <span class="token comment"># ls</span>
bin    dev    etc    home   lib    media  mnt    opt    proc   root   run    sbin   srv    sys    tmp    usr    var
/ <span class="token comment"># echo hello &gt; a.txt</span>
/ <span class="token comment"># ls</span>
a.txt  bin    dev    etc    home   lib    media  mnt    opt    proc   root   run    sbin   srv    sys    tmp    usr    var
</code></pre></div><blockquote><p>a.txt 被写入到容器的 writable 层，它会保存一直都容器结束，再重启容器就会被清除</p></blockquote> <h4 id="_7-6-2-提交容器"><a href="#_7-6-2-提交容器" class="header-anchor">#</a> 7.6.2 提交容器</h4> <blockquote><p>**docker commit 😗*从容器创建一个新的镜像。</p> <p>语法：</p> <p>docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</p> <p>OPTIONS说明：</p> <ul><li>**-a 😗*提交的镜像作者；啊</li> <li>**-c 😗*使用Dockerfile指令来创建镜像；</li> <li>**-m 😗*提交时的说明文字；</li> <li>**-p 😗*在commit时，将容器暂停。</li></ul></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker commit -p myalpine myalpine:v3.10.2_with_a.txt</span>
sha256:4cbb40d64f7242278f816063e64b4d650a59d32cdcc98b734b18090ef5668a6e
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY          TAG                  IMAGE ID            CREATED             SIZE
myalpine            v3.10.2_with_a.txt   4cbb40d64f72        <span class="token number">8</span> seconds ago       <span class="token number">5</span>.58MB
alpine              <span class="token number">3.10</span>.1               b7b28af77ffe        <span class="token number">9</span> months ago        <span class="token number">5</span>.58MB
hello-world         latest               fce289e99eb9        <span class="token number">15</span> months ago       <span class="token number">1</span>.84kB
</code></pre></div><h3 id="_7-7-导出-导入镜像"><a href="#_7-7-导出-导入镜像" class="header-anchor">#</a> 7.7 导出/导入镜像</h3> <h4 id="_7-7-1-导出镜像"><a href="#_7-7-1-导出镜像" class="header-anchor">#</a> 7.7.1 导出镜像</h4> <blockquote><p>打包本地镜像</p> <p>docker save [ 镜像名 or 镜像 id ] &gt; [ 文件路径 ]</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY          TAG                  IMAGE ID            CREATED             SIZE
myalpine            v3.10.2_with_a.txt   4cbb40d64f72        <span class="token number">3</span> minutes ago       <span class="token number">5</span>.58MB
alpine              <span class="token number">3.10</span>.1               b7b28af77ffe        <span class="token number">9</span> months ago        <span class="token number">5</span>.58MB
hello-world         latest               fce289e99eb9        <span class="token number">15</span> months ago       <span class="token number">1</span>.84kB
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker save 4cbb40d64f72 &gt; myalipine:v3.10.2_with_a.txt.tar</span>
</code></pre></div><h4 id="_7-7-2-导入镜像"><a href="#_7-7-2-导入镜像" class="header-anchor">#</a> 7.7.2 导入镜像</h4> <blockquote><p>导入镜像</p> <p>docker load &lt; [ 文件路径 ]</p> <p>修改镜像tag</p> <p>docker tag [ 镜像名 or 镜像 id ] [ 新镜像名 ]:[ 新 tag ]</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker load &lt; alpine\:v3.10.1_back.tar</span>
Loaded image ID: sha256:b7b28af77ffec6054d13378df4fdf02725830086c7444d9c278af25312aa39b9
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
<span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>              <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>              b7b28af77ffe        <span class="token number">9</span> months ago        <span class="token number">5</span>.58MB
hello-world         latest              fce289e99eb9        <span class="token number">15</span> months ago       <span class="token number">1</span>.84kB
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker tag b7b28af77ffe alipine:v3.10.1</span>
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
alipine             v3.10.1             b7b28af77ffe        <span class="token number">9</span> months ago        <span class="token number">5</span>.58MB
hello-world         latest              fce289e99eb9        <span class="token number">15</span> months ago       <span class="token number">1</span>.84kB
</code></pre></div><h3 id="_7-8-查看容器日志"><a href="#_7-8-查看容器日志" class="header-anchor">#</a> 7.8 查看容器日志</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker run hello-world 2&gt;&amp;1 &gt;&gt;/dev/null</span>
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a|grep hello</span>
14ea2fcb0e98        hello-world         <span class="token string">&quot;/hello&quot;</span>            <span class="token number">12</span> seconds ago      Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">11</span> seconds ago                       youthful_brahmagupta
34674d3c7f92        hello-world         <span class="token string">&quot;/hello&quot;</span>            <span class="token number">57</span> seconds ago      Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">56</span> seconds ago                       gallant_carson
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker logs -f 14ea2fcb0e98</span>

Hello from Docker<span class="token operator">!</span>
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 <span class="token number">1</span>. The Docker client contacted the Docker daemon.
 <span class="token number">2</span>. The Docker daemon pulled the <span class="token string">&quot;hello-world&quot;</span> image from the Docker Hub.
    <span class="token punctuation">(</span>amd64<span class="token punctuation">)</span>
 <span class="token number">3</span>. The Docker daemon created a new container from that image <span class="token function">which</span> runs the
    executable that produces the output you are currently reading.
 <span class="token number">4</span>. The Docker daemon streamed that output to the Docker client, <span class="token function">which</span> sent it
    to your terminal.

To try something <span class="token function">more</span> ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu <span class="token function">bash</span>

Share images, automate workflows, and <span class="token function">more</span> with a <span class="token function">free</span> Docker ID:
 https://hub.docker.com/

For <span class="token function">more</span> examples and ideas, visit:
 https://docs.docker.com/get-started/

</code></pre></div><blockquote><p><strong>1、文件描述符</strong>
Linux系统预留可三个文件描述符：0、1和2，他们的意义如下所示：
0——标准输入（stdin）
1——标准输出（stdout）
2——标准错误（stderr）</p> <p><strong>2、区别</strong></p> <p>2&gt;/dev/null
意思就是把错误输出到“黑洞”</p> <p>/dev/null 2&gt;&amp;1
默认情况是1，也就是等同于1&gt;/dev/null 2&gt;&amp;1。意思就是把标准输出重定向到“黑洞”，还把错误输出2重定向到标准输出1，也就是标准输出和错误输出都进了“黑洞”</p> <p>2&gt;&amp;1 &gt;/dev/null
意思就是把错误输出2重定向到标准出书1，也就是屏幕，标准输出进了“黑洞”，也就是标准输出进了黑洞，错误输出打印到屏幕</p></blockquote> <h2 id="第-8-章-docker-容器的高级操作"><a href="#第-8-章-docker-容器的高级操作" class="header-anchor">#</a> 第 8 章 Docker 容器的高级操作</h2> <h3 id="_8-1-下载-nginx-镜像"><a href="#_8-1-下载-nginx-镜像" class="header-anchor">#</a> 8.1 下载 Nginx 镜像</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker pull nginx:1.12.2</span>
<span class="token number">1.12</span>.2: Pulling from library/nginx
f2aa67a397c4: Pull complete 
e3eaf3d87fe0: Pull complete 
38cb13c1e4c9: Pull complete 
Digest: sha256:72daaf46f11cc753c4eab981cbf869919bd1fee3d2170a2adeac12400f494728
Status: Downloaded newer image <span class="token keyword">for</span> nginx:1.12.2
docker.io/library/nginx:1.12.2
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker images|grep nginx</span>
nginx               <span class="token number">1.12</span>.2              4037a5562b03        <span class="token number">23</span> months ago       108MB
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker tag 4037a5562b03 panyangyang/nginx:v1.12.2</span>
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker images|grep nginx</span>
panyangyang/nginx   v1.12.2             4037a5562b03        <span class="token number">23</span> months ago       108MB
nginx               <span class="token number">1.12</span>.2              4037a5562b03        <span class="token number">23</span> months ago       108MB
</code></pre></div><h3 id="_8-2-映射端口"><a href="#_8-2-映射端口" class="header-anchor">#</a> 8.2 映射端口</h3> <blockquote><p>映射端口</p> <p>docker run -p 容器外端口(hostPort):容器内端口(containerPort) 可指定多个</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># docker run --name mynginx -d -p81:80 panyangyang/nginx:v1.12.2</span>
089698e2901c289dcbf9fd925c7ba4b941b98ba8ae590104c94c35e7d1020970
</code></pre></div><h3 id="_8-3-挂载数据卷"><a href="#_8-3-挂载数据卷" class="header-anchor">#</a> 8.3 挂载数据卷</h3> <blockquote><p>挂载数据卷</p> <p>docker run -v 容器外目录:容器内目录</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># mkdir html</span>
<span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># cd html/</span>
<span class="token punctuation">[</span>root@thtf-02 html<span class="token punctuation">]</span><span class="token comment"># wget www.baidu.com -O index.html</span>
--2020-04-10 <span class="token number">14</span>:53:32--  http://www.baidu.com/
正在解析主机 www.baidu.com <span class="token punctuation">(</span>www.baidu.com<span class="token punctuation">)</span><span class="token punctuation">..</span>. <span class="token number">61.135</span>.169.121, <span class="token number">61.135</span>.169.125, <span class="token number">2408</span>:80f0:410c:1d:0:ff:b07a:39af, <span class="token punctuation">..</span>.
正在连接 www.baidu.com <span class="token punctuation">(</span>www.baidu.com<span class="token punctuation">)</span><span class="token operator">|</span><span class="token number">61.135</span>.169.121<span class="token operator">|</span>:80<span class="token punctuation">..</span>. 已连接。
已发出 HTTP 请求，正在等待回应<span class="token punctuation">..</span>. <span class="token number">200</span> OK
长度：2381 <span class="token punctuation">(</span><span class="token number">2</span>.3K<span class="token punctuation">)</span> <span class="token punctuation">[</span>text/html<span class="token punctuation">]</span>
正在保存至: “index.html”

<span class="token number">100</span>%<span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token number">2,381</span>       --.-K/s 用时 0s      

<span class="token number">2020</span>-04-10 <span class="token number">14</span>:53:32 <span class="token punctuation">(</span><span class="token number">179</span> MB/s<span class="token punctuation">)</span> - 已保存 “index.html” <span class="token punctuation">[</span><span class="token number">2381</span>/2381<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@thtf-02 html<span class="token punctuation">]</span><span class="token comment"># docker run -d --name nginx_with_baidu -d -p8100:8100 -v/root/html:/usr/share/nginx/html panyangyang/nginx:v1.12.2</span>
40564e2f9b37f870df785ff78fa16ef9e6bbcf6016b68a0be62ba545e0e463ff
</code></pre></div><h3 id="_8-4-传递环境变量"><a href="#_8-4-传递环境变量" class="header-anchor">#</a> 8.4 传递环境变量</h3> <blockquote><p>传递环境变量</p> <p>docker run -e 环境变量名=环境变量值</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 html<span class="token punctuation">]</span><span class="token comment"># docker run --rm -e E_OPTS=abc alipine:v3.10.1 printenv</span>
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
<span class="token assign-left variable"><span class="token environment constant">HOSTNAME</span></span><span class="token operator">=</span>f61a865a517c
<span class="token assign-left variable">E_OPTS</span><span class="token operator">=</span>abc
<span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span>/root
</code></pre></div><h3 id="_8-5-容器内安装软件"><a href="#_8-5-容器内安装软件" class="header-anchor">#</a> 8.5 容器内安装软件</h3> <blockquote><p>容器内安装软件</p> <p>yum/apt-get/apt等</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 html<span class="token punctuation">]</span><span class="token comment"># docker exec -it nginx_with_baidu /bin/bash</span>
root@40564e2f9b37:/<span class="token comment"># apt-get install vim</span>
<span class="token punctuation">..</span>.
root@40564e2f9b37:/<span class="token comment"># apt-get install curl</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 html<span class="token punctuation">]</span><span class="token comment"># docker commit -p 40564e2f9b37 panyangyang/nginx:curl</span>
sha256:a0fda12de6e676b1cd8d92f9cf08b21ec41eddef24bfe25fb7a6341e07cd894e
<span class="token punctuation">[</span>root@thtf-02 html<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
panyangyang/nginx   <span class="token function">curl</span>                a0fda12de6e6        <span class="token number">4</span> seconds ago       179MB
alipine             v3.10.1             b7b28af77ffe        <span class="token number">9</span> months ago        <span class="token number">5</span>.58MB
hello-world         latest              fce289e99eb9        <span class="token number">15</span> months ago       <span class="token number">1</span>.84kB
nginx               <span class="token number">1.12</span>.2              4037a5562b03        <span class="token number">23</span> months ago       108MB
panyangyang/nginx   v1.12.2             4037a5562b03        <span class="token number">23</span> months ago       108MB
<span class="token punctuation">[</span>root@thtf-02 html<span class="token punctuation">]</span><span class="token comment"># docker push panyangyang/nginx:curl</span>
The push refers to repository <span class="token punctuation">[</span>docker.io/panyangyang/nginx<span class="token punctuation">]</span>
c26ae4ec4c41: Pushed 
4258832b2570: Mounted from library/nginx 
683a28d1d7fd: Mounted from library/nginx 
d626a8ad97a1: Mounted from library/nginx 
curl: digest: sha256:e5ce5fe7ceef8b60414fe602c202da67dfa48515a37a43f357f110fda4c327d7 size: <span class="token number">1160</span>
</code></pre></div><p><img src="/study/assets/img/docker_curl.e0aca19c.png" alt=""></p> <h2 id="第-9-章-容器的生命周期"><a href="#第-9-章-容器的生命周期" class="header-anchor">#</a> 第 9 章 容器的生命周期</h2> <ul><li>检查本地是否存在镜像，如果不存在即从远端仓库检索</li> <li>利用镜像启动容器</li> <li>分配一个文件系统，并在只读的镜像层外挂一层可读写层</li> <li>从宿主机配置的网桥接口中桥接一个虚拟接口到容器</li> <li>从地址池配置一个 ip 地址给容器</li> <li>执行用户指定的指令</li> <li>执行完毕后容器终止</li></ul> <p><img src="/study/assets/img/docker_life.cf3457c6.png" alt=""></p> <h2 id="第-10-章-dockerfile"><a href="#第-10-章-dockerfile" class="header-anchor">#</a> 第 10 章 Dockerfile</h2> <h3 id="_10-1-dockerfile-概述"><a href="#_10-1-dockerfile-概述" class="header-anchor">#</a> 10.1 Dockerfile 概述</h3> <p><img src="/study/assets/img/dockerfile1.4016fe13.png" alt=""></p> <p><img src="/study/assets/img/dockerfile2.401306c4.png" alt=""></p> <h3 id="_10-2-dockerfile-的规则"><a href="#_10-2-dockerfile-的规则" class="header-anchor">#</a> 10.2 Dockerfile 的规则</h3> <ul><li>格式
<ul><li>#为注释</li> <li>指令（大写）内容（小写）</li> <li>尽管指令是大小写不敏感的, 但是我们强烈建议指令大写, 内容用小写表示</li></ul></li> <li>Docker 是按顺序执行 Dockerfile 里的指令集合的 (从上到下依次执行)</li> <li>每一个 Dockerfile 的第一个非注释指令, 必须是 &quot;FROM&quot; 指令, 用于为镜像文件构建过程中, 指定基准镜像, 后续的指令运行与此基准镜像所提供的运行环境中
<ul><li>实践中, 基准镜像可以是任何可用的镜像文件, 默认情况下, docker build 会在 docker 主机 (本地) 上查找指定的镜像文件, 当其在本地不存在时, 则会从 Docker registry (远端) 上拉取所需镜像文件。</li></ul></li></ul> <h3 id="_10-3-dockerfile-核心指令"><a href="#_10-3-dockerfile-核心指令" class="header-anchor">#</a> 10.3 Dockerfile 核心指令</h3> <ul><li>USER/WORKDIR指令</li> <li>ADD/EXPOSE 指令</li> <li>RUN/ENV 指令</li> <li>CMD/ENTRYPOINT 指令</li></ul> <h4 id="_10-3-1-user-workdir指令"><a href="#_10-3-1-user-workdir指令" class="header-anchor">#</a> 10.3.1 USER/WORKDIR指令</h4> <blockquote><p><strong>docker build</strong> 命令用于使用 Dockerfile 创建镜像。</p> <p>语法</p> <div class="language- extra-class"><pre class="language-text"><code>docker build [OPTIONS] PATH | URL | -
</code></pre></div><p>OPTIONS说明：</p> <ul><li>**-f 😗*指定要使用的Dockerfile路径；</li> <li><strong>--tag, -t:</strong> 镜像的名字及标签，通常 name:tag 或者 name 格式；可以在一次构建中为一个镜像设置多个标签。</li></ul></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment"># cd /data/</span>
<span class="token punctuation">[</span>root@thtf-02 data<span class="token punctuation">]</span><span class="token comment"># mkdir dockerfile</span>
<span class="token punctuation">[</span>root@thtf-02 data<span class="token punctuation">]</span><span class="token comment"># cd dockerfile/</span>
<span class="token punctuation">[</span>root@thtf-02 dockerfile<span class="token punctuation">]</span><span class="token comment"># vi Dockerfile</span>
</code></pre></div><ul><li><strong>Dockerfile</strong></li></ul> <div class="language- extra-class"><pre class="language-text"><code>FROM docker.io/panyangyang/nginx:v1.12.2
USER nginx
WORKDIR /usr/share/nginx/html
</code></pre></div><ul><li><strong>构建镜像</strong></li></ul> <div class="language- extra-class"><pre class="language-text"><code>[root@thtf-02 dockerfile]# docker build . -t docker.io/panyangyang/nginx:v1.12.2_with_user_workdir
Sending build context to Docker daemon  2.048kB
Step 1/3 : FROM docker.io/panyangyang/nginx:v1.12.2
 ---&gt; 4037a5562b03
Step 2/3 : USER nginx
 ---&gt; Running in 36545d309472
Removing intermediate container 36545d309472
 ---&gt; 05d6de7f42ad
Step 3/3 : WORKDIR /usr/share/nginx/html
 ---&gt; Running in a4a948a31b66
Removing intermediate container a4a948a31b66
 ---&gt; cab1c7a07238
Successfully built cab1c7a07238
Successfully tagged panyangyang/nginx:v1.12.2_with_user_workdir

</code></pre></div><ul><li><strong>运行容器</strong></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 dockerfile<span class="token punctuation">]</span><span class="token comment"># docker run --rm -it --name mynginx panyangyang/nginx:v1.12.2_with_user_workdir /bin/bash</span>
nginx@9db9958c5d75:/usr/share/nginx/html$ <span class="token function">whoami</span>
nginx
nginx@9db9958c5d75:/usr/share/nginx/html$ <span class="token builtin class-name">pwd</span>
/usr/share/nginx/html
nginx@9db9958c5d75:/usr/share/nginx/html$ 
</code></pre></div><h4 id="_10-3-21-add-expose-指令"><a href="#_10-3-21-add-expose-指令" class="header-anchor">#</a> 10.3.21 ADD/EXPOSE 指令</h4> <ul><li><strong>Dockerfile</strong></li></ul> <div class="language- extra-class"><pre class="language-text"><code>FROM docker.io/panyangyang/nginx:v1.12.2
ADD index.html /usr/share/nginx/html/index.html
EXPOSE 89
</code></pre></div><ul><li><strong>编译镜像</strong></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 dockerfile<span class="token punctuation">]</span><span class="token comment"># docker build . -t panyangyang/nginx:v1.12.2_with_index_expose</span>
Sending build context to Docker daemon   <span class="token number">5</span>.12kB
Step <span class="token number">1</span>/3 <span class="token builtin class-name">:</span> FROM docker.io/panyangyang/nginx:v1.12.2
 ---<span class="token operator">&gt;</span> 4037a5562b03
Step <span class="token number">2</span>/3 <span class="token builtin class-name">:</span> ADD index.html /usr/share/nginx/html/index.html
 ---<span class="token operator">&gt;</span> a0224035af78
Step <span class="token number">3</span>/3 <span class="token builtin class-name">:</span> EXPOSE <span class="token number">89</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> 074f42b67331
Removing intermediate container 074f42b67331
 ---<span class="token operator">&gt;</span> 9afed29a7ef2
Successfully built 9afed29a7ef2
Successfully tagged panyangyang/nginx:v1.12.2_with_index_expose
</code></pre></div><blockquote><p>EXPOSE &lt;端口1&gt; [&lt;端口2&gt;...]
大家都知道以上代码是Dockerfile中来声明端口的命令，但是你真的了解过它吗？现在我带大家来深入了解我们的EXPOSE命令。</p> <p>首先，我们最应该明确的一点就是，EXPOSE命令只是声明了容器应该打开的端口并没有实际上将它打开!也就是说，如果你不用-p或者-P中指定要映射的端口，你的容器是不会映射端口出去的，从而我们知道我们是没有办法在Dockerfile里面进行端口映射的，我们只能在容器启动的时候或者在docker-compose文件中使用ports来指定将要映射的端口。</p> <p>那我们的EXPOSE能用来干什么呢?第一点就是写在Dockerfile中进行声明，能让运维人员或者后来者知道我们开启了容器的哪些端口。还有一点就是，当我们声明了EXPOSE端口之后，我们使用-P命令进行随机映射的时候，是会对这个端口进行映射的。比如说我们现在对一个tomcat容器进行EXPOSE 9999声明，那么我们进行-P随机映射的时候是会对9999端口进行映射的。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 dockerfile<span class="token punctuation">]</span><span class="token comment"># docker run -d -P --name mynginx1 panyangyang/nginx:v1.12.2_with_index_expose </span>
182da13ed968f1a39b60904a5d61a879d576659e3b77128f9d0d594ed05d7068
<span class="token punctuation">[</span>root@thtf-02 dockerfile<span class="token punctuation">]</span><span class="token comment"># netstat -luntp</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::32769                :::*                    LISTEN      <span class="token number">4484</span>/docker-proxy 
</code></pre></div><h4 id="_10-3-3-run-env-指令"><a href="#_10-3-3-run-env-指令" class="header-anchor">#</a> 10.3.3 RUN/ENV 指令</h4> <ul><li><strong>Dockerfile</strong></li></ul> <div class="language- extra-class"><pre class="language-text"><code>FROM centos:7
ENV VER 9.11.4
RUN yum install bind-$VER -y
</code></pre></div><ul><li><strong>编译镜像</strong></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 dockerfile<span class="token punctuation">]</span><span class="token comment"># docker build . -t panyangyang/bind:v9.9.4_with_env_run</span>
</code></pre></div><ul><li><strong>运行验证</strong></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 dockerfile<span class="token punctuation">]</span><span class="token comment"># docker run -it --rm  panyangyang/bind:v9.9.4_with_env_run /bin/bash</span>
<span class="token punctuation">[</span>root@e9c560ca0f6c /<span class="token punctuation">]</span><span class="token comment"># cat /etc/issue</span>
<span class="token punctuation">\</span>S
Kernel <span class="token punctuation">\</span>r on an <span class="token punctuation">\</span>m

<span class="token punctuation">[</span>root@e9c560ca0f6c /<span class="token punctuation">]</span><span class="token comment"># cat /etc/redhat-release </span>
CentOS Linux release <span class="token number">7.7</span>.1908 <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@e9c560ca0f6c /<span class="token punctuation">]</span><span class="token comment"># printenv</span>
<span class="token assign-left variable"><span class="token environment constant">HOSTNAME</span></span><span class="token operator">=</span>e9c560ca0f6c
<span class="token assign-left variable"><span class="token environment constant">TERM</span></span><span class="token operator">=</span>xterm
<span class="token assign-left variable"><span class="token environment constant">LS_COLORS</span></span><span class="token operator">=</span>rs<span class="token operator">=</span><span class="token number">0</span>:di<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">34</span>:ln<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">36</span>:mh<span class="token operator">=</span>00:pi<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">;</span><span class="token number">33</span>:so<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:do<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:bd<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">;</span><span class="token number">33</span><span class="token punctuation">;</span>01:cd<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">;</span><span class="token number">33</span><span class="token punctuation">;</span>01:or<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">;</span><span class="token number">31</span><span class="token punctuation">;</span>01:mi<span class="token operator">=</span>01<span class="token punctuation">;</span>05<span class="token punctuation">;</span><span class="token number">37</span><span class="token punctuation">;</span><span class="token number">41</span>:su<span class="token operator">=</span><span class="token number">37</span><span class="token punctuation">;</span><span class="token number">41</span>:sg<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">;</span><span class="token number">43</span>:ca<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">;</span><span class="token number">41</span>:tw<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">;</span><span class="token number">42</span>:ow<span class="token operator">=</span><span class="token number">34</span><span class="token punctuation">;</span><span class="token number">42</span>:st<span class="token operator">=</span><span class="token number">37</span><span class="token punctuation">;</span><span class="token number">44</span>:ex<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">32</span>:*.tar<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.tgz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.arc<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.arj<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.taz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.lha<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.lz4<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.lzh<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.lzma<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.tlz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.txz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.tzo<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.t7z<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.zip<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.z<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.Z<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.dz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.gz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.lrz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.lz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.lzo<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.xz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.bz2<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.bz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.tbz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.tbz2<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.tz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.deb<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.rpm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.jar<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.war<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.ear<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.sar<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.rar<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.alz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.ace<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.zoo<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.cpio<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.7z<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.rz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.cab<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">31</span>:*.jpg<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.jpeg<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.gif<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.bmp<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.pbm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.pgm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.ppm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.tga<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.xbm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.xpm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.tif<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.tiff<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.png<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.svg<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.svgz<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.mng<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.pcx<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.mov<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.mpg<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.mpeg<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.m2v<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.mkv<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.webm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.ogm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.mp4<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.m4v<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.mp4v<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.vob<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.qt<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.nuv<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.wmv<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.asf<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.rm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.rmvb<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.flc<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.avi<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.fli<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.flv<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.gl<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.dl<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.xcf<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.xwd<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.yuv<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.cgm<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.emf<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.axv<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.anx<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.ogv<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.ogx<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">35</span>:*.aac<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">36</span>:*.au<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">36</span>:*.flac<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">36</span>:*.mid<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">36</span>:*.midi<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">36</span>:*.mka<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">36</span>:*.mp3<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">36</span>:*.mpc<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">36</span>:*.ogg<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">36</span>:*.ra<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">36</span>:*.wav<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">36</span>:*.axa<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">36</span>:*.oga<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">36</span>:*.spx<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">36</span>:*.xspf<span class="token operator">=</span>01<span class="token punctuation">;</span><span class="token number">36</span>:
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
<span class="token assign-left variable"><span class="token environment constant">PWD</span></span><span class="token operator">=</span>/
<span class="token assign-left variable"><span class="token environment constant">SHLVL</span></span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span>/root
<span class="token assign-left variable">VER</span><span class="token operator">=</span><span class="token number">9.11</span>.4
<span class="token assign-left variable">_</span><span class="token operator">=</span>/usr/bin/printenv
<span class="token punctuation">[</span>root@e9c560ca0f6c /<span class="token punctuation">]</span><span class="token comment"># rpm -qa bind    </span>
bind-9.11.4-9.P2.el7.x86_64
<span class="token punctuation">[</span>root@e9c560ca0f6c /<span class="token punctuation">]</span><span class="token comment"># </span>

</code></pre></div><h4 id="_10-3-4-cmd-entrypoint-指令"><a href="#_10-3-4-cmd-entrypoint-指令" class="header-anchor">#</a> 10.3.4 CMD/ENTRYPOINT 指令</h4> <blockquote><p>CMD在容器运行的时候提供一些命令及参数</p></blockquote> <ul><li><strong>Dockerfile</strong></li></ul> <div class="language- extra-class"><pre class="language-text"><code>FROM centos:7
RUN yum install httpd -y
CMD [&quot;httpd&quot;, &quot;-D&quot;, &quot;FOREGROUND&quot;]
</code></pre></div><ul><li><strong>编译镜像</strong></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 dockerfile<span class="token punctuation">]</span><span class="token comment"># docker build . -t panyangyang/bind:v9.9.4_with_cmd</span>
</code></pre></div><p><strong>ENTRYPOINT</strong></p> <p>ENTRYPOINT 的格式和 RUN 指令格式一样，分为 exec 格式和 shell 格式。</p> <p>ENTRYPOINT 的目的和 CMD 一样，都是在指定容器启动程序及参数。</p> <p>ENTRYPOINT 在运行时也可以替代，不过比 CMD 要略显繁琐，需要通过docker run 的参数 --entrypoint 来指定。</p> <p>当指定了 ENTRYPOINT 后， CMD 的含义就发生了改变，不再是直接的运行其命令，而是将 CMD 的内容作为参数传给 ENTRYPOINT 指令，换句话说实际执行时，将变为：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;ENTRYPOINT&gt; &quot;&lt;CMD&gt;&quot;
</code></pre></div><p>那么有了 CMD 后，为什么还要有 ENTRYPOINT 呢？这种</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;ENTRYPOINT&gt; &quot;&lt;CMD&gt;&quot;
</code></pre></div><p>详细参考：https://www.cnblogs.com/reachos/p/8609025.html</p> <h2 id="第-11-章-docker-网络模型"><a href="#第-11-章-docker-网络模型" class="header-anchor">#</a> 第 11 章 Docker 网络模型</h2> <h3 id="_11-1-nat-默认"><a href="#_11-1-nat-默认" class="header-anchor">#</a> 11.1 NAT (默认)</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment">#  docker run -it --rm alipine:v3.10.1 /bin/sh</span>
/ <span class="token comment"># ip addr</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
<span class="token number">64</span>: eth0@if65: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP 
    link/ether 02:42:ac:11:00:05 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.5/16 brd <span class="token number">172.17</span>.255.255 scope global eth0
       valid_lft forever preferred_lft forever
/ <span class="token comment"># </span>
</code></pre></div><h3 id="_11-2-none"><a href="#_11-2-none" class="header-anchor">#</a> 11.2 None</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment">#  docker run -it --rm --net=none alipine:v3.10.1 /bin/sh</span>
/ <span class="token comment"># ip addr</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
/ <span class="token comment"># </span>
</code></pre></div><h3 id="_11-3-host"><a href="#_11-3-host" class="header-anchor">#</a> 11.3 Host</h3> <p>docker 和 宿主机是同一个网络</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@thtf-02 ~<span class="token punctuation">]</span><span class="token comment">#  docker run -it --rm --net=host alipine:v3.10.1 /bin/sh</span>
/ <span class="token comment"># ip addr</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope <span class="token function">host</span> 
       valid_lft forever preferred_lft forever
<span class="token number">2</span>: ens32: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP qlen <span class="token number">1000</span>
    link/ether 00:50:56:a0:26:80 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">10.10</span>.50.249/24 brd <span class="token number">10.10</span>.50.255 scope global ens32
       valid_lft forever preferred_lft forever
    inet <span class="token number">10.10</span>.50.249/8 brd <span class="token number">10.255</span>.255.255 scope global ens32
       valid_lft forever preferred_lft forever
    inet6 fe80::b5ce:75f0:e261:55ef/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
    inet6 fe80::7681:2b3b:cf23:5071/64 scope <span class="token function">link</span> tentative dadfailed 
       valid_lft forever preferred_lft forever
<span class="token number">3</span>: virbr0: <span class="token operator">&lt;</span>NO-CARRIER,BROADCAST,MULTICAST,UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state DOWN qlen <span class="token number">1000</span>
    link/ether <span class="token number">52</span>:54:00:cd:1a:36 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">192.168</span>.122.1/24 brd <span class="token number">192.168</span>.122.255 scope global virbr0
       valid_lft forever preferred_lft forever
<span class="token number">4</span>: virbr0-nic: <span class="token operator">&lt;</span>BROADCAST,MULTICAST<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc pfifo_fast master virbr0 state DOWN qlen <span class="token number">1000</span>
    link/ether <span class="token number">52</span>:54:00:cd:1a:36 brd ff:ff:ff:ff:ff:ff
<span class="token number">5</span>: docker0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP 
    link/ether 02:42:e5:43:75:66 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.1/16 brd <span class="token number">172.17</span>.255.255 scope global docker0
       valid_lft forever preferred_lft forever
    inet6 fe80::42:e5ff:fe43:7566/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token number">41</span>: veth1549e7b@if40: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP 
    link/ether <span class="token number">96</span>:3b:68:21:cc:d9 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::943b:68ff:fe21:ccd9/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token number">51</span>: veth481fe6e@if50: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP 
    link/ether <span class="token number">32</span>:0b:4b:c6:17:71 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::300b:4bff:fec6:1771/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token number">53</span>: vethde451bf@if52: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP 
    link/ether b6:83:89:ee:25:d9 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::b483:89ff:feee:25d9/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
/ <span class="token comment"># </span>

</code></pre></div><h3 id="_11-4-联合网络"><a href="#_11-4-联合网络" class="header-anchor">#</a> 11.4 联合网络</h3></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/study/DevOps/" class="prev router-link-active">
        介绍
      </a></span> <span class="next"><a href="/study/DevOps/Jenkins与Docker的自动化CICD实战.html">
        /DevOps/Jenkins与Docker的自动化CICD实战.html
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/study/assets/js/app.805d6976.js" defer></script><script src="/study/assets/js/2.d79867de.js" defer></script><script src="/study/assets/js/3.373a8979.js" defer></script>
  </body>
</html>
