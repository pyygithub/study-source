(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{332:function(t,s,a){t.exports=a.p+"assets/img/k8s_cs.4c3eef1f.png"},444:function(t,s,a){t.exports=a.p+"assets/img/harbor.d0279e60.png"},445:function(t,s,a){t.exports=a.p+"assets/img/harbor_admin.1639de8c.png"},446:function(t,s,a){t.exports=a.p+"assets/img/harbor_public.15703d1a.png"},447:function(t,s,a){t.exports=a.p+"assets/img/harbor_public_list.5dbf2b26.png"},448:function(t,s,a){t.exports=a.p+"assets/img/harbor_push.c26f187c.png"},449:function(t,s,a){t.exports=a.p+"assets/img/k8s_dashboard.c11755ed.png"},511:function(t,s,a){"use strict";a.r(s);var n=a(19),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"kubernetes-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-2"}},[t._v("#")]),t._v(" Kubernetes-2")]),t._v(" "),n("h2",{attrs:{id:"第-6-章-环境搭建-二进制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第-6-章-环境搭建-二进制"}},[t._v("#")]),t._v(" 第 6 章 环境搭建（二进制）")]),t._v(" "),n("h3",{attrs:{id:"_6-1-准备环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-准备环境"}},[t._v("#")]),t._v(" 6.1 准备环境")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("主机")]),t._v(" "),n("th",[t._v("服务")]),t._v(" "),n("th",[t._v("备注")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("node-01")]),t._v(" "),n("td"),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("node-02")]),t._v(" "),n("td"),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("node-03")]),t._v(" "),n("td"),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("node-04")]),t._v(" "),n("td"),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("node-05")]),t._v(" "),n("td"),t._v(" "),n("td")])])]),t._v(" "),n("ol",[n("li",[n("p",[t._v("关闭 SELinux 和 firewalld")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("systemctl stop firewalld               "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#临时关闭")]),t._v("\n\nsystemctl disable firewalld            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#永久关闭,即设置开机的时候不自动启动")]),t._v("\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("永久关闭selinux可以使用vi命令打开/etc/sysconfig/selinux 文件将SELINUXTYPE=(disable或permissive）\n")])])]),n("p",[t._v("永久关闭selinux可以使用vi命令打开/etc/sysconfig/selinux 文件将SELINUXTYPE=(disable或permissive）")])]),t._v(" "),n("li",[n("p",[t._v("为全部服务器安装 epel-release 源")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" epel-release -y\n")])])])]),t._v(" "),n("li",[n("p",[t._v("为全部服务器安装常用工具")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" telnet net-tools tree nmap sysstat lrzsz dos2unix bind-utils -y\n")])])])])]),t._v(" "),n("h3",{attrs:{id:"_6-2-dns-服务初始化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-dns-服务初始化"}},[t._v("#")]),t._v(" 6.2 DNS 服务初始化")]),t._v(" "),n("h4",{attrs:{id:"_6-2-1-安装-bind9-软件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-1-安装-bind9-软件"}},[t._v("#")]),t._v(" 6.2.1 安装 bind9 软件")]),t._v(" "),n("p",[t._v("在 node-01 上执行命令")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("bind")]),t._v(" -y\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-01 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rpm -qa bind")]),t._v("\nbind-9.11.4-9.P2.el7.x86_64\n")])])]),n("h4",{attrs:{id:"_6-2-2-配置-bind9"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-2-配置-bind9"}},[t._v("#")]),t._v(" 6.2.2 配置 bind9")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("主配置文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/named.conf\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("listen-on port "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("53")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.50"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nallow-query     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" any"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nforwarders      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndnssec-enable no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndnssec-validation no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("​\t检查配置, 没有保存就是 OK")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("name-checkconf\n")])])])]),t._v(" "),n("li",[n("p",[t._v("区域配置文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/named.rfc1912.zones \n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('zone "host.com" IN {\n        type master;\n        file "host.com.zone";\n        allow-update { 10.10.50.50; };\n};\n\nzone "thtf.com" IN {\n        type master;\n        file "thtf.com.zone";\n        allow-update { 10.10.50.50; };\n};\n')])])])]),t._v(" "),n("li",[n("p",[t._v("区域数据文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v("  /var/named/host.com.zone\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("$ORIGIN host.com.\n$TTL 600    ; 10 minutes\n@       IN SOA  dns.host.com. dnsadmin.host.com. (\n                2020032001 ; serial\n                10800      ; refresh (3 hours)\n                900        ; retry (15 minutes)\n                604800     ; expire (1 week)\n                86400      ; minimum (1 day)\n                )\n            NS   dns.host.com.\n$TTL 60 ; 1 minute\ndns                A    10.10.50.50\nnode-01            A    10.10.50.50           \nnode-02            A    10.10.50.20\nnode-03            A    10.10.50.233\nnode-04            A    10.10.50.99\nnode-05            A    10.10.50.40\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v("  /var/named/thtf.com.zone\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("$ORIGIN thtf.com.\n$TTL 600    ; 10 minutes\n@           IN SOA  dns.thtf.com. dnsadmin.thtf.com. (\n                2020032001 ; serial\n                10800      ; refresh (3 hours)\n                900        ; retry (15 minutes)\n                604800     ; expire (1 week)\n                86400      ; minimum (1 day)\n                )\n                NS   dns.thtf.com.\n$TTL 60 ; 1 minute\ndns                A    10.10.50.50\n")])])]),n("p",[t._v("检查配置, 没有保存就是 OK")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("named-checkconf\n")])])])])]),t._v(" "),n("h4",{attrs:{id:"_6-2-3-启动-bind9"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-3-启动-bind9"}},[t._v("#")]),t._v(" 6.2.3 启动 bind9")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-01 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl start named")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-01 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# netstat -lntup|grep 53")]),t._v("\ntcp        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.50:53          "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*               LISTEN      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26226")]),t._v("/named         \ntcp        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:953           "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*               LISTEN      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26226")]),t._v("/named         \ntcp6       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" :::53                   :::*                    LISTEN      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26226")]),t._v("/named         \ntcp6       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" ::1:953                 :::*                    LISTEN      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26226")]),t._v("/named         \nudp        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.50:53          "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*                           "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26226")]),t._v("/named         \nudp6       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" :::53                   :::*                                "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26226")]),t._v("/named \n")])])]),n("h4",{attrs:{id:"_6-2-4-检查-dns-服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-4-检查-dns-服务"}},[t._v("#")]),t._v(" 6.2.4 检查 DNS 服务")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-01 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# dig -t A node-01.host.com @10.10.50.50 +short")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.50\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-01 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# dig -t A node-02.host.com @10.10.50.50 +short")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.20\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-01 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# dig -t A node-03.host.com @10.10.50.50 +short")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.233\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-01 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# dig -t A node-04.host.com @10.10.50.50 +short")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.99\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-01 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# dig -t A node-05.host.com @10.10.50.50 +short")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.40\n")])])]),n("h4",{attrs:{id:"_6-2-5-配置-dns-客户端"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-5-配置-dns-客户端"}},[t._v("#")]),t._v(" 6.2.5 配置 DNS 客户端")]),t._v(" "),n("p",[t._v("全部主机执行下面操作")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/sysconfig/network-scripts/ifcfg-eth0\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DNS1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.50\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/resolv.conf\nsearch host.com\nnameserver "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.50\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("systemctl restart network\n")])])]),n("h3",{attrs:{id:"_6-3-准备签发证书环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-准备签发证书环境"}},[t._v("#")]),t._v(" 6.3 准备签发证书环境")]),t._v(" "),n("p",[t._v("在 node-05 上")]),t._v(" "),n("h4",{attrs:{id:"_6-3-1-安装-cfssl"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-1-安装-cfssl"}},[t._v("#")]),t._v(" 6.3.1 安装 cfssl")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 -O /usr/bin/cfssl\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64 -O /usr/bin/cfssl-json\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64 -O /usr/bin/cfssl-certinfo\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" +x /usr/bin/cfssl*\n")])])]),n("h4",{attrs:{id:"_6-3-2-创建生成ca证书csr的json配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-2-创建生成ca证书csr的json配置文件"}},[t._v("#")]),t._v(" 6.3.2 创建生成ca证书csr的json配置文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" /opt/certs\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v("  /opt/certs/ca-csr.json\n")])])]),n("div",{staticClass:"language-json extra-class"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"CN"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"thtf"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"hosts"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"key"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"algo"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rsa"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"size"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"names"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"C"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CN"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ST"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"beijing"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"L"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"beijing"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"O"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"thtf"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"OU"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ops"')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ca"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"expiry"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"175200h"')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("blockquote",[n("p",[t._v("CN：Common Name, 浏览器使用该字段验证网站是否合法, 一般写的是域名。非常重要。")]),t._v(" "),n("p",[t._v("C：Country, 国家")]),t._v(" "),n("p",[t._v("ST：State, 州, 省")]),t._v(" "),n("p",[t._v("L：Locality 地区 城市")]),t._v(" "),n("p",[t._v("O： Organization Name 组织名称 公司名称")]),t._v(" "),n("p",[t._v("OU：Organization Unit Name 组织单位名称 公司部门")])]),t._v(" "),n("h4",{attrs:{id:"_6-3-3-生成ca证书文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-3-生成ca证书文件"}},[t._v("#")]),t._v(" 6.3.3 生成ca证书文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd /opt/certs")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cfssl gencert -initca ca-csr.json | cfssl-json -bare ca")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("/04/14 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":53:46 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" generating a new CA key and certificate from CSR\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("/04/14 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":53:46 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" generate received request\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("/04/14 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":53:46 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" received CSR\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("/04/14 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":53:46 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" generating key: rsa-2048\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("/04/14 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":53:46 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" encoded CSR\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("/04/14 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":53:46 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" signed certificate with serial number "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("35390055852589240424773939585539235500209661940")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ll")]),t._v("\n总用量 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("989")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":53 ca.csr\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("325")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":53 ca-csr.json\n-rw------- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1675")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":53 ca-key.pem\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1338")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":53 ca.pem\n")])])]),n("h3",{attrs:{id:"_6-4-部署-docker"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-部署-docker"}},[t._v("#")]),t._v(" 6.4 部署 docker")]),t._v(" "),n("p",[t._v("node-03 node-04 node-05上")]),t._v(" "),n("h4",{attrs:{id:"_6-4-1-安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-1-安装"}},[t._v("#")]),t._v(" 6.4.1 安装")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -fsSL https://get.docker.com "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v(" -s docker --mirror Aliyun\n")])])]),n("h4",{attrs:{id:"_6-4-2-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-2-配置"}},[t._v("#")]),t._v(" 6.4.2 配置")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v("  /etc/docker\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v("  /etc/docker/daemon.json\n")])])]),n("div",{staticClass:"language-json extra-class"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"graph"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/data/docker"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"storage-driver"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"overlay2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"insecure-registries"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"registry.access.redhat.com"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"quay.io"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"harbor.thtf.com"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"registry-mirrors"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://q2gr04ke.mirror.aliyuncs.com"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"bip"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"172.7.21.1/24"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"exec-opts"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"native.cgroupdriver=systemd"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"live-restore"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n##########\nbip要根据宿主机ip变化 \n")])])]),n("h4",{attrs:{id:"_6-4-3-启动"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-3-启动"}},[t._v("#")]),t._v(" 6.4.3 启动")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /data/docker\nsystemctl start docker\nsystemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" docker\nl\n")])])]),n("h3",{attrs:{id:"_6-5-部署私有仓库-harbor"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-部署私有仓库-harbor"}},[t._v("#")]),t._v(" 6.5 部署私有仓库 harbor")]),t._v(" "),n("p",[t._v("在 node-05 上")]),t._v(" "),n("h4",{attrs:{id:"_6-5-1-下载软件并解压"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-1-下载软件并解压"}},[t._v("#")]),t._v(" 6.5.1 下载软件并解压")]),t._v(" "),n("p",[t._v("harbor官网github地址 https://github.com/goharbor/harbor")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" xf harbor-offline-installer-v1.8.3.tgz -C /opt/\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" harbor/ harbor-v1.8.3\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s /opt/harbor-v1.8.3/ /opt/harbor\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("lrwxrwxrwx 1 root root  19 4月  14 12:13 harbor -> /opt/harbor-v1.8.3/\ndrwxr-xr-x 2 root root 100 4月  14 12:12 harbor-v1.8.3\ndrwxr-xr-x 2 root root  49 4月  14 12:13 install_package\n")])])]),n("h4",{attrs:{id:"_6-5-2-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-2-配置"}},[t._v("#")]),t._v(" 6.5.2 配置")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /data/harbor/logs\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /opt/harbor/harbor.yml\n")])])]),n("p",[t._v("修改配置：")]),t._v(" "),n("div",{staticClass:"language-yml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" harbor.thtf.com\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("180")]),t._v("\n harbor_admin_password"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Harbor12345\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("data_volume")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /data/harbor\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("level")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  info\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rotate_count")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n    rotate_size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("200M\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("location")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /data/harbor/logs\n")])])]),n("h4",{attrs:{id:"_6-5-3-安装-docker-compose"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-3-安装-docker-compose"}},[t._v("#")]),t._v(" 6.5.3 安装 docker-compose")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" docker-compose -y\n")])])]),n("h4",{attrs:{id:"_6-5-4-安装-harbor"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-4-安装-harbor"}},[t._v("#")]),t._v(" 6.5.4 安装 harbor")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入 harbor 根目录")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 harbor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ll")]),t._v("\n总用量 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("569632")]),t._v("\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("583269670")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v(" harbor.v1.8.3.tar.gz\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4528")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(":19 harbor.yml\n-rwxr-xr-x "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5088")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v(" install.sh\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root     "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11347")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v(" LICENSE\n-rwxr-xr-x "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1654")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2019")]),t._v(" prepare\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 harbor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ./install.sh ")]),t._v("\n")])])]),n("h4",{attrs:{id:"_6-5-5-检查-harbor-启动情况"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-5-检查-harbor-启动情况"}},[t._v("#")]),t._v(" 6.5.5 检查 harbor 启动情况")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 harbor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker-compose ps")]),t._v("\n      Name                     Command               State             Ports          \n--------------------------------------------------------------------------------------\nharbor-core         /harbor/start.sh                 Up                               \nharbor-db           /entrypoint.sh postgres          Up      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5432")]),t._v("/tcp                 \nharbor-jobservice   /harbor/start.sh                 Up                               \nharbor-log          /bin/sh -c /usr/local/bin/ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".   Up      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:1514-"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10514")]),t._v("/tcp\nharbor-portal       nginx -g daemon off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("             Up      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/tcp                   \nnginx               nginx -g daemon off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("             Up      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:180-"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/tcp      \nredis               docker-entrypoint.sh redis "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".   Up      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("/tcp                 \nregistry            /entrypoint.sh /etc/regist "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".   Up      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v("/tcp                 \nregistryctl         /harbor/start.sh                 Up                               \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 harbor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker ps -a")]),t._v("\nCONTAINER ID        IMAGE                                               COMMAND                  CREATED             STATUS                             PORTS                       NAMES\n118479faae3c        goharbor/nginx-photon:v1.8.3                        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx -g \'daemon of…"')]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" seconds ago      Up "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v(" seconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("health: starting"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:180-"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/tcp         nginx\na01be83050a8        goharbor/harbor-portal:v1.8.3                       "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx -g \'daemon of…"')]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),t._v(" seconds ago      Up "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26")]),t._v(" seconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("health: starting"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/tcp                      harbor-portal\nbd00d3fa85cc        goharbor/harbor-jobservice:v1.8.3                   "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/harbor/start.sh"')]),t._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),t._v(" seconds ago      Up "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26")]),t._v(" seconds                                                  harbor-jobservice\n30e39e116f97        goharbor/harbor-core:v1.8.3                         "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/harbor/start.sh"')]),t._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("29")]),t._v(" seconds ago      Up "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" seconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("health: starting"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                               harbor-core\n3ecf74bd9a7b        goharbor/redis-photon:v1.8.3                        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker-entrypoint.s…"')]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" seconds ago      Up "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),t._v(" seconds                      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("/tcp                    redis\n9acf04233a0d        goharbor/harbor-db:v1.8.3                           "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/entrypoint.sh post…"')]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" seconds ago      Up "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),t._v(" seconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("health: starting"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5432")]),t._v("/tcp                    harbor-db\n0795ebef5a5d        goharbor/harbor-registryctl:v1.8.3                  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/harbor/start.sh"')]),t._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" seconds ago      Up "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),t._v(" seconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("health: starting"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                               registryctl\ne36367cf43e8        goharbor/registry-photon:v2.7.1-patch-2819-v1.8.3   "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/entrypoint.sh /etc…"')]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" seconds ago      Up "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),t._v(" seconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("health: starting"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v("/tcp                    registry\n33d5234e3edf        goharbor/harbor-log:v1.8.3                          "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/bin/sh -c /usr/loc…"')]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("31")]),t._v(" seconds ago      Up "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("29")]),t._v(" seconds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("health: starting"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:1514-"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10514")]),t._v("/tcp   harbor-log\n\n")])])]),n("h4",{attrs:{id:"_6-5-6-配置-harbor-的-dns-内网解析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-6-配置-harbor-的-dns-内网解析"}},[t._v("#")]),t._v(" 6.5.6 配置 harbor 的 dns 内网解析")]),t._v(" "),n("p",[t._v("在 node-01 上")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /var/named/thtf.com.zone\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("$ORIGIN thtf.com.\n$TTL 600    ; 10 minutes\n@           IN SOA  dns.thtf.com. dnsadmin.thtf.com. (\n                2020032002 ; serial\n                10800      ; refresh (3 hours)\n                900        ; retry (15 minutes)\n                604800     ; expire (1 week)\n                86400      ; minimum (1 day)\n                )\n                NS   dns.thtf.com.\n$TTL 60 ; 1 minute\ndns                A    10.10.50.50\nharbor             A    10.10.50.40\n")])])]),n("blockquote",[n("p",[t._v("2020032002 ; serial 前滚一个序号")]),t._v(" "),n("p",[t._v("harbor             A    10.10.50.40")])]),t._v(" "),n("p",[t._v("重启 named")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("systemctl restart named\n")])])]),n("p",[t._v("检查")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-01 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# dig -t A harbor.thtf.com +short")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.40\n")])])]),n("h4",{attrs:{id:"_6-5-6-安装-nginx-并配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-6-安装-nginx-并配置"}},[t._v("#")]),t._v(" 6.5.6 安装 Nginx 并配置")]),t._v(" "),n("p",[t._v("在 node-05 上")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" nginx -y\n")])])]),n("p",[t._v("修改配置文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/nginx/conf.d/harbor.thtf.com.conf\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("server {\n    listen       80;\n    server_name  harbor.thtf.com;\n\n    client_max_body_size 1000m;\n\n    location / {\n        proxy_pass http://127.0.0.1:180;\n    }\n}\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 harbor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nginx -t")]),t._v("\nnginx: the configuration "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" /etc/nginx/nginx.conf syntax is ok\nnginx: configuration "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" /etc/nginx/nginx.conf "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" is successful\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 harbor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl start nginx")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 harbor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl enable nginx")]),t._v("\nCreated symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.\n")])])]),n("h4",{attrs:{id:"_6-5-7-测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-7-测试"}},[t._v("#")]),t._v(" 6.5.7 测试")]),t._v(" "),n("ol",[n("li",[t._v("浏览器输入：harbor.thtf.com")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(444),alt:""}})]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[n("p",[t._v("输入用户名：admin 密码：Harbor12345")]),t._v(" "),n("p",[n("img",{attrs:{src:a(445),alt:""}})])]),t._v(" "),n("li",[n("p",[t._v("新建项目：public 访问级别：公开")]),t._v(" "),n("p",[n("img",{attrs:{src:a(446),alt:""}})]),t._v(" "),n("p",[n("img",{attrs:{src:a(447),alt:""}})])]),t._v(" "),n("li",[n("p",[t._v("下载镜像并给镜像打 tag")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 harbor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker pull nginx:1.7.9")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.7")]),t._v(".9: Pulling from library/nginx\nImage docker.io/library/nginx:1.7.9 uses outdated schema1 manifest format. Please upgrade to a schema2 image "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" better future compatibility. More information at https://docs.docker.com/registry/spec/deprecated-schema-v1/\na3ed95caeb02: Pull complete \n6f5424ebd796: Pull complete \nd15444df170a: Pull complete \ne83f073daa67: Pull complete \na4d93e421023: Pull complete \n084adbca2647: Pull complete \nc9cec474c523: Pull complete \nDigest: sha256:e3456c851a152494c3e4ff5fcc26f240206abac0c9d794affb40e0714846c451\nStatus: Downloaded newer image "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" nginx:1.7.9\ndocker.io/library/nginx:1.7.9\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 harbor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker images|grep nginx")]),t._v("\ngoharbor/nginx-photon           v1.8.3                     3a016e0dc7de        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" months ago        37MB\nnginx                           "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.7")]),t._v(".9                      84581e99d807        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" years ago         "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("91")]),t._v(".7MB\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 harbor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker tag 84581e99d807 harbor.thtf.com/public/nginx:v1.7.9")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 harbor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker images|grep nginx")]),t._v("\ngoharbor/nginx-photon           v1.8.3           "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v("           3a016e0dc7de        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" months ago        37MB\nnginx                           "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.7")]),t._v(".9                      84581e99d807        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" years ago         "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("91")]),t._v(".7MB\nharbor.thtf.com/public/nginx     v1.7.9                     84581e99d807        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" years ago         "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("91")]),t._v(".7MB\n\n")])])])]),t._v(" "),n("li",[n("p",[t._v("登录 harbor 并上传仓库")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 harbor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker login harbor.thtf.com")]),t._v("\nAuthenticating with existing credentials"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nWARNING"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" Your password will be stored unencrypted "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" /root/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#credentials-store")]),t._v("\n\nLogin Succeeded\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 harbor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker push harbor.thtf.com/public/nginx:v1.7.9")]),t._v("\nThe push refers to repository "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("harbor.thtf.com/public/nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n5f70bf18a086: Pushed \n4b26ab29a475: Pushed \nccb1d68e3fb7: Pushed \ne387107e2065: Pushed \n63bf84221cce: Pushed \ne02dce553481: Pushed \ndea2e4984e29: Pushed \nv1.7.9: digest: sha256:b1f5935eb2e9e2ae89c0b3e2e148c19068d91ca502e857052f14db230443e4c2 size: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3012")]),t._v("\n\n")])])]),n("p",[t._v("可以看到NGINX镜像已经上传到public下")]),t._v(" "),n("p",[n("img",{attrs:{src:a(448),alt:""}})])])]),t._v(" "),n("h3",{attrs:{id:"_6-6-部署-master-节点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-6-部署-master-节点"}},[t._v("#")]),t._v(" 6.6 部署 master 节点")]),t._v(" "),n("h4",{attrs:{id:"_6-6-1-部署-etch-集群"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-6-1-部署-etch-集群"}},[t._v("#")]),t._v(" 6.6.1 部署 etch 集群")]),t._v(" "),n("h5",{attrs:{id:"_1-集群架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-集群架构"}},[t._v("#")]),t._v(" 1）集群架构")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("主机名")]),t._v(" "),n("th",[t._v("角色")]),t._v(" "),n("th",[t._v("IP")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("node-02")]),t._v(" "),n("td",[t._v("lead")]),t._v(" "),n("td",[t._v("10.10.50.20")])]),t._v(" "),n("tr",[n("td",[t._v("node-03")]),t._v(" "),n("td",[t._v("follow")]),t._v(" "),n("td",[t._v("10.10.50.233")])]),t._v(" "),n("tr",[n("td",[t._v("node-04")]),t._v(" "),n("td",[t._v("follow")]),t._v(" "),n("td",[t._v("10.10.50.99")])])])]),t._v(" "),n("h5",{attrs:{id:"_2-创建基于根证书的config配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建基于根证书的config配置文件"}},[t._v("#")]),t._v(" 2）创建基于根证书的config配置文件")]),t._v(" "),n("p",[t._v("在 node-05 上")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /opt/certs/ca-config.json\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('{\n    "signing": {\n        "default": {\n            "expiry": "175200h"\n        },\n        "profiles": {\n            "server": {\n                "expiry": "175200h",\n                "usages": [\n                    "signing",\n                    "key encipherment",\n                    "server auth"\n                ]\n            },\n            "client": {\n                "expiry": "175200h",\n                "usages": [\n                    "signing",\n                    "key encipherment",\n                    "client auth"\n                ]\n            },\n            "peer": {\n                "expiry": "175200h",\n                "usages": [\n                    "signing",\n                    "key encipherment",\n                    "server auth",\n                    "client auth"\n                ]\n            }\n        }\n    }\n} \n')])])]),n("h5",{attrs:{id:"_3-创建生成自签发证书的csr的json配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建生成自签发证书的csr的json配置文件"}},[t._v("#")]),t._v(" 3）创建生成自签发证书的csr的json配置文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /opt/certs/etcd-peer-csr.json\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('{\n    "CN": "k8s-etcd",\n    "hosts": [\n        "10.10.50.50",\n        "10.10.50.20",\n        "10.10.50.233",\n        "10.10.50.99"\n    ],\n    "key": {\n        "algo": "rsa",\n        "size": 2048\n    },\n    "names": [\n        {\n            "C": "CN",\n            "ST": "beijing",\n            "L": "beijing",\n            "O": "thtf",\n            "OU": "ops"\n        }\n    ]\n}\n')])])]),n("h5",{attrs:{id:"_4-生成-etch-证书文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-生成-etch-证书文件"}},[t._v("#")]),t._v(" 4）生成 etch 证书文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd /opt/certs/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=peer etcd-peer-csr.json |cfssl-json -bare etcd-pee")]),t._v("\n")])])]),n("h5",{attrs:{id:"_5-检查生成的证书"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-检查生成的证书"}},[t._v("#")]),t._v(" 5）检查生成的证书")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ll")]),t._v("\n总用量 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("36")]),t._v("\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("837")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":56 ca-config.json\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("989")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":54 ca.csr\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("325")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":54 ca-csr.json\n-rw------- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1679")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":54 ca-key.pem\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1338")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":54 ca.pem\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1066")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":02 etcd-peer.csr\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("374")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":01 etcd-peer-csr.json\n-rw------- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1675")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":02 etcd-peer-key.pem\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1428")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(":02 etcd-peer.pem\n")])])]),n("h5",{attrs:{id:"_6-创建-etch-用户"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-创建-etch-用户"}},[t._v("#")]),t._v(" 6）创建 etch 用户")]),t._v(" "),n("p",[t._v("在 node-02 上")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# useradd -s /sbin/nologin -M etcd")]),t._v("\n")])])]),n("h5",{attrs:{id:"_7-下载-etcd-软件-解压-做软连接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-下载-etcd-软件-解压-做软连接"}},[t._v("#")]),t._v(" 7）下载 etcd 软件, 解压, 做软连接")]),t._v(" "),n("p",[t._v("下载地址：https://github.com/etcd-io/etcd/tags 这里选择 3.1.20 版本")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tar -zxvf etcd-v3.1.20-linux-amd64.tar.gz -C /opt")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mv etcd-v3.1.20-linux-amd64/ etcd-v3.1.20")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ln -s /opt/etcd-v3.1.20/ /opt/etcd")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ll")]),t._v("\n总用量 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\ndrwxr-xr-x "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root   root   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("71")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":53 certs\nlrwxrwxrwx "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root   root   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(":05 etcd -"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /opt/etcd-v3.1.20/\ndrwxr-xr-x "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("478493")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("89939")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("123")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("月 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v(" etcd-v3.1.20\ndrwxr-xr-x "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root   root    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":32 soft\n")])])]),n("h5",{attrs:{id:"_8-创建目录-拷贝证书文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-创建目录-拷贝证书文件"}},[t._v("#")]),t._v(" 8）创建目录, 拷贝证书文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir -p /opt/etcd/certs /data/etcd /data/logs/etcd-server")]),t._v("\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd etcd/certs/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp node-05:/opt/certs/ca.pem .")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp node-05:/opt/certs/etcd-peer.pem .")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp node-05:/opt/certs/etcd-peer-key.pem .")]),t._v("\n")])])]),n("h5",{attrs:{id:"_9-创建-etcd-服务启动脚本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-创建-etcd-服务启动脚本"}},[t._v("#")]),t._v(" 9）创建 etcd 服务启动脚本")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /opt/etcd/etcd-server-startup.sh\n")])])]),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/sh")]),t._v("\n./etcd --name etcd-server-node-02 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --data-dir /data/etcd/etcd-server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --listen-peer-urls https://10.10.50.20:2380 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --listen-client-urls https://10.10.50.20:2379,http://127.0.0.1:2379 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --quota-backend-bytes "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000000000")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --initial-advertise-peer-urls https://10.10.50.20:2380 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --advertise-client-urls https://10.10.50.20:2379,http://127.0.0.1:2379 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --initial-cluster  etcd-server-node-02"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://10.10.50.20:2380,etcd-server-node-03"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://10.10.50.233:2380,etcd-server-node-04"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://10.10.50.99:2380 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --ca-file ./certs/ca.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --cert-file ./certs/etcd-peer.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --key-file ./certs/etcd-peer-key.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --client-cert-auth  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --trusted-ca-file ./certs/ca.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --peer-ca-file ./certs/ca.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --peer-cert-file ./certs/etcd-peer.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --peer-key-file ./certs/etcd-peer-key.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --peer-client-cert-auth "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --peer-trusted-ca-file ./certs/ca.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --log-output stdout\n\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# chmod +x /opt/etcd/etcd-server-startup.sh")]),t._v("\n")])])]),n("h5",{attrs:{id:"_10-授权目录权限"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-授权目录权限"}},[t._v("#")]),t._v(" 10）授权目录权限")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# chown -R etcd.etcd /opt/etcd-v3.1.20/ /data/etcd/ /data/logs/etcd-server/")]),t._v("\n")])])]),n("h5",{attrs:{id:"_11-安装-supervisor-软件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_11-安装-supervisor-软件"}},[t._v("#")]),t._v(" 11）安装 supervisor 软件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yum install supervisor -y")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl start supervisord")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl enable supervisord")]),t._v("\n")])])]),n("h5",{attrs:{id:"_12-创建-supervisor-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_12-创建-supervisor-配置"}},[t._v("#")]),t._v(" 12）创建 supervisor 配置")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi /etc/supervisord.d/etcd-server.ini")]),t._v("\n")])])]),n("div",{staticClass:"language-ini extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ini"}},[n("code",[n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[program:etcd-server-node-02]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/opt/etcd/etcd-server-startup.sh                        ; the program (relative uses PATH, can take args)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("numprocs")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("1                                                      ; number of processes copies to start (def 1)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("directory")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/opt/etcd                                             ; directory to cwd to before exec (def no cwd)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("autostart")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("true                                                  ; start at supervisord start (default: true)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("autorestart")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("true                                                ; retstart at unexpected quit (default: true)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("startsecs")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("30                                                    ; number of secs prog must stay running (def. 1)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("startretries")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("3                                                  ; max # of serial start failures (default 3)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("exitcodes")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("0,2                                                   ; 'expected' exit codes for process (default 0,2)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stopsignal")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("QUIT                                                 ; signal used to kill process (default TERM)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stopwaitsecs")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("10                                                 ; max num secs to wait b4 SIGKILL (default 10)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("user")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("etcd                                                       ; setuid to this UNIX account to run the program")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("redirect_stderr")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("true                                            ; redirect proc stderr to stdout (default false)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_logfile")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/data/logs/etcd-server/etcd.stdout.log           ; stdout log path, NONE for none; default AUTO")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_logfile_maxbytes")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("64MB                                    ; max # logfile bytes b4 rotation (default 50MB)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_logfile_backups")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("4                                        ; # of stdout logfile backups (default 10)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_capture_maxbytes")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("1MB                                     ; number of bytes in 'capturemode' (default 0)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_events_enabled")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("false                                     ; emit events on stdout writes (default false)")]),t._v("\n")])])]),n("h5",{attrs:{id:"_13-启动-etcd-服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_13-启动-etcd-服务"}},[t._v("#")]),t._v(" 13）启动 etcd 服务")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# supervisorctl update")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# supervisorctl status")]),t._v("\netcd-server-node-02              RUNNING   pid "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5488")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("uptime")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(":01:03\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# netstat -lntup|grep etcd")]),t._v("\ntcp        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.99:2379        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*               LISTEN      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("27058")]),t._v("/./etcd        \ntcp        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:2379          "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*               LISTEN      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("27058")]),t._v("/./etcd        \ntcp        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.99:2380        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*               LISTEN      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("27058")]),t._v("/./etcd\n")])])]),n("h5",{attrs:{id:"同理-在-node-03-node-04-上安装-etcd"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#同理-在-node-03-node-04-上安装-etcd"}},[t._v("#")]),t._v(" 同理：在 node-03 node-04 上安装 etcd")]),t._v(" "),n("p",[t._v("重复 6~ 13 步骤。")]),t._v(" "),n("p",[t._v("不同的地方：")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("opt/etcd/etcd-server-startup.sh\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##########")]),t._v("\n--name\n--listen-peer-urls\n--listen-client-urls\n--initial-advertise-peer-urls\n--advertise-client-urls\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##########")]),t._v("\n/etc/supervisord.d/etcd-server.ini\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("program:etcd-server-node-xx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),n("h5",{attrs:{id:"检查集群状态"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#检查集群状态"}},[t._v("#")]),t._v(" 检查集群状态")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 etcd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ./etcdctl  cluster-health")]),t._v("\nmember 7d027ad4e297952d is healthy: got healthy result from http://127.0.0.1:2379\nmember 804d7a56c0ba452b is healthy: got healthy result from http://127.0.0.1:2379\nmember a9bfb00ec3d05a41 is healthy: got healthy result from http://127.0.0.1:2379\ncluster is healthy\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 etcd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ./etcdctl member list")]),t._v("\n7d027ad4e297952d: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("etcd-server-node-02 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("peerURLs")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://10.10.50.20:2380 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("clientURLs")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("http://127.0.0.1:2379,https://10.10.50.20:2379 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("isLeader")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("false\n804d7a56c0ba452b: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("etcd-server-node-03 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("peerURLs")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://10.10.50.233:2380 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("clientURLs")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("http://127.0.0.1:2379,https://10.10.50.233:2379 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("isLeader")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("false\na9bfb00ec3d05a41: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("etcd-server-node-04 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("peerURLs")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://10.10.50.99:2380 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("clientURLs")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("http://127.0.0.1:2379,https://10.10.50.99:2379 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("isLeader")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true\n")])])]),n("h4",{attrs:{id:"_6-6-2-部署-kube-apiserver-集群"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-6-2-部署-kube-apiserver-集群"}},[t._v("#")]),t._v(" 6.6.2 部署 kube-apiserver 集群")]),t._v(" "),n("h5",{attrs:{id:"_1-集群架构-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-集群架构-2"}},[t._v("#")]),t._v(" 1）集群架构")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("主机名")]),t._v(" "),n("th",[t._v("角色")]),t._v(" "),n("th",[t._v("IP")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("node-03")]),t._v(" "),n("td",[t._v("kube-apiserver")]),t._v(" "),n("td",[t._v("10.10.50.233")])]),t._v(" "),n("tr",[n("td",[t._v("node-04")]),t._v(" "),n("td",[t._v("kube-apiserver")]),t._v(" "),n("td",[t._v("10.10.50.99")])])])]),t._v(" "),n("h5",{attrs:{id:"_2-下载-kube-apiserver-软件-解压-做软连接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-下载-kube-apiserver-软件-解压-做软连接"}},[t._v("#")]),t._v(" 2）下载 kube-apiserver 软件, 解压, 做软连接")]),t._v(" "),n("p",[t._v("下载地址：https://github.com/kubernetes/kubernetes/releases/tag/v1.15.2")]),t._v(" "),n("p",[t._v("备用地址：https://storage.googleapis.com/kubernetes-release/release/v1.15.2/kubernetes-server-linux-amd64.tar.gzclear")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tar -zxvf kubernetes-server-linux-amd64.tar.gz -C /opt")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd /opt/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mv kubernetes/ kubernetes-v1.15.2")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ln -s /opt/kubernetes-v1.15.2/ /opt/kubernetes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd kubernetes")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rm -rf kubernetes-src.tar.gz ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd server/bin/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 bin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rm -rf *.tar")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 bin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rm -rf *_tag")]),t._v("\n")])])]),n("h5",{attrs:{id:"_3-签发-client-证书"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-签发-client-证书"}},[t._v("#")]),t._v(" 3）签发 client 证书")]),t._v(" "),n("p",[t._v("在 node-05 上")]),t._v(" "),n("ol",[n("li",[t._v("创建生成证书 csr 的 json 配置文件")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /opt/certs/client-csr.json\n")])])]),n("div",{staticClass:"language-json extra-class"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"CN"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"k8s-node"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"hosts"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"key"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"algo"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rsa"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"size"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"names"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"C"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CN"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ST"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"beijing"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"L"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"beijing"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"O"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"thtf"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"OU"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ops"')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("ol",{attrs:{start:"2"}},[n("li",[n("p",[t._v("生成 client 证书文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client client-csr.json |cfssl-json -bare client")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("检查生成的证书文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ll")]),t._v("\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("997")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":00 client.csr\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("282")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(":59 client-csr.json\n-rw------- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1679")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":00 client-key.pem\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1363")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":00 client.pem\n")])])])])]),t._v(" "),n("h5",{attrs:{id:"_4-签发-kube-apiserver-证书"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-签发-kube-apiserver-证书"}},[t._v("#")]),t._v(" 4）签发 kube-apiserver 证书")]),t._v(" "),n("p",[t._v("在 node-05 上")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("创建生成证书 csr 的 json 配置文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /opt/certs/apiserver-csr.json\n")])])]),n("div",{staticClass:"language-json extra-class"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"CN"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"k8s-apiserver"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"hosts"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.0.1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubernetes.default"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubernetes.default.svc"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubernetes.default.svc.cluster"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubernetes.default.svc.cluster.local"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.10.50.50"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.10.50.233"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.10.50.99"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.10.50.10"')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"key"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"algo"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rsa"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"size"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"names"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"C"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CN"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ST"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"beijing"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"L"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"beijing"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"O"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"thtf"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"OU"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ops"')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("   \n2. 生成 kube-apiserver 证书文件\n   \n      ```shell\n      [root@node-05 certs]# cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server apiserver-csr.json |cfssl-json -bare apiserver\n")])])]),n("ol",{attrs:{start:"3"}},[n("li",[n("p",[t._v("检查证书文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ll")]),t._v("\n总用量 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("68")]),t._v("\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1245")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":13 apiserver.csr\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("554")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":12 apiserver-csr.json\n-rw------- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1675")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":13 apiserver-key.pem\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1590")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":13 apiserver.pem\n")])])])])]),t._v(" "),n("h5",{attrs:{id:"_5-拷贝证书文件到各个节点-并创建配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-拷贝证书文件到各个节点-并创建配置"}},[t._v("#")]),t._v(" 5）拷贝证书文件到各个节点, 并创建配置")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("拷贝证书文件到 /opt/kubernetes/server/bin/certs 目录下")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 bin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir certs")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp node-05:/opt/certs/ca.pem .")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp node-05:/opt/certs/ca-key.pem .")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp node-05:/opt/certs/client.pem .")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp node-05:/opt/certs/client-key.pem .")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp node-05:/opt/certs/apiserver.pem .")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp node-05:/opt/certs/apiserver-key.pem .")]),t._v("\n\n")])])])]),t._v(" "),n("li",[n("p",[t._v("创建配置")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 bin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir conf")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 bin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd conf/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi audit.yaml")]),t._v("\n")])])]),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" audit.k8s.io/v1beta1 "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# This is required.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Policy\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Don't generate audit events for all requests in RequestReceived stage.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("omitStages")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"RequestReceived"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Log pod changes at RequestResponse level")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("level")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RequestResponse\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# Resource "pods" doesn\'t match requests to any subresource of pods,')]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# which is consistent with the RBAC policy.")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pods"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# Log "pods/log", "pods/status" at Metadata level')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("level")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Metadata\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pods/log"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pods/status"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# Don\'t log requests to a configmap called "controller-leader"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("level")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" None\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"configmaps"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resourceNames")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"controller-leader"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# Don\'t log watch requests by the "system:kube-proxy" on endpoints or services')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("level")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" None\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("users")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"system:kube-proxy"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("verbs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"watch"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# core API group")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"endpoints"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"services"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Don't log authenticated requests to certain non-resource URL paths.")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("level")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" None\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("userGroups")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"system:authenticated"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nonResourceURLs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/api*"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Wildcard matching.")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/version"')]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Log the request body of configmap changes in kube-system.")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("level")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Request\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# core API group")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"configmaps"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# This rule only applies to resources in the "kube-system" namespace.')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# The empty string "" can be used to select non-namespaced resources.')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespaces")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kube-system"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Log configmap and secret changes in all other namespaces at the Metadata level.")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("level")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Metadata\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# core API group")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"secrets"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"configmaps"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Log all other resources in core and extensions at the Request level.")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("level")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Request\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# core API group")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"extensions"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Version of group should NOT be included.")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# A catch-all rule to log all other requests at the Metadata level.")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("level")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Metadata\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Long-running requests like watches that fall under this rule will not")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# generate an audit event in RequestReceived.")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("omitStages")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"RequestReceived"')]),t._v("\n")])])]),n("h5",{attrs:{id:"_5-创建-apiserver-启动脚本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-创建-apiserver-启动脚本"}},[t._v("#")]),t._v(" 5）创建 apiserver 启动脚本")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 bin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi /opt/kubernetes/server/bin/kube-apiserver.sh")]),t._v("\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/bash")]),t._v("\n./kube-apiserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --apiserver-count "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --audit-log-path /data/logs/kubernetes/kube-apiserver/audit-log "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --audit-policy-file ./conf/audit.yaml "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --authorization-mode RBAC "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --client-ca-file ./certs/ca.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --requestheader-client-ca-file ./cert/ca.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --enable-admission-plugins NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --etcd-cafile ./certs/ca.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --etcd-certfile ./certs/client.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --etcd-keyfile ./certs/client-key.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --etcd-servers https://10.10.50.20:2379,https://10.10.50.233:2379,https://10.10.50.99:2379 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --service-account-key-file ./certs/ca-key.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --service-cluster-ip-range "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.0/16 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --service-node-port-range "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("-29999 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --target-ram-mb"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --kubelet-client-certificate ./certs/client.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --kubelet-client-key ./certs/client-key.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --log-dir  /data/logs/kubernetes/kube-apiserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --tls-cert-file ./certs/apiserver.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --tls-private-key-file ./certs/apiserver-key.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --v "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n")])])])])]),t._v(" "),n("h5",{attrs:{id:"_6-授权和创建目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-授权和创建目录"}},[t._v("#")]),t._v(" 6）授权和创建目录")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("  ```shell\n  [root@node-04 bin]# chmod +x kube-apiserver.sh\n  [root@node-04 bin]# mkdir -p /data/logs/kubernetes/kube-apiserver\n  ```\n")])])]),n("h5",{attrs:{id:"_7-创建-supervisor-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-创建-supervisor-配置"}},[t._v("#")]),t._v(" 7）创建 supervisor 配置")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("  ```shell\n")])])]),n("p",[t._v("vi /etc/supervisord.d/kube-apiserver.ini\n```")]),t._v(" "),n("div",{staticClass:"language-ini extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ini"}},[n("code",[n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[program:kube-apiserver-7-21]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/opt/kubernetes/server/bin/kube-apiserver.sh            ; the program (relative uses PATH, can take args)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("numprocs")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("1                                                      ; number of processes copies to start (def 1)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("directory")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/opt/kubernetes/server/bin                            ; directory to cwd to before exec (def no cwd)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("autostart")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("true                                                  ; start at supervisord start (default: true)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("autorestart")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("true                                                ; retstart at unexpected quit (default: true)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("startsecs")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("30                                                    ; number of secs prog must stay running (def. 1)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("startretries")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("3                                                  ; max # of serial start failures (default 3)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("exitcodes")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("0,2                                                   ; 'expected' exit codes for process (default 0,2)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stopsignal")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("QUIT                                                 ; signal used to kill process (default TERM)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stopwaitsecs")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("10                                                 ; max num secs to wait b4 SIGKILL (default 10)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("user")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("root                                                       ; setuid to this UNIX account to run the program")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("redirect_stderr")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("true                                            ; redirect proc stderr to stdout (default false)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_logfile")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/data/logs/kubernetes/kube-apiserver/apiserver.stdout.log        ; stderr log path, NONE for none; default AUTO")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_logfile_maxbytes")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("64MB                                    ; max # logfile bytes b4 rotation (default 50MB)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_logfile_backups")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("4                                        ; # of stdout logfile backups (default 10)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_capture_maxbytes")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("1MB                                     ; number of bytes in 'capturemode' (default 0)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_events_enabled")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("false                                     ; emit events on stdout writes (default false)")]),t._v("\n")])])]),n("h5",{attrs:{id:"_8-启动服务并检测"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-启动服务并检测"}},[t._v("#")]),t._v(" 8）启动服务并检测")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 bin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# supervisorctl update")]),t._v("\nkube-apiserver-node-04: added process group\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 bin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# supervisorctl status")]),t._v("\netcd-server-node-04              RUNNING   pid "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("27057")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("uptime")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(":34:08\nkube-apiserver-node-04           STARTING  \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 bin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# netstat -nltup|grep kube-api")]),t._v("\ntcp        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:8080          "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*               LISTEN      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("32456")]),t._v("/./kube-apiser \ntcp6       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" :::6443                 :::*                    LISTEN      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("32456")]),t._v("/./kube-apiser \n\n")])])]),n("h5",{attrs:{id:"同理-在-node-03-上完成-2-8-步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#同理-在-node-03-上完成-2-8-步骤"}},[t._v("#")]),t._v(" 同理, 在 node-03 上完成 2~8 步骤")]),t._v(" "),n("p",[t._v("不同的地方：")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/supervisord.d/kube-apiserver.ini\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("program:kube-apiserver-node-03"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),n("h4",{attrs:{id:"_6-6-3-部署四层反向代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-6-3-部署四层反向代理"}},[t._v("#")]),t._v(" 6.6.3 部署四层反向代理")]),t._v(" "),n("h5",{attrs:{id:"_1-集群架构-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-集群架构-3"}},[t._v("#")]),t._v(" 1）集群架构")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("主机名")]),t._v(" "),n("th",[t._v("角色")]),t._v(" "),n("th",[t._v("IP 地址")]),t._v(" "),n("th",[t._v("VIP 地址")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("node-01")]),t._v(" "),n("td",[t._v("L4")]),t._v(" "),n("td",[t._v("10.10.50.50")]),t._v(" "),n("td",[t._v("10.50.50.xx")])]),t._v(" "),n("tr",[n("td",[t._v("node-02")]),t._v(" "),n("td",[t._v("L4")]),t._v(" "),n("td",[t._v("10.10.50.20")]),t._v(" "),n("td",[t._v("10.10.50.xx")])])])]),t._v(" "),n("h5",{attrs:{id:"_2-安装-nginx-和-keepalived"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装-nginx-和-keepalived"}},[t._v("#")]),t._v(" 2）安装 Nginx 和 Keepalived")]),t._v(" "),n("p",[t._v("在 node-01 和 node-02 上都安装 Nginx 和 Keepalived")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" nginx keepalived -y\n")])])]),n("p",[t._v("在 node-01 和 node-02 上配置 Nginx")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/nginx/nginx.conf\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("# 加在配置文件末尾\nstream {\n    upstream kube-apiserver {\n        server 10.10.50.233:6443     max_fails=3 fail_timeout=30s;\n        server 10.10.50.99:6443     max_fails=3 fail_timeout=30s;\n    }\n    server {\n        listen 7443;\n        proxy_connect_timeout 2s;\n        proxy_timeout 900s;\n        proxy_pass kube-apiserver;\n    }\n}\n")])])]),n("p",[t._v("在 node-01 和 node-02 上配置 keepalived")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 检测脚本")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/keepalived/check_port.sh\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/bash")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#keepalived 监控端口脚本")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用方法：")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#在keepalived的配置文件中")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#vrrp_script check_port {#创建一个vrrp_script脚本,检查配置")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#    script "/etc/keepalived/check_port.sh 6379" #配置监听的端口')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    interval 2 #检查脚本的频率,单位（秒）")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CHK_PORT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" -n "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$CHK_PORT")]),t._v('"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PORT_PROCESS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("ss -lnt"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" $CHK_PORT"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("wc")]),t._v(" -l"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PORT_PROCESS")]),t._v(" -eq "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Port '),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$CHK_PORT")]),t._v(' Is Not Used,End."')]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Check Port Cant Be Empty!"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n")])])]),n("p",[t._v("修改执行权限")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" +x /etc/keepalived/check_port.sh\n")])])]),n("p",[t._v("keepalived 主配置 node-01")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-01 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi /etc/keepalived/keepalived.conf")]),t._v("\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('! Configuration File for keepalived\n\nglobal_defs {\n   router_id 10.10.50.50\n\n}\n\nvrrp_script chk_nginx {\n    script "/etc/keepalived/check_port.sh 7443"\n    interval 2\n    weight -20\n}\n\nvrrp_instance VI_1 {\n    state MASTER\n    interface eth0\n    virtual_router_id 251\n    priority 100\n    advert_int 1\n    mcast_src_ip 10.10.50.50\n    nopreempt\n\n    authentication {\n        auth_type PASS\n        auth_pass 11111111\n    }\n    track_script {\n         chk_nginx\n    }\n    virtual_ipaddress {\n        10.10.50.10\n    }\n}\n')])])]),n("p",[t._v("keepalived 从配置 node-02")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-02 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi /etc/keepalived/keepalived.conf ")]),t._v("\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('! Configuration File for keepalived\nglobal_defs {\n    router_id 10.10.50.20\n}\nvrrp_script chk_nginx {\n    script "/etc/keepalived/check_port.sh 7443"\n    interval 2\n    weight -20\n}\nvrrp_instance VI_1 {\n    state BACKUP\n    interface eth0 #### 这里的网卡名称需要和主机保持一致\n    virtual_router_id 251\n    mcast_src_ip 10.10.50.20\n    priority 90\n    advert_int 1\n    authentication {\n        auth_type PASS\n        auth_pass 11111111\n    }\n    track_script {\n        chk_nginx\n    }\n    virtual_ipaddress {\n        10.10.50.10\n    }\n}\n')])])]),n("h5",{attrs:{id:"_3-启动代理并检查"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-启动代理并检查"}},[t._v("#")]),t._v(" 3）启动代理并检查")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("systemctl start nginx keepalived\nsystemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" nginx keepalived\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("netstat")]),t._v(" -lntup"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" nginx\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-01 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ip addr")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(": lo: "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("LOOPBACK,UP,LOWER_UP"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" mtu "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("65536")]),t._v(" qdisc noqueue state UNKNOWN group default qlen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1/8 scope "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v(" lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v(" \n       valid_lft forever preferred_lft forever\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(": enp0s3: "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("BROADCAST,MULTICAST,UP,LOWER_UP"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" mtu "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1500")]),t._v(" qdisc pfifo_fast state UP group default qlen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n    link/ether 08:00:27:1c:87:23 brd ff:ff:ff:ff:ff:ff\n    inet "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.50/24 brd "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.255 scope global noprefixroute dynamic enp0s3\n       valid_lft 83981sec preferred_lft 83981sec\n    inet "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.10/32 scope global enp0s3\n       valid_lft forever preferred_lft forever\n    inet6 fe80::311e:9caf:bb5:e825/64 scope "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("link")]),t._v(" noprefixroute \n       valid_lft forever preferred_lft forever\n")])])]),n("h4",{attrs:{id:"_6-6-4-部署-controller-manager-集群"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-6-4-部署-controller-manager-集群"}},[t._v("#")]),t._v(" 6.6.4 部署 controller-manager 集群")]),t._v(" "),n("h5",{attrs:{id:"_1-集群架构-4"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-集群架构-4"}},[t._v("#")]),t._v(" 1）集群架构")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("主机名")]),t._v(" "),n("th",[t._v("角色")]),t._v(" "),n("th",[t._v("IP地址")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("node-03")]),t._v(" "),n("td",[t._v("controller-manager")]),t._v(" "),n("td",[t._v("10.10.50.233")])]),t._v(" "),n("tr",[n("td",[t._v("node-04")]),t._v(" "),n("td",[t._v("controller-manager")]),t._v(" "),n("td",[t._v("10.10.50.99")])])])]),t._v(" "),n("p",[t._v("接下来, 以 node-03 为例")]),t._v(" "),n("h5",{attrs:{id:"_2-创建启动脚本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建启动脚本"}},[t._v("#")]),t._v(" 2）创建启动脚本")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi /opt/kubernetes/server/bin/kube-controller-manager.sh")]),t._v("\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/sh")]),t._v("\n./kube-controller-manager "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --cluster-cidr "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.7")]),t._v(".0.0/16 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --leader-elect "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --log-dir /data/logs/kubernetes/kube-controller-manager "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --master http://127.0.0.1:8080 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --service-account-private-key-file ./certs/ca-key.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --service-cluster-ip-range "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.0/16 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --root-ca-file ./certs/ca.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --v "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" \n")])])]),n("h5",{attrs:{id:"_3-授权文件权限-创建目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-授权文件权限-创建目录"}},[t._v("#")]),t._v(" 3）授权文件权限, 创建目录")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# chmod +x /opt/kubernetes/server/bin/kube-controller-manager.sh ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir -p /data/logs/kubernetes/kube-controller-manager")]),t._v("\n")])])]),n("h5",{attrs:{id:"_4-创建-supervisor-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-创建-supervisor-配置"}},[t._v("#")]),t._v(" 4）创建 supervisor 配置")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi /etc/supervisord.d/kube-conntroller-manager.ini")]),t._v("\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("program:kube-controller-manager-node-03"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/kubernetes/server/bin/kube-controller-manager.sh                     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" the program "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("relative uses "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PATH")]),t._v(", can take args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("numprocs")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("                                                                        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" number of processes copies to start "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("def "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("directory")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/kubernetes/server/bin                                              "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" directory to cwd to before "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("def no cwd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("autostart")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true                                                                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" start at supervisord start "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("default: "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("autorestart")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true                                                                  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" retstart at unexpected quit "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("default: "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("startsecs")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("                                                                      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" number of secs prog must stay running "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("def. "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("startretries")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("                                                                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" max "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# of serial start failures (default 3)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("exitcodes")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0,2")]),t._v("                                                                     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'expected'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v(" codes "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" process "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("default "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0,2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("stopsignal")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("QUIT                                                                   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" signal used to "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("kill")]),t._v(" process "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("default "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("TERM")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("stopwaitsecs")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("                                                                   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" max num secs to "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("wait")]),t._v(" b4 SIGKILL "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("default "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("user")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root                                                                         "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" setuid to this UNIX account to run the program\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("redirect_stderr")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true                                                              "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" redirect proc stderr to stdout "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("default "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("stdout_logfile")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/data/logs/kubernetes/kube-controller-manager/controller.stdout.log  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" stderr log path, NONE "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" none"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" default AUTO\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("stdout_logfile_maxbytes")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("64MB                                                      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" max "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# logfile bytes b4 rotation (default 50MB)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("stdout_logfile_backups")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("                                                          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# of stdout logfile backups (default 10)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("stdout_capture_maxbytes")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("1MB                                                       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" number of bytes "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'capturemode'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("default "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("stdout_events_enabled")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("false                                                       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" emit events on stdout writes "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("default "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h5",{attrs:{id:"_5-启动服务并检查"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-启动服务并检查"}},[t._v("#")]),t._v(" 5）启动服务并检查")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# supervisorctl update")]),t._v("\nkube-controller-manager-node-03: added process group\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# supervisorctl status")]),t._v("\netcd-server-node-03               RUNNING   pid "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4912")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("uptime")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(":33:03\nkube-apiserver-node-03            RUNNING   pid "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4913")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("uptime")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(":33:03\nkube-controller-manager-node-03   STARTING \n")])])]),n("h5",{attrs:{id:"同理-另一台按照-2-5-步骤执行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#同理-另一台按照-2-5-步骤执行"}},[t._v("#")]),t._v(" 同理, 另一台按照 2~5 步骤执行")]),t._v(" "),n("p",[t._v("不同的地方")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/supervisord.d/kube-conntroller-manager.ini\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("program:kube-controller-manager-node-04"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),n("h4",{attrs:{id:"_6-6-5-部署-kube-scheduler-集群"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-6-5-部署-kube-scheduler-集群"}},[t._v("#")]),t._v(" 6.6.5 部署 kube-scheduler 集群")]),t._v(" "),n("h5",{attrs:{id:"_1-集群架构-5"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-集群架构-5"}},[t._v("#")]),t._v(" 1）集群架构")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("主机名")]),t._v(" "),n("th",[t._v("角色")]),t._v(" "),n("th",[t._v("IP地址")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("node-03")]),t._v(" "),n("td",[t._v("kube-scheduler")]),t._v(" "),n("td",[t._v("10.10.50.233")])]),t._v(" "),n("tr",[n("td",[t._v("node-04")]),t._v(" "),n("td",[t._v("kube-scheduler")]),t._v(" "),n("td",[t._v("10.10.50.99")])])])]),t._v(" "),n("p",[t._v("接下来, 以 node-03 为例")]),t._v(" "),n("h5",{attrs:{id:"_2-创建启动脚本-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建启动脚本-2"}},[t._v("#")]),t._v(" 2）创建启动脚本")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#vi /opt/kubernetes/server/bin/kube-scheduler.sh")]),t._v("\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/sh")]),t._v("\n./kube-scheduler "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --leader-elect  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --log-dir /data/logs/kubernetes/kube-scheduler "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --master http://127.0.0.1:8080 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --v "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n")])])]),n("h5",{attrs:{id:"_3-授权文件权限-创建目录-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-授权文件权限-创建目录-2"}},[t._v("#")]),t._v(" 3）授权文件权限, 创建目录")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# chmod +x  /opt/kubernetes/server/bin/kube-scheduler.sh")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir -p /data/logs/kubernetes/kube-scheduler")]),t._v("\n")])])]),n("h5",{attrs:{id:"_4-创建-supervisor-配置-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-创建-supervisor-配置-2"}},[t._v("#")]),t._v(" 4）创建 supervisor 配置")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi /etc/supervisord.d/kube-scheduler.ini")]),t._v("\n")])])]),n("div",{staticClass:"language-ini extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ini"}},[n("code",[n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[program:kube-scheduler-node-03]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/opt/kubernetes/server/bin/kube-scheduler.sh                     ; the program (relative uses PATH, can take args)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("numprocs")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("1                                                               ; number of processes copies to start (def 1)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("directory")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/opt/kubernetes/server/bin                                     ; directory to cwd to before exec (def no cwd)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("autostart")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("true                                                           ; start at supervisord start (default: true)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("autorestart")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("true                                                         ; retstart at unexpected quit (default: true)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("startsecs")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("30                                                             ; number of secs prog must stay running (def. 1)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("startretries")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("3                                                           ; max # of serial start failures (default 3)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("exitcodes")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("0,2                                                            ; 'expected' exit codes for process (default 0,2)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stopsignal")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("QUIT                                                          ; signal used to kill process (default TERM)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stopwaitsecs")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("10                                                          ; max num secs to wait b4 SIGKILL (default 10)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("user")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("root                                                                ; setuid to this UNIX account to run the program")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("redirect_stderr")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("true                                                     ; redirect proc stderr to stdout (default false)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_logfile")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/data/logs/kubernetes/kube-scheduler/scheduler.stdout.log ; stderr log path, NONE for none; default AUTO")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_logfile_maxbytes")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("64MB                                             ; max # logfile bytes b4 rotation (default 50MB)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_logfile_backups")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("4                                                 ; # of stdout logfile backups (default 10)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_capture_maxbytes")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("1MB                                              ; number of bytes in 'capturemode' (default 0)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_events_enabled")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("false                                              ; emit events on stdout writes (default false)")]),t._v("\n")])])]),n("h5",{attrs:{id:"_5-启动服务并检查-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-启动服务并检查-2"}},[t._v("#")]),t._v(" 5）启动服务并检查")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# supervisorctl update")]),t._v("\nkube-scheduler-node-03: added process group\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# supervisorctl status")]),t._v("\netcd-server-node-03               RUNNING   pid "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4912")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("uptime")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(":43:36\nkube-apiserver-node-03            RUNNING   pid "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4913")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("uptime")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(":43:36\nkube-controller-manager-node-03   STARTING  \nkube-scheduler-node-03            STARTING \n")])])]),n("h5",{attrs:{id:"同理-另一台按照-2-5-步骤执行-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#同理-另一台按照-2-5-步骤执行-2"}},[t._v("#")]),t._v(" 同理, 另一台按照 2~5 步骤执行")]),t._v(" "),n("p",[t._v("不同的地方")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("/etc/supervisord.d/kube-scheduler.ini\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("program:kube-scheduler-node-04"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),n("h4",{attrs:{id:"_6-6-6-检查-master节点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-6-6-检查-master节点"}},[t._v("#")]),t._v(" 6.6.6 检查 master节点")]),t._v(" "),n("h5",{attrs:{id:"建立-kubectl-软连接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#建立-kubectl-软连接"}},[t._v("#")]),t._v(" 建立 kubectl 软连接")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ln -s /opt/kubernetes/server/bin/kubectl /usr/bin/kubectl")]),t._v("\n")])])]),n("h5",{attrs:{id:"检查-master-节点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#检查-master-节点"}},[t._v("#")]),t._v(" 检查 master 节点")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get cs")]),t._v("\nNAME                 STATUS    MESSAGE              ERROR\nscheduler            Healthy   ok                   \ncontroller-manager   Healthy   ok                   \netcd-0               Healthy   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"health"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \netcd-2               Healthy   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"health"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \netcd-1               Healthy   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"health"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n")])])]),n("h3",{attrs:{id:"_6-7-部署-node-节点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-7-部署-node-节点"}},[t._v("#")]),t._v(" 6.7 部署 node 节点")]),t._v(" "),n("h4",{attrs:{id:"_6-7-1-部署-kubelet"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-7-1-部署-kubelet"}},[t._v("#")]),t._v(" 6.7.1 部署 kubelet")]),t._v(" "),n("h5",{attrs:{id:"_1-集群架构-6"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-集群架构-6"}},[t._v("#")]),t._v(" 1）集群架构")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("主机名")]),t._v(" "),n("th",[t._v("角色")]),t._v(" "),n("th",[t._v("IP地址")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("node-03")]),t._v(" "),n("td",[t._v("kubelet")]),t._v(" "),n("td",[t._v("10.10.50.233")])]),t._v(" "),n("tr",[n("td",[t._v("node-04")]),t._v(" "),n("td",[t._v("kubelet")]),t._v(" "),n("td",[t._v("10.10.50.99")])])])]),t._v(" "),n("p",[t._v("以 node-03 为例")]),t._v(" "),n("h5",{attrs:{id:"_2-签发-kubelet-证书"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-签发-kubelet-证书"}},[t._v("#")]),t._v(" 2）签发 kubelet 证书")]),t._v(" "),n("p",[t._v("在 node-05 上")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("创建生成证书 crs 的 json 配置文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi /opt/certs/kubelet-csr.json")]),t._v("\n")])])]),n("div",{staticClass:"language-json extra-class"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"CN"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"k8s-kubelet"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"hosts"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.10.50.50"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.10.50.20"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.10.50.40"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.10.50.233"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.10.50.99"')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"key"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"algo"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rsa"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"size"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"names"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"C"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CN"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ST"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"beijing"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"L"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"beijing"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"O"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"thtf"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"OU"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ops"')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("ol",{attrs:{start:"2"}},[n("li",[t._v("生成 kubelet 证书")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kubelet-csr.json | cfssl-json -bare kubelet")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("/04/15 09:38:02 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" generate received request\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("/04/15 09:38:02 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" received CSR\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("/04/15 09:38:02 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" generating key: rsa-2048\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("/04/15 09:38:02 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" encoded CSR\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("/04/15 09:38:02 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" signed certificate with serial number "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("602300016453030103556289231370796933909552612578")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("/04/15 09:38:02 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("WARNING"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" This certificate lacks a "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hosts"')]),t._v(" field. This makes it unsuitable "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v("\nwebsites. For "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("more")]),t._v(" information see the Baseline Requirements "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the Issuance and Management\nof Publicly-Trusted Certificates, v.1.1.6, from the CA/Browser Forum "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("https://cabforum.org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nspecifically, section "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.2")]),t._v(".3 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Information Requirements"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(".\n")])])]),n("ol",{attrs:{start:"3"}},[n("li",[t._v("检查生成的证书文件")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ll")]),t._v("\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1086")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(" 09:38 kubelet.csr\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("397")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(" 09:33 kubelet-csr.json\n-rw------- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1679")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(" 09:38 kubelet-key.pem\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1432")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(" 09:38 kubelet.pem\n")])])])])]),t._v(" "),n("h5",{attrs:{id:"_3-拷贝证书文件到各个节点-并创建配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-拷贝证书文件到各个节点-并创建配置"}},[t._v("#")]),t._v(" 3）拷贝证书文件到各个节点, 并创建配置")]),t._v(" "),n("p",[t._v("在 node-03 上")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("拷贝文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd /opt/kubernetes/server/bin/certs/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp node-05:/opt/certs/kubelet.pem .")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp node-05:/opt/certs/kubelet-key.pem .")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("创建配置")]),t._v(" "),n("p",[t._v("注意：在 conf 目录下, 没有就创建")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" /opt/kubernetes/server/bin/conf\n")])])]),n("p",[n("strong",[t._v("set-cluster")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl config set-cluster myk8s \\")]),t._v("\n--certificate-authority"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/kubernetes/server/bin/certs/ca.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--embed-certs"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--server"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://10.10.50.10:7443 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--kubeconfig"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("kubelet.kubeconfig\n")])])]),n("p",[n("strong",[t._v("set-credentials")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl config set-credentials k8s-node \\")]),t._v("\n--client-certificate"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/kubernetes/server/bin/certs/client.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--client-key"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/kubernetes/server/bin/certs/client-key.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--embed-certs"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--kubeconfig"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("kubelet.kubeconfig\n")])])]),n("p",[n("strong",[t._v("set-context")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl config set-context myk8s-context \\")]),t._v("\n--cluster"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("myk8s "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("k8s-node "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--kubeconfig"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("kubelet.kubeconfig\n")])])]),n("p",[n("strong",[t._v("use-context")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl config use-context myk8s-context --kubeconfig=kubelet.kubeconfig")]),t._v("\n")])])]),n("p",[n("strong",[t._v("查看生成的kubelet.kubeconfig")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ll")]),t._v("\n总用量 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\n-rw------- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6189")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":17 kubelet.kubeconfig\n")])])]),n("p",[n("strong",[t._v("k8s-node.yaml")])]),t._v(" "),n("p",[t._v("a. 创建配置文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi k8s-node.yaml")]),t._v("\n")])])]),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRoleBinding\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" k8s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roleRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRole\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" system"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("node\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subjects")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" User\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" k8s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node\n")])])]),n("p",[t._v("b. 应用资源配置")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create -f k8s-node.yaml")]),t._v("\n")])])]),n("p",[t._v("c. 查看集群角色和角色属性")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get clusterrolebinding k8s-node")]),t._v("\nNAME       AGE\nk8s-node   32s\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get clusterrolebinding k8s-node -o yaml")]),t._v("\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  creationTimestamp: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2020-04-15T07:22:34Z"')]),t._v("\n  name: k8s-node\n  resourceVersion: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"55622"')]),t._v("\n  selfLink: /apis/rbac.authorization.k8s.io/v1/clusterrolebindings/k8s-node\n  uid: f98c058b-e544-43e2-b926-6bda476a39fb\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:node\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: User\n  name: k8s-node\n")])])]),n("p",[n("strong",[t._v("将 node-03 上生成的 kubelet.kubeconfig 拷贝到 node-04 的 conf 中")])]),t._v(" "),n("p",[t._v("在 node-04 上创建 conf 目录, 把 node-03 生成的kubelet.kubeconfig直接拷贝到目标服务器")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir /opt/kubernetes/server/bin/conf")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd /opt/kubernetes/server/bin/conf/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp node-03:/opt/kubernetes/server/bin/conf/kubelet.kubeconfig .")]),t._v("\n")])])]),n("p",[t._v("同时, 将从 node-05 上 kubelet 对应的证书文件拷贝到目标服务器 /opt/kubernetes/server/bin/certs 目录下")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp node-05:/opt/certs/kubelet.pem .")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp node-05:/opt/certs/kubelet-key.pem .")]),t._v("\n")])])]),n("p",[t._v("查看集群角色和角色属性")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get clusterrolebinding k8s-node")]),t._v("\nNAME       AGE\nk8s-node   35m\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get clusterrolebinding k8s-node -o yaml")]),t._v("\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  creationTimestamp: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2020-04-15T07:22:34Z"')]),t._v("\n  name: k8s-node\n  resourceVersion: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"55622"')]),t._v("\n  selfLink: /apis/rbac.authorization.k8s.io/v1/clusterrolebindings/k8s-node\n  uid: f98c058b-e544-43e2-b926-6bda476a39fb\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:node\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: User\n  name: k8s-node\n")])])])])]),t._v(" "),n("h5",{attrs:{id:"_4-准备-pause-基础镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-准备-pause-基础镜像"}},[t._v("#")]),t._v(" 4）准备 pause 基础镜像")]),t._v(" "),n("p",[t._v("在 node-05 上")]),t._v(" "),n("p",[t._v("a. 下载 pause 镜像")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker pull kubernetes/pause")]),t._v("\n")])])]),n("p",[t._v("b. 上传到 docker 私有仓库 harbor 中")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker images -a | grep pause")]),t._v("\nkubernetes/pause                latest                     f9d5de079539        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" years ago         240kB\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker tag f9d5de079539 harbor.thtf.com/public/pause:latest")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker images -a | grep pause")]),t._v("\nkubernetes/pause                latest                     f9d5de079539        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" years ago         240kB\nharbor.thtf.com/public/pause    latest                     f9d5de079539        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" years ago         240kB\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker push harbor.thtf.com/public/pause:latest")]),t._v("\n")])])]),n("h5",{attrs:{id:"_5-创建-kubelet-启动脚本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-创建-kubelet-启动脚本"}},[t._v("#")]),t._v(" 5）创建 kubelet 启动脚本")]),t._v(" "),n("p",[t._v("在 node-03 上")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi /opt/kubernetes/server/bin/kubelet.sh")]),t._v("\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/sh")]),t._v("\n./kubelet "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --anonymous-auth"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("false "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --cgroup-driver systemd "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --cluster-dns "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.2 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --cluster-domain cluster.local "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --runtime-cgroups"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/systemd/system.slice "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --kubelet-cgroups"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/systemd/system.slice "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --fail-swap-on"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --client-ca-file ./certs/ca.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --tls-cert-file ./certs/kubelet.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --tls-private-key-file ./certs/kubelet-key.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --hostname-override node-03 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --image-gc-high-threshold "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --image-gc-low-threshold "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --kubeconfig ./conf/kubelet.kubeconfig "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --log-dir /data/logs/kubernetes/kube-kubelet "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --pod-infra-container-image harbor.thtf.com/public/pause:latest "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --root-dir /data/kubelet\n")])])]),n("p",[t._v("授权, 创建目录")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# chmod +x /opt/kubernetes/server/bin/kubelet.sh ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir -p /data/logs/kubernetes/kube-kubelet   /data/kubelet")]),t._v("\n")])])]),n("h5",{attrs:{id:"_6-创建-supervisor-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-创建-supervisor-配置"}},[t._v("#")]),t._v(" 6）创建 supervisor 配置")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi /etc/supervisord.d/kube-kubelet.ini")]),t._v("\n")])])]),n("div",{staticClass:"language-ini extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ini"}},[n("code",[n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[program:kube-kubelet-node-03]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/opt/kubernetes/server/bin/kubelet.sh     ; the program (relative uses PATH, can take args)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("numprocs")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("1                                        ; number of processes copies to start (def 1)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("directory")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/opt/kubernetes/server/bin              ; directory to cwd to before exec (def no cwd)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("autostart")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("true                                    ; start at supervisord start (default: true)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("autorestart")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("true                                  ; retstart at unexpected quit (default: true)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("startsecs")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("30                                      ; number of secs prog must stay running (def. 1)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("startretries")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("3                                    ; max # of serial start failures (default 3)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("exitcodes")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("0,2                                     ; 'expected' exit codes for process (default 0,2)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stopsignal")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("QUIT                                   ; signal used to kill process (default TERM)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stopwaitsecs")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("10                                   ; max num secs to wait b4 SIGKILL (default 10)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("user")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("root                                         ; setuid to this UNIX account to run the program")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("redirect_stderr")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("true                              ; redirect proc stderr to stdout (default false)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_logfile")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/data/logs/kubernetes/kube-kubelet/kubelet.stdout.log   ; stderr log path, NONE for none; default AUTO")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_logfile_maxbytes")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("64MB                      ; max # logfile bytes b4 rotation (default 50MB)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_logfile_backups")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("4                          ; # of stdout logfile backups (default 10)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_capture_maxbytes")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("1MB                       ; number of bytes in 'capturemode' (default 0)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_events_enabled")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("false                       ; emit events on stdout writes (default false)")]),t._v("\n")])])]),n("h5",{attrs:{id:"_7-启动服务并检查"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-启动服务并检查"}},[t._v("#")]),t._v(" 7）启动服务并检查")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# supervisorctl  update")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# supervisorctl  status")]),t._v("\n")])])]),n("h5",{attrs:{id:"同理-node-04-上按-5-7-步骤执行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#同理-node-04-上按-5-7-步骤执行"}},[t._v("#")]),t._v(" 同理, node-04 上按 5~7 步骤执行")]),t._v(" "),n("p",[t._v("不同的地方")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("/opt/kubernetes/server/bin/kubelet.sh\n--hostname-override node-04\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##########")]),t._v("\n/etc/supervisord.d/kube-kubelet.ini\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("program:kube-kubelet-node-04"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),n("h4",{attrs:{id:"_6-7-2-部署-kube-proxy"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-7-2-部署-kube-proxy"}},[t._v("#")]),t._v(" 6.7.2 部署 kube-proxy")]),t._v(" "),n("h5",{attrs:{id:"_1-集群架构-7"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-集群架构-7"}},[t._v("#")]),t._v(" 1）集群架构")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("主机名")]),t._v(" "),n("th",[t._v("角色")]),t._v(" "),n("th",[t._v("IP地址")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("node-03")]),t._v(" "),n("td",[t._v("kubelet")]),t._v(" "),n("td",[t._v("10.10.50.233")])]),t._v(" "),n("tr",[n("td",[t._v("node-04")]),t._v(" "),n("td",[t._v("kubelet")]),t._v(" "),n("td",[t._v("10.10.50.99")])])])]),t._v(" "),n("p",[t._v("以 node-03 为例")]),t._v(" "),n("h5",{attrs:{id:"_2-签发-kube-proxy-证书"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-签发-kube-proxy-证书"}},[t._v("#")]),t._v(" 2）签发 kube-proxy 证书")]),t._v(" "),n("p",[t._v("在 node-05 上")]),t._v(" "),n("p",[t._v("a. 创建生成证书 csr 的 json 配置文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi kube-proxy-csr.json")]),t._v("\n")])])]),n("div",{staticClass:"language-json extra-class"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"CN"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"system:kube-proxy"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"key"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"algo"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rsa"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"size"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"names"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"C"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CN"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ST"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"beijing"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"L"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"beijing"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"O"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"thtf"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"OU"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ops"')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("b. 生成 kube-proxy 证书文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-05 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json |cfssl-json -bare kube-proxy-client")]),t._v("\n")])])]),n("p",[t._v("c. 检查生成的证书文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1009")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":35 kube-proxy-client.csr\n-rw------- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1679")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":35 kube-proxy-client-key.pem\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1375")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":35 kube-proxy-client.pem\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" root root  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("269")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":35 kube-proxy-csr.json\n")])])]),n("h5",{attrs:{id:"_3-拷贝证书文件到各个节点-并创建配置-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-拷贝证书文件到各个节点-并创建配置-2"}},[t._v("#")]),t._v(" 3）拷贝证书文件到各个节点, 并创建配置")]),t._v(" "),n("p",[t._v("在 node-03 上")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("拷贝证书文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd /opt/kubernetes/server/bin/certs/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp node-05:/opt/certs/kube-proxy-client.pem .")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp node-05:/opt/certs/kube-proxy-client-key.pem .")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("创建配置")]),t._v(" "),n("p",[t._v("进入：/opt/kubernetes/server/bin/conf")]),t._v(" "),n("p",[n("strong",[t._v("set-cluster")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl config set-cluster myk8s \\")]),t._v("\n--certificate-authority"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/kubernetes/server/bin/certs/ca.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--embed-certs"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--server"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://10.10.50.10:7443 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--kubeconfig"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("kube-proxy.kubeconfig\n")])])]),n("p",[n("strong",[t._v("set-credentials")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl config set-credentials kube-proxy \\")]),t._v("\n--client-certificate"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/kubernetes/server/bin/certs/kube-proxy-client.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--client-key"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/kubernetes/server/bin/certs/kube-proxy-client-key.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--embed-certs"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--kubeconfig"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("kube-proxy.kubeconfig\n")])])]),n("p",[n("strong",[t._v("set-context")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl config set-context myk8s-context \\")]),t._v("\n--cluster"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("myk8s "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("kube-proxy "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--kubeconfig"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("kube-proxy.kubeconfig\n")])])]),n("p",[n("strong",[t._v("use-context")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl config use-context myk8s-context --kubeconfig=kube-proxy.kubeconfig")]),t._v("\n")])])]),n("p",[n("strong",[t._v("将 node-03 上生成的 kube-proxy.kubeconfig 到 node-04 的conf目录下")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd /opt/kubernetes/server/bin/conf/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp node-03:/opt/kubernetes/server/bin/conf/kube-proxy.kubeconfig .")]),t._v("\n")])])]),n("p",[t._v("同时, 将从 node-05 上 kubelet 对应的证书文件拷贝到目标服务器 /opt/kubernetes/server/bin/certs 目录下")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd /opt/kubernetes/server/bin/certs/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp node-05:/opt/certs/kube-proxy-client.pem .")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-04 certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scp node-05:/opt/certs/kube-proxy-client-key.pem .")]),t._v("\n")])])])])]),t._v(" "),n("h5",{attrs:{id:"_4-创建-kube-proxy-启动脚本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-创建-kube-proxy-启动脚本"}},[t._v("#")]),t._v(" 4）创建 kube-proxy 启动脚本")]),t._v(" "),n("p",[t._v("在 node-03 上")]),t._v(" "),n("p",[t._v("a. 加载 ipvs 模块")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# lsmod | grep ip_vs")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi /root/ipvs.sh")]),t._v("\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/bash")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ipvs_mods_dir")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/lib/modules/'),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("uname")]),t._v(" -r"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v('/kernel/net/netfilter/ipvs"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[t._v("i")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" $ipvs_mods_dir"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" -o "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^[^.]*"')]),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n  /sbin/modinfo -F filename "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&>")]),t._v("/dev/null\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v(" -eq "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n    /sbin/modprobe "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("    \n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# chmod +x /root/ipvs.sh ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sh /root/ipvs.sh ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# lsmod | grep ip_vs")]),t._v("\n")])])]),n("p",[t._v("b. 创建启动脚本")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi /opt/kubernetes/server/bin/kube-proxy.sh")]),t._v("\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/sh")]),t._v("\n./kube-proxy "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--cluster-cidr "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.7")]),t._v(".0.0/16 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--hostname-override node-03"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--proxy-mode"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ipvs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--ipvs-scheduler"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nq "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--kubeconfig ./conf/kube-proxy.kubeconfig\t\n")])])]),n("p",[t._v("c. 授权, 创建目录")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ls -l /opt/kubernetes/server/bin/conf/|grep kube-proxy")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# chmod +x /opt/kubernetes/server/bin/kube-proxy.sh ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir -p /data/logs/kubernetes/kube-proxy")]),t._v("\n")])])]),n("h5",{attrs:{id:"_5-创建-supervisor-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-创建-supervisor-配置"}},[t._v("#")]),t._v(" 5）创建 supervisor 配置")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi /etc/supervisord.d/kube-proxy.ini")]),t._v("\n")])])]),n("div",{staticClass:"language-ini extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ini"}},[n("code",[n("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[program:kube-proxy-node-03]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/opt/kubernetes/server/bin/kube-proxy.sh                     ; the program (relative uses PATH, can take args)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("numprocs")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("1                                                           ; number of processes copies to start (def 1)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("directory")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/opt/kubernetes/server/bin                                 ; directory to cwd to before exec (def no cwd)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("autostart")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("true                                                       ; start at supervisord start (default: true)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("autorestart")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("true                                                     ; retstart at unexpected quit (default: true)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("startsecs")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("30                                                         ; number of secs prog must stay running (def. 1)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("startretries")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("3                                                       ; max # of serial start failures (default 3)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("exitcodes")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("0,2                                                        ; 'expected' exit codes for process (default 0,2)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stopsignal")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("QUIT                                                      ; signal used to kill process (default TERM)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stopwaitsecs")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("10                                                      ; max num secs to wait b4 SIGKILL (default 10)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("user")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("root                                                            ; setuid to this UNIX account to run the program")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("redirect_stderr")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("true                                                 ; redirect proc stderr to stdout (default false)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_logfile")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("/data/logs/kubernetes/kube-proxy/proxy.stdout.log     ; stderr log path, NONE for none; default AUTO")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_logfile_maxbytes")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("64MB                                         ; max # logfile bytes b4 rotation (default 50MB)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_logfile_backups")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("4                                             ; # of stdout logfile backups (default 10)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_capture_maxbytes")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("1MB                                          ; number of bytes in 'capturemode' (default 0)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdout_events_enabled")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("false                                          ; emit events on stdout writes (default false)")]),t._v("\n")])])]),n("h5",{attrs:{id:"_6-启动服务并检查"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-启动服务并检查"}},[t._v("#")]),t._v(" 6）启动服务并检查")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# supervisorctl update")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# supervisorctl status")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yum install ipvsadm -y")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ipvsadm -Ln")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@node-03 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get svc")]),t._v("\n")])])]),n("h5",{attrs:{id:"同理-在-node-04-上按照-4-5-步骤执行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#同理-在-node-04-上按照-4-5-步骤执行"}},[t._v("#")]),t._v(" 同理, 在 node-04 上按照 4~5 步骤执行")]),t._v(" "),n("p",[t._v("不同的地方")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("/opt/kubernetes/server/bin/kube-proxy.sh\n--hostname-override node-04\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##########")]),t._v("\n/etc/supervisord.d/kube-proxy.ini\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("program:kube-proxy-node-04"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),n("h3",{attrs:{id:"_6-8-验证-kubernetes-集群"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-8-验证-kubernetes-集群"}},[t._v("#")]),t._v(" 6.8 验证 kubernetes 集群")]),t._v(" "),n("h4",{attrs:{id:"_6-8-1-在任意一个节点上创建一个资源配置清单"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-8-1-在任意一个节点上创建一个资源配置清单"}},[t._v("#")]),t._v(" 6.8.1 "),n("strong",[t._v("在任意一个节点上创建一个资源配置清单")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /root/nginx-ds.yaml\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("apiVersion: extensions/v1beta1\nkind: DaemonSet\nmetadata:\n  name: nginx-ds\nspec:\n  template:\n    metadata:\n      labels:\n        app: nginx-ds\n    spec:\n      containers:\n      - name: my-nginx\n        image: harbor.thtf.com/public/nginx:v1.7.9\n        ports:\n        - containerPort: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n")])])]),n("h4",{attrs:{id:"_6-8-2-应用资源配置-并检查"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-8-2-应用资源配置-并检查"}},[t._v("#")]),t._v(" 6.8.2 "),n("strong",[t._v("应用资源配置，并检查")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("kubectl create -f /root/nginx-ds.yaml\nkubectl get pods\nkubectl get pods -o wide\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.7")]),t._v(".21.2\n")])])]),n("h2",{attrs:{id:"第-7-章-环境搭建-kubeadm"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第-7-章-环境搭建-kubeadm"}},[t._v("#")]),t._v(" 第 7 章 环境搭建（kubeadm）")]),t._v(" "),n("h3",{attrs:{id:"_7-1-环境要求"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-环境要求"}},[t._v("#")]),t._v(" 7.1 环境要求")]),t._v(" "),n("p",[t._v("在开始之前，部署Kubernetes集群机器需要满足以下几个条件：")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("一台或多台机器，操作系统 CentOS7.x-86_x64")])]),t._v(" "),n("li",[n("p",[t._v("硬件配置：2GB或更多RAM，2个CPU或更多CPU，硬盘30GB或更多")])]),t._v(" "),n("li",[n("p",[t._v("集群中所有机器之间网络互通")])]),t._v(" "),n("li",[n("p",[t._v("可以访问外网，需要拉取镜像")])]),t._v(" "),n("li",[n("p",[t._v("禁止swap分区")])])]),t._v(" "),n("h3",{attrs:{id:"_7-2-环境准备"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-环境准备"}},[t._v("#")]),t._v(" 7.2 环境准备")]),t._v(" "),n("ul",[n("li",[t._v("关闭 SELinux 和 firewalld")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl stop firewalld               #临时关闭")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl disable firewalld            #永久关闭,即设置开机的时候不自动启动")]),t._v("\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("永久关闭selinux可以使用vi命令打开/etc/sysconfig/selinux 文件将SELINUXTYPE=(disable或permissive）\n")])])]),n("p",[t._v("永久关闭selinux可以使用vi命令打开/etc/sysconfig/selinux 文件将SELINUXTYPE=(disable或permissive）")]),t._v(" "),n("ul",[n("li",[t._v("关闭 swap")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# swapoff -a\t\t\t\t\t\t\t\t\t\t\t\t# 临时关闭")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi /etc/fstab \t\t\t\t\t\t\t\t\t\t# 永久")]),t._v("\n")])])]),n("ul",[n("li",[t._v("添加主机名与IP对应关系（记得设置主机名）")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat /etc/hosts")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".31.61 k8s-master\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".31.62 k8s-node1\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".31.63 k8s-node2\n")])])]),n("ul",[n("li",[t._v("将桥接的IPv4流量传递到iptables的链")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /etc/sysctl.d/k8s.conf "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("EOF\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF")]),t._v("\n")])])]),n("h3",{attrs:{id:"_7-3-所有节点安装-docker-kubeadm-kubelet"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-所有节点安装-docker-kubeadm-kubelet"}},[t._v("#")]),t._v(" 7.3 所有节点安装 Docker/kubeadm/kubelet")]),t._v(" "),n("p",[t._v("Kubernetes默认CRI（容器运行时）为Docker，因此先安装Docker。")]),t._v(" "),n("h4",{attrs:{id:"_7-3-1-安装-docker"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-1-安装-docker"}},[t._v("#")]),t._v(" 7.3.1 安装 docker")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yum -y install docker-ce-18.06.1.ce-3.el7")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl enable docker && systemctl start docker")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker --version")]),t._v("\n")])])]),n("h4",{attrs:{id:"_7-3-2-添加阿里云-yun-软件源"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-2-添加阿里云-yun-软件源"}},[t._v("#")]),t._v(" 7.3.2 添加阿里云 YUN 软件源")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat > /etc/yum.repos.d/kubernetes.repo << EOF")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Kubernetes\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("baseurl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("enabled")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("gpgcheck")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("repo_gpgcheck")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("gpgkey")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n")])])]),n("h4",{attrs:{id:"_7-3-3-安装-kubeadm-kubelet-和-kubectl"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-3-安装-kubeadm-kubelet-和-kubectl"}},[t._v("#")]),t._v(" 7.3.3 安装 kubeadm, kubelet 和 kubectl")]),t._v(" "),n("p",[t._v("由于版本更新频繁，这里指定版本号部署：")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yum install -y kubelet-1.15.0 kubeadm-1.15.0 kubectl-1.15.0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# systemctl enable kubelet")]),t._v("\n")])])]),n("h3",{attrs:{id:"_7-4-部署-kubernetes-master"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-4-部署-kubernetes-master"}},[t._v("#")]),t._v(" 7.4 部署 Kubernetes Master")]),t._v(" "),n("p",[t._v("在192.168.31.61（Master）执行。")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#kubeadm init \\")]),t._v("\n--apiserver-advertise-address"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".31.61 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--image-repository registry.aliyuncs.com/google_containers "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--kubernetes-version v1.15.0 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--service-cidr"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.1")]),t._v(".0.0/16 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--pod-network-cidr"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".0.0/16\n")])])]),n("p",[t._v("由于默认拉取镜像地址k8s.gcr.io国内无法访问，这里指定阿里云镜像仓库地址。")]),t._v(" "),n("p",[t._v("使用kubectl工具：")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir -p $HOME/.kube")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sudo chown $(id -u):$(id -g) $HOME/.kube/config")]),t._v("\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get nodes")]),t._v("\nNAME     STATUS     ROLES    AGE     VERSION\nmaster   NotReady   master   3m40s   v1.15.0\n")])])]),n("h3",{attrs:{id:"_7-5-安装-pod-网络插件-cni"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-5-安装-pod-网络插件-cni"}},[t._v("#")]),t._v(" 7.5 安装 Pod 网络插件（CNI）")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/a70459be0084506e4ec919aa1c114638878db11b/Documentation/kube-flannel.yml")]),t._v("\n")])])]),n("p",[t._v("如果不能访问，就使用下面文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi kube-flannel.yml")]),t._v("\n")])])]),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRole\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" pods\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("verbs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" get\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" nodes\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("verbs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" list\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" watch\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" nodes/status\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("verbs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" patch\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRoleBinding\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roleRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRole\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subjects")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceAccount\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceAccount\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ConfigMap\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tier")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cni-conf.json")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v('\n    {\n      "name": "cbr0",\n      "plugins": [\n        {\n          "type": "flannel",\n          "delegate": {\n            "hairpinMode": true,\n            "isDefaultGateway": true\n          }\n        },\n        {\n          "type": "portmap",\n          "capabilities": {\n            "portMappings": true\n          }\n        }\n      ]\n    }')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("net-conf.json")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v('\n    {\n      "Network": "10.244.0.0/16",\n      "Backend": {\n        "Type": "vxlan"\n      }\n    }')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" extensions/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DaemonSet\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("amd64\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tier")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tier")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostNetwork")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeSelector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("beta.kubernetes.io/arch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" amd64\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tolerations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Exists\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("effect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NoSchedule\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceAccountName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("initContainers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cni\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" quay.io/coreos/flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v0.11.0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("amd64\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cp\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /etc/kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel/cni"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("conf.json\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /etc/cni/net.d/10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel.conflist\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cni\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/cni/net.d\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel/\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" quay.io/coreos/flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v0.11.0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("amd64\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /opt/bin/flanneld\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("masq\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("subnet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mgr\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"100m"')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"50Mi"')]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("limits")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"100m"')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"50Mi"')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("securityContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("privileged")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" POD_NAME\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" metadata.name\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" POD_NAMESPACE\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" metadata.namespace\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" run\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /run\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel/\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" run\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /run\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cni\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/cni/net.d\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("configMap")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" extensions/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DaemonSet\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("arm64\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tier")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tier")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostNetwork")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeSelector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("beta.kubernetes.io/arch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" arm64\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tolerations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Exists\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("effect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NoSchedule\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceAccountName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("initContainers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cni\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" quay.io/coreos/flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v0.11.0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("arm64\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cp\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /etc/kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel/cni"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("conf.json\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /etc/cni/net.d/10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel.conflist\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cni\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/cni/net.d\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel/\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" quay.io/coreos/flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v0.11.0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("arm64\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /opt/bin/flanneld\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("masq\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("subnet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mgr\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"100m"')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"50Mi"')]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("limits")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"100m"')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"50Mi"')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("securityContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("privileged")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" POD_NAME\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" metadata.name\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" POD_NAMESPACE\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" metadata.namespace\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" run\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /run\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel/\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" run\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /run\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cni\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/cni/net.d\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("configMap")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" extensions/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DaemonSet\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("arm\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tier")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tier")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostNetwork")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeSelector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("beta.kubernetes.io/arch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" arm\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tolerations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Exists\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("effect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NoSchedule\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceAccountName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("initContainers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cni\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" quay.io/coreos/flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v0.11.0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("arm\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cp\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /etc/kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel/cni"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("conf.json\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /etc/cni/net.d/10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel.conflist\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cni\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/cni/net.d\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel/\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" quay.io/coreos/flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v0.11.0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("arm\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /opt/bin/flanneld\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("masq\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("subnet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mgr\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"100m"')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"50Mi"')]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("limits")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"100m"')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"50Mi"')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("securityContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("privileged")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" POD_NAME\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" metadata.name\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" POD_NAMESPACE\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" metadata.namespace\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" run\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /run\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel/\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" run\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /run\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cni\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/cni/net.d\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("configMap")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" extensions/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DaemonSet\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ppc64le\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tier")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tier")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostNetwork")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeSelector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("beta.kubernetes.io/arch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ppc64le\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tolerations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Exists\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("effect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NoSchedule\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceAccountName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("initContainers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cni\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" quay.io/coreos/flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v0.11.0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ppc64le\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cp\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /etc/kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel/cni"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("conf.json\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /etc/cni/net.d/10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel.conflist\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cni\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/cni/net.d\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel/\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" quay.io/coreos/flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v0.11.0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ppc64le\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /opt/bin/flanneld\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("masq\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("subnet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mgr\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"100m"')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"50Mi"')]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("limits")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"100m"')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"50Mi"')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("securityContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("privileged")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" POD_NAME\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" metadata.name\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" POD_NAMESPACE\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" metadata.namespace\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" run\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /run\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel/\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" run\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /run\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cni\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/cni/net.d\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("configMap")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" extensions/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DaemonSet\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("s390x\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tier")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tier")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostNetwork")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeSelector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("beta.kubernetes.io/arch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" s390x\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tolerations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Exists\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("effect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NoSchedule\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceAccountName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("initContainers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cni\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" quay.io/coreos/flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v0.11.0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("s390x\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cp\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /etc/kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel/cni"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("conf.json\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /etc/cni/net.d/10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel.conflist\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cni\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/cni/net.d\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel/\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" quay.io/coreos/flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v0.11.0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("s390x\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /opt/bin/flanneld\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("masq\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("subnet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mgr\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"100m"')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"50Mi"')]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("limits")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"100m"')]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"50Mi"')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("securityContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("privileged")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" POD_NAME\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" metadata.name\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" POD_NAMESPACE\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fieldPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" metadata.namespace\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" run\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /run\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel/\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" run\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /run\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cni\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/cni/net.d\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("configMap")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("flannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cfg\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f kube-flannel.yml")]),t._v("\nclusterrole.rbac.authorization.k8s.io/flannel created\nclusterrolebinding.rbac.authorization.k8s.io/flannel created\nserviceaccount/flannel created\nconfigmap/kube-flannel-cfg created\ndaemonset.extensions/kube-flannel-ds-amd64 created\ndaemonset.extensions/kube-flannel-ds-arm64 created\ndaemonset.extensions/kube-flannel-ds-arm created\ndaemonset.extensions/kube-flannel-ds-ppc64le created\ndaemonset.extensions/kube-flannel-ds-s390x created\n")])])]),n("p",[t._v("检查是否成功")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods -n kube-system")]),t._v("\nNAME                             READY   STATUS    RESTARTS   AGE\ncoredns-bccdc95cf-2wbsm          "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          17m\ncoredns-bccdc95cf-qth9j          "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          17m\netcd-master                      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          16m\nkube-apiserver-master            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          16m\nkube-controller-manager-master   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          16m\nkube-flannel-ds-amd64-5t8vx      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          74s\nkube-proxy-drghg                 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          17m\nkube-scheduler-master            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          16m\n")])])]),n("h3",{attrs:{id:"_7-6-加入-kubernetes-node"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-6-加入-kubernetes-node"}},[t._v("#")]),t._v(" 7.6 加入 Kubernetes Node")]),t._v(" "),n("p",[t._v("在192.168.31.62/63（所有Node节点）执行。")]),t._v(" "),n("p",[t._v("向集群添加新节点，执行在kubeadm init输出的kubeadm join命令：")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#kubeadm join 192.168.31:6443 --token g19l60.r4ai7kxwmtqthjh7 \\")]),t._v("\n    --discovery-token-ca-cert-hash sha256:3aed74d544f0b37428949a0f0c99f534bb9633e38f971a7af8b3bb9805f838f8 \n")])])]),n("h3",{attrs:{id:"_7-7-测试kubernetes集群"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-7-测试kubernetes集群"}},[t._v("#")]),t._v(" 7.7 测试kubernetes集群")]),t._v(" "),n("p",[t._v("在Kubernetes集群中创建一个pod，验证是否正常运行：")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get nodes")]),t._v("\nNAME      STATUS   ROLES    AGE     VERSION\nmaster    Ready    master   27m     v1.15.0\nnode-01   Ready    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("   3m27s   v1.15.0\nnode-02   Ready    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("   3m21s   v1.15.0\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods -n kube-system")]),t._v("\nNAME                             READY   STATUS    RESTARTS   AGE\ncoredns-bccdc95cf-2wbsm          "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          27m\ncoredns-bccdc95cf-qth9j          "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          27m\netcd-master                      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          26m\nkube-apiserver-master            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          26m\nkube-controller-manager-master   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          26m\nkube-flannel-ds-amd64-4f25j      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("          4m17s\nkube-flannel-ds-amd64-5t8vx      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          11m\nkube-flannel-ds-amd64-826hw      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          4m23s\nkube-proxy-8n76h                 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          4m17s\nkube-proxy-9xcrv                 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          4m23s\nkube-proxy-drghg                 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          27m\nkube-scheduler-master            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          26m\n\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create deployment nginx --image=nginx")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl expose deployment nginx --port=80 --type=NodePort")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pod,svc")]),t._v("\n")])])]),n("p",[t._v("访问地址：http://NodeIP:Port")]),t._v(" "),n("h3",{attrs:{id:"_7-8-部署-dashboard"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-8-部署-dashboard"}},[t._v("#")]),t._v(" 7.8 部署 Dashboard")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml")]),t._v("\n")])])]),n("p",[t._v("不能访问")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi kubernetes-dashboard.yaml")]),t._v("\n")])])]),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Copyright 2017 The Kubernetes Authors.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# Licensed under the Apache License, Version 2.0 (the "License");')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# you may not use this file except in compliance with the License.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# You may obtain a copy of the License at")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#     http://www.apache.org/licenses/LICENSE-2.0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Unless required by applicable law or agreed to in writing, software")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# distributed under the License is distributed on an "AS IS" BASIS,')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# See the License for the specific language governing permissions and")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# limitations under the License.")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ------------------- Dashboard Secret ------------------- #")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Secret\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k8s-app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("certs\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Opaque\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ------------------- Dashboard Service Account ------------------- #")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceAccount\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k8s-app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ------------------- Dashboard Role & Role Binding ------------------- #")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Role\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("minimal\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Allow Dashboard to create 'kubernetes-dashboard-key-holder' secret.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"secrets"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("verbs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"create"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Allow Dashboard to create 'kubernetes-dashboard-settings' config map.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"configmaps"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("verbs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"create"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Allow Dashboard to get, update and delete Dashboard exclusive secrets.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"secrets"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resourceNames")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubernetes-dashboard-key-holder"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubernetes-dashboard-certs"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("verbs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"get"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"update"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"delete"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Allow Dashboard to get and update 'kubernetes-dashboard-settings' config map.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"configmaps"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resourceNames")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubernetes-dashboard-settings"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("verbs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"get"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"update"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Allow Dashboard to get metrics from heapster.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"services"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resourceNames")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"heapster"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("verbs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"proxy"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"services/proxy"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resourceNames")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"heapster"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http:heapster:"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https:heapster:"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("verbs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"get"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RoleBinding\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("minimal\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roleRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Role\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("minimal\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subjects")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceAccount\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ------------------- Dashboard Deployment ------------------- #")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k8s-app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("revisionHistoryLimit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k8s-app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k8s-app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" k8s.gcr.io/kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("amd64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v1.10.1\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8443")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("generate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("certificates\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Uncomment the following line to manually specify Kubernetes API server Host")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# If not specified, Dashboard will attempt to auto discover the API server and connect")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# to it. Uncomment only if the default does not work.")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - --apiserver-host=http://my-address:port")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("certs\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /certs\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create on-disk volume to store exec logs")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /tmp\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tmp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("volume\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("livenessProbe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("httpGet")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scheme")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HTTPS\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8443")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("initialDelaySeconds")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeoutSeconds")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("certs\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secret")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secretName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("certs\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tmp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("volume\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("emptyDir")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceAccountName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Comment the following tolerations if Dashboard must not be deployed on master")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tolerations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("role.kubernetes.io/master\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("effect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NoSchedule\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ------------------- Dashboard Service ------------------- #")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k8s-app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8443")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k8s-app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard\n")])])]),n("p",[t._v("默认镜像国内无法访问，修改镜像地址为： lizhenliang/kubernetes-dashboard-amd64:v1.10.1")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" lizhenliang/kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("amd64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v1.10.1\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n")])])]),n("p",[t._v("默认Dashboard只能集群内部访问，修改Service为NodePort类型，暴露到外部：")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ------------------- Dashboard Service ------------------- #")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k8s-app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NodePort\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30001")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n")])])]),n("p",[t._v("重新apply")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f kubernetes-dashboard.yaml")]),t._v("\nsecret/kubernetes-dashboard-certs created\nserviceaccount/kubernetes-dashboard created\nrole.rbac.authorization.k8s.io/kubernetes-dashboard-minimal created\nrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard-minimal created\ndeployment.apps/kubernetes-dashboard created\nservice/kubernetes-dashboard created\n\n")])])]),n("p",[t._v("检查")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods -n kube-system")]),t._v("\nNAME                                    READY   STATUS             RESTARTS   AGE\ncoredns-bccdc95cf-2wbsm                 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          39m\ncoredns-bccdc95cf-qth9j                 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          39m\netcd-master                             "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          38m\nkube-apiserver-master                   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          38m\nkube-controller-manager-master          "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          38m\nkube-flannel-ds-amd64-4f25j             "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("          16m\nkube-flannel-ds-amd64-5t8vx             "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          23m\nkube-flannel-ds-amd64-826hw             "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          16m\nkube-proxy-8n76h                        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          16m\nkube-proxy-9xcrv                        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          16m\nkube-proxy-drghg                        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          39m\nkube-scheduler-master                   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          38m\nkubernetes-dashboard-7d75c474bb-h24l9   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("/1     ImagePullBackOff   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          5m4s\n\n")])])]),n("p",[t._v("访问地址：http://NodeIP:30001")]),t._v(" "),n("p",[t._v("创建service account并绑定默认cluster-admin管理员集群角色：")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create serviceaccount dashboard-admin -n kube-system")]),t._v("\nserviceaccount/dashboard-admin created\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create clusterrolebinding dashboard-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashboard-admin")]),t._v("\nclusterrolebinding.rbac.authorization.k8s.io/dashboard-admin created\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl describe secrets -n kube-system $(kubectl -n kube-system get secret | awk '/dashboard-admin/{print $1}')")]),t._v("\nName:         dashboard-admin-token-2xfsf\nNamespace:    kube-system\nLabels:       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nAnnotations:  kubernetes.io/service-account.name: dashboard-admin\n              kubernetes.io/service-account.uid: c8e442b3-6076-4757-aff9-c6965cd719ab\n\nType:  kubernetes.io/service-account-token\n\nData\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v("\nca.crt:     "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1025")]),t._v(" bytes\nnamespace:  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" bytes\ntoken:      eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4tMnhmc2YiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiYzhlNDQyYjMtNjA3Ni00NzU3LWFmZjktYzY5NjVjZDcxOWFiIiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmRhc2hib2FyZC1hZG1pbiJ9.pCpWvb3h5lSB7wOEScQuVo3UbjadGbOim3ues5nEruGb2TFzfHAWX3fb5x7kU8pzpFzRXUG55SCmHstWxdHmG17L54OCByklyHRv-VIaqr-ZgEneHEaqJMLjsPLkWMqRYqmhPT4XE4pwr6pkcm7-bKLHOHjOCenIF-0cXiaE04-3Am6swqMN63h8iOpCz-77k9KxNzcn0hehv-OwsCexNF-CzzSBao4ZWRYNqVzi0IXDoL9XdgcMx63RcW896jqj4qxN5Rja5X8P9DNP9qXutSuVPZLQWU_AQJdlbMMFaGj82WV2Bh0X3__zqTjI6uI5fPQm6iFRK06tfEgCkFKHQg\n\n")])])]),n("p",[t._v("选择 token 登录输入上面生成 token")]),t._v(" "),n("p",[n("img",{attrs:{src:a(449),alt:""}})]),t._v(" "),n("h2",{attrs:{id:"第-8-章-k8s-的核心资源管理方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第-8-章-k8s-的核心资源管理方法"}},[t._v("#")]),t._v(" 第 8 章 K8S 的核心资源管理方法")]),t._v(" "),n("p",[t._v("管理 K8S 核心资源的三种基本方法：")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("陈述式管理方法 - 主要依赖命令行 CLI 工具进行管理")])]),t._v(" "),n("li",[n("p",[t._v("声明式管理方法 - 主要依赖统一资源配置清单（mainifest）进行管理")])]),t._v(" "),n("li",[n("p",[t._v("GUI 式管理方法 - 主要依赖图形化操作界面（web 页面）进行管理")])])]),t._v(" "),n("h3",{attrs:{id:"_8-1-陈述式资源管理方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-陈述式资源管理方法"}},[t._v("#")]),t._v(" 8.1 陈述式资源管理方法")]),t._v(" "),n("h4",{attrs:{id:"_8-1-1-管理名称空间资源"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-1-管理名称空间资源"}},[t._v("#")]),t._v(" 8.1.1 管理名称空间资源")]),t._v(" "),n("h5",{attrs:{id:"查看名称空间"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看名称空间"}},[t._v("#")]),t._v(" 查看名称空间")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get namespaces")]),t._v("\nNAME              STATUS   AGE\ndefault           Active   24h\nkube-node-lease   Active   24h\nkube-public       Active   24h\nkube-system       Active   24h\n")])])]),n("h5",{attrs:{id:"查看名称空间内的资源"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看名称空间内的资源"}},[t._v("#")]),t._v(" 查看名称空间内的资源")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get all -n default")]),t._v("\n")])])]),n("h5",{attrs:{id:"创建名称空间"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建名称空间"}},[t._v("#")]),t._v(" 创建名称空间")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create namespace app")]),t._v("\n")])])]),n("h5",{attrs:{id:"删除名称空间"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#删除名称空间"}},[t._v("#")]),t._v(" 删除名称空间")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl delete namespace app")]),t._v("\n")])])]),n("h4",{attrs:{id:"_8-1-2-管理-deployment-资源"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-2-管理-deployment-资源"}},[t._v("#")]),t._v(" 8.1.2 管理 Deployment 资源")]),t._v(" "),n("h5",{attrs:{id:"创建-deployment"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建-deployment"}},[t._v("#")]),t._v(" 创建 deployment")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create deployment nginx-dp --image=docker.io/panyangyang/nginx:v1.12.2 -n kube-public")]),t._v("\n")])])]),n("h5",{attrs:{id:"查看-deployment"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看-deployment"}},[t._v("#")]),t._v(" 查看 deployment")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("简单查看")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get deploy -n kube-public")]),t._v("\nNAME       READY   UP-TO-DATE   AVAILABLE   AGE\nnginx-dp   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("           9m19s\n")])])])]),t._v(" "),n("li",[n("p",[t._v("扩展查看")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get deploy -o wide -n kube-public")]),t._v("\nNAME       READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES                                SELECTOR\nnginx-dp   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("           11m   nginx        docker.io/panyangyang/nginx:v1.12.2   "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx-dp\n")])])])]),t._v(" "),n("li",[n("p",[t._v("详细查看")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl describe deployment nginx-dp -n kube-public")]),t._v("\nName:                   nginx-dp\nNamespace:              kube-public\nCreationTimestamp:      Sun, "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" Apr "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(":53:10 +0800\nLabels:                 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx-dp\nAnnotations:            deployment.kubernetes.io/revision: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nSelector:               "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx-dp\nReplicas:               "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" desired "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" updated "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" total "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" available "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" unavailable\nStrategyType:           RollingUpdate\nMinReadySeconds:        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nRollingUpdateStrategy:  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v("% max unavailable, "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v("% max surge\nPod Template:\n  Labels:  "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx-dp\n  Containers:\n   nginx:\n    Image:        docker.io/panyangyang/nginx:v1.12.2\n    Port:         "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    Host Port:    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    Environment:  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    Mounts:       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  Volumes:        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nConditions:\n  Type           Status  Reason\n  ----           ------  ------\n  Available      True    MinimumReplicasAvailable\n  Progressing    True    NewReplicaSetAvailable\nOldReplicaSets:  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nNewReplicaSet:   nginx-dp-58774b9c55 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1 replicas created"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nEvents:\n  Type    Reason             Age   From                   Message\n  ----    ------             ----  ----                   -------\n  Normal  ScalingReplicaSet  12m   deployment-controller  Scaled up replica "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" nginx-dp-58774b9c55 to \n")])])])])]),t._v(" "),n("h5",{attrs:{id:"查看-pod-资源"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看-pod-资源"}},[t._v("#")]),t._v(" 查看 pod 资源")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods -n kube-public")]),t._v("\nNAME                        READY   STATUS    RESTARTS   AGE\nnginx-dp-58774b9c55-cx76j   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          24m\n")])])]),n("h5",{attrs:{id:"进入-pod-资源"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#进入-pod-资源"}},[t._v("#")]),t._v(" 进入 pod 资源")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl exec -it nginx-dp-58774b9c55-cx76j bash -n kube-public")]),t._v("\nroot@nginx-dp-58774b9c55-cx76j:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ls")]),t._v("\nbin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var\nroot@nginx-dp-58774b9c55-cx76j:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n")])])]),n("p",[t._v("当然也可以用 docker exec 进入容器")]),t._v(" "),n("h5",{attrs:{id:"删除-pod-资源-重启"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#删除-pod-资源-重启"}},[t._v("#")]),t._v(" 删除 pod 资源（重启）")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl delete pod nginx-dp-58774b9c55-cx76j -n kube-public")]),t._v("\npod "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx-dp-58774b9c55-cx76j"')]),t._v(" deleted\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods -n kube-public")]),t._v("\nNAME                        READY   STATUS    RESTARTS   AGE\nnginx-dp-58774b9c55-7974f   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          19s\n")])])]),n("blockquote",[n("p",[t._v("强制删除参数：--force --grace-period=0")])]),t._v(" "),n("h5",{attrs:{id:"删除-deployment"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#删除-deployment"}},[t._v("#")]),t._v(" 删除 deployment")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl delete deployment nginx-dp -n kube-public")]),t._v("\ndeployment.extensions "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx-dp"')]),t._v(" deleted\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get deployment -n kube-public")]),t._v("\nNo resources found.\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods -n kube-public")]),t._v("\nNo resources found.\n")])])]),n("h4",{attrs:{id:"_8-1-3-管理-service-资源"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-3-管理-service-资源"}},[t._v("#")]),t._v(" 8.1.3 管理 Service 资源")]),t._v(" "),n("h5",{attrs:{id:"创建service"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建service"}},[t._v("#")]),t._v(" 创建service")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl create deployment nginx-dp --image=docker.io/panyangyang/nginx:v1.12.2 -n kube-public")]),t._v("\ndeployment.apps/nginx-dp created\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods")]),t._v("\nNAME                     READY   STATUS    RESTARTS   AGE\nnginx-554b9c67f9-pjd5p   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          24h\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl expose deployment nginx-dp --port=80 -n kube-public")]),t._v("\nservice/nginx-dp exposed\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get all -n kube-public")]),t._v("\nNAME                            READY   STATUS    RESTARTS   AGE\npod/nginx-dp-58774b9c55-lgv6r   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          108s\n\n\nNAME               TYPE        CLUSTER-IP     EXTERNAL-IP   PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("S"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   AGE\nservice/nginx-dp   ClusterIP   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.1")]),t._v(".133.189   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/TCP    17s\n\n\nNAME                       READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/nginx-dp   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("           108s\n\nNAME                                  DESIRED   CURRENT   READY   AGE\nreplicaset.apps/nginx-dp-58774b9c55   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("       108s\n")])])]),n("h5",{attrs:{id:"查看-service"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看-service"}},[t._v("#")]),t._v(" 查看 service")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl describe svc nginx-dp -n kube-public")]),t._v("\nName:              nginx-dp\nNamespace:         kube-public\nLabels:            "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx-dp\nAnnotations:       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nSelector:          "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx-dp\nType:              ClusterIP\nIP:                "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.1")]),t._v(".133.189\nPort:              "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("unset"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/TCP\nTargetPort:        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/TCP\nEndpoints:         "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".2.5:80\nSession Affinity:  None\nEvents:            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),n("h4",{attrs:{id:"_8-1-4-总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-4-总结"}},[t._v("#")]),t._v(" 8.1.4 总结")]),t._v(" "),n("p",[t._v(""),n("img",{attrs:{src:a(332),alt:""}})]),t._v(" "),n("h3",{attrs:{id:"_8-2-声明式资源管理方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-声明式资源管理方法"}},[t._v("#")]),t._v(" 8.2 声明式资源管理方法")]),t._v(" "),n("p",[t._v("声明式资源管理方法依赖于 - 资源配置清单（yaml/json)")]),t._v(" "),n("h4",{attrs:{id:"_8-2-1-查看资源配置清单的方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-1-查看资源配置清单的方法"}},[t._v("#")]),t._v(" 8.2.1 查看资源配置清单的方法")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get svc nginx-dp -o yaml -n kube-public")]),t._v("\napiVersion: v1\nkind: Service\nmetadata:\n  creationTimestamp: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2020-04-19T05:31:44Z"')]),t._v("\n  labels:\n    app: nginx-dp\n  name: nginx-dp\n  namespace: kube-public\n  resourceVersion: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"131556"')]),t._v("\n  selfLink: /api/v1/namespaces/kube-public/services/nginx-dp\n  uid: 9ec83521-f04a-4cb5-9a0e-22915f9fe046\nspec:\n  clusterIP: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.1")]),t._v(".133.189\n  ports:\n  - port: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n    protocol: TCP\n    targetPort: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n  selector:\n    app: nginx-dp\n  sessionAffinity: None\n  type: ClusterIP\nstatus:\n  loadBalancer: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h4",{attrs:{id:"_8-2-2-解释资源配置清单"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-2-解释资源配置清单"}},[t._v("#")]),t._v(" 8.2.2 解释资源配置清单")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl explain service.metadata")]),t._v("\n")])])]),n("h4",{attrs:{id:"_8-2-3-创建资源配置清单"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-3-创建资源配置清单"}},[t._v("#")]),t._v(" 8.2.3 创建资源配置清单")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ds\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ds\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("public\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ds\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("sessionAffinity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" None\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterIP\n")])])]),n("h4",{attrs:{id:"_8-2-4-应用资源配置清单"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-4-应用资源配置清单"}},[t._v("#")]),t._v(" 8.2.4 应用资源配置清单")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f nginx-ds-svc.yaml ")]),t._v("\nservice/nginx-ds created\n")])])]),n("h4",{attrs:{id:"_8-2-5-修改资源配置清单并应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-5-修改资源配置清单并应用"}},[t._v("#")]),t._v(" 8.2.5 修改资源配置清单并应用")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("离线修改")]),t._v(" "),n("blockquote",[n("p",[t._v("修改 nginx-ds-svc.yaml 文件，并用 kubectl apply -f nginx-ds-svc.yaml 使之生效。")])])]),t._v(" "),n("li",[n("p",[t._v("在线修改")]),t._v(" "),n("blockquote",[n("p",[t._v("直接使用 kubectl edit service nginx-ds 在线编辑资源配置清单并保持生效。")])])])]),t._v(" "),n("h4",{attrs:{id:"_8-2-6-删除资源配置清单"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-6-删除资源配置清单"}},[t._v("#")]),t._v(" 8.2.6 删除资源配置清单")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("陈述式删除")]),t._v(" "),n("blockquote",[n("p",[t._v("kubectl delete service nginx-ds -n tube-public")])])]),t._v(" "),n("li",[n("p",[t._v("声明式删除")]),t._v(" "),n("blockquote",[n("p",[t._v("kubectl delete -f nginx-df-svc.yaml")])])])]),t._v(" "),n("h4",{attrs:{id:"_8-2-7-查看并使用-service-资源"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-7-查看并使用-service-资源"}},[t._v("#")]),t._v(" 8.2.7 查看并使用 service 资源")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get svc -o wide")]),t._v("\nNAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("S"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("        AGE     SELECTOR\nkubernetes   ClusterIP   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.1")]),t._v(".0.1       "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("/TCP        27h     "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nnginx        NodePort    "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.1")]),t._v(".189.125   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(":31068/TCP   26h     "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx\nnginx-ds     ClusterIP   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.1")]),t._v(".39.17     "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/TCP         4m32s   "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx-ds\n")])])]),n("h4",{attrs:{id:"_8-2-8-总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-8-总结"}},[t._v("#")]),t._v(" 8.2.8 总结")]),t._v(" "),n("p",[n("img",{attrs:{src:a(332),alt:""}})])])}),[],!1,null,null,null);s.default=e.exports}}]);