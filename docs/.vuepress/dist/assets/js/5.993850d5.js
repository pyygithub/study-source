(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{211:function(t,s){t.exports="data:image/png;base64,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"},212:function(t,s,e){t.exports=e.p+"assets/img/why_containers.dbf7d592.svg"},213:function(t,s,e){t.exports=e.p+"assets/img/ubuntu_clock.44cab9b9.png"},214:function(t,s,e){t.exports=e.p+"assets/img/ubuntu_clock1.ed9b3b5c.png"},215:function(t,s,e){t.exports=e.p+"assets/img/nginx.ec1d57d4.png"},216:function(t,s,e){t.exports=e.p+"assets/img/k8s_scheduler.45cf5f02.png"},217:function(t,s,e){t.exports=e.p+"assets/img/k8s_fix.a11b20e0.png"},218:function(t,s,e){t.exports=e.p+"assets/img/k8s_expend.7ec5e67e.png"},219:function(t,s,e){t.exports=e.p+"assets/img/k8s_m_n.a1bf6ae9.png"},220:function(t,s,e){t.exports=e.p+"assets/img/k8s_schedule1.3fd2911e.png"},221:function(t,s,e){t.exports=e.p+"assets/img/k8s_m.61775f75.png"},222:function(t,s,e){t.exports=e.p+"assets/img/k8s_n.418c6820.png"},223:function(t,s,e){t.exports=e.p+"assets/img/kube_cr.ab209f7c.png"},330:function(t,s,e){"use strict";e.r(s);var a=e(28),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"kubernetes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes"}},[t._v("#")]),t._v(" Kubernetes")]),t._v(" "),a("h2",{attrs:{id:"第-1-章-概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第-1-章-概述"}},[t._v("#")]),t._v(" 第 1 章 概述")]),t._v(" "),a("p",[a("img",{attrs:{src:e(211),alt:""}})]),t._v(" "),a("p",[t._v("官网：https://kubernetes.io")]),t._v(" "),a("p",[t._v("Github：https://github.com/kubernetes/kubernetes")]),t._v(" "),a("p",[t._v("由来：谷歌的Borg系统, 后经Go语言重写并捐献给CNCF基金会开源")]),t._v(" "),a("p",[t._v("含义：词根源于希腊语：舵手/飞行员，K8S -》K 8个字母 S")]),t._v(" "),a("p",[t._v("Kubernetes 是 "),a("strong",[t._v("Google 2014 年创建管理的")]),t._v("，是 Google 10 多年大规模容器管理技术 Borg 的开源版本。")]),t._v(" "),a("p",[t._v("Kubernetes 是容器集群管理系统，是一个开源的平台，可以实现容器集群的自动化部署、自动扩缩容、维护等功能。使用 Kubernetes 我们可以：")]),t._v(" "),a("ul",[a("li",[t._v("快速部署应用")]),t._v(" "),a("li",[t._v("快速扩展应用")]),t._v(" "),a("li",[t._v("无缝对接新的应用功能")]),t._v(" "),a("li",[t._v("节省资源，优化硬件资源的使用")])]),t._v(" "),a("p",[t._v("Kubernetes 的目标是促进完善组件和工具的生态系统，以减轻应用程序在公有云或私有云中运行的负担。")]),t._v(" "),a("h2",{attrs:{id:"第-2-章-从传统到容器化部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第-2-章-从传统到容器化部署"}},[t._v("#")]),t._v(" 第 2 章 从传统到容器化部署")]),t._v(" "),a("p",[a("img",{attrs:{src:e(212),alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_2-1-传统的部署方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-传统的部署方式"}},[t._v("#")]),t._v(" 2.1 传统的部署方式")]),t._v(" "),a("p",[t._v("传统的应用部署方式是通过插件或脚本来安装应用。这样做的缺点是应用的运行、配置、管理、所有生存周期将与当前操作系统绑定，这样做并不利于应用的升级更新/回滚等操作，当然也可以通过创建虚机的方式来实现某些功能，但是虚拟机非常重，并不利于可移植性。")]),t._v(" "),a("h3",{attrs:{id:"_2-2-容器化部署的优势"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-容器化部署的优势"}},[t._v("#")]),t._v(" 2.2 容器化部署的优势")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("快速创建/部署应用：")]),t._v(" 与虚拟机相比，容器镜像的创建更加容易。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("持续开发、集成和部署：")]),t._v(" 提供可靠且频繁的容器镜像构建/部署，并使用快速和简单的回滚(由于镜像不可变性)。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("开发和运行相分离：")]),t._v(" 在 build 或者 release 阶段创建容器镜像，使得应用和基础设施解耦。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("开发，测试和生产环境一致性：")]),t._v(" 在本地或外网（生产环境）运行的一致性。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("云平台或其他操作系统：")]),t._v(" 可以在 Ubuntu、RHEL、CoreOS、on-prem、Google Container Engine 或其它任何环境中运行。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("分布式，弹性，微服务化：")]),t._v(" 应用程序分为更小的、独立的部件，可以动态部署和管理。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("资源隔离")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("资源利用更高效")])])])]),t._v(" "),a("h3",{attrs:{id:"_2-3-为什么需要-kubernetes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-为什么需要-kubernetes"}},[t._v("#")]),t._v(" 2.3 为什么需要 Kubernetes")]),t._v(" "),a("p",[t._v("可以在物理或虚拟机的 Kubernetes 集群上运行容器化应用，Kubernetes 能提供一个以 "),a("strong",[t._v("“容器为中心的基础架构”")]),t._v("，满足在生产环境中运行应用的一些常见需求，如：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("自动化装箱")]),t._v("：在不牺牲可用性的条件下，基于容器对资源的要求和约束自动部署容器。同时，为了提高利用率和节省更多资源，将关键和最佳工作量结合在一起。")]),t._v(" "),a("li",[a("strong",[t._v("自愈能力")]),t._v("：当容器失败时，会对容器进行重启；当所部署的Node节点有问题时，会对容器进行重新部署和重新调度；当容器未通过监控检查时，会关闭此容器；直到容器正常运行时，才会对外提供服务。")]),t._v(" "),a("li",[a("strong",[t._v("水平扩容")]),t._v("：通过简单的命令、用户界面或基于CPU 的使用情况，能够对应用进行扩容和缩容。")]),t._v(" "),a("li",[a("strong",[t._v("服务发现和负载均衡")]),t._v("：开发者不需要使用额外的服务发现机制，就能够基于Kubernetes 进行服务发现和负载均衡。")]),t._v(" "),a("li",[a("strong",[t._v("自动发布和回滚")]),t._v("：Kubernetes 能够程序化的发布应用和相关的配置。如果发布有问题，Kubernetes 将能够回归发生的变更。")]),t._v(" "),a("li",[a("strong",[t._v("保密和配置管理")]),t._v("：在不需要重新构建镜像的情况下，可以部署和更新保密和应用配置。")]),t._v(" "),a("li",[a("strong",[t._v("存储编排")]),t._v("：自动挂接存储系统，这些存储系统可以来自于本地、公共云提供商（例如：GCP和AWS）、网络存储(例如：NFS、iSCSI、Gluster、Ceph、Cinder和Floker等)。")])]),t._v(" "),a("h2",{attrs:{id:"第-3-章-kubernetes-快速入门"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第-3-章-kubernetes-快速入门"}},[t._v("#")]),t._v(" 第 3 章 Kubernetes 快速入门")]),t._v(" "),a("h3",{attrs:{id:"_3-1-kubernetes-安装前准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-kubernetes-安装前准备"}},[t._v("#")]),t._v(" 3.1 Kubernetes 安装前准备")]),t._v(" "),a("h4",{attrs:{id:"概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),a("p",[t._v("本次安装采用 Ubuntu Server X64 18.04 LTS 版本安装 kubernetes 集群环境，集群节点为 1 主 2 从模式，此次对虚拟机会有些基本要求，如下：")]),t._v(" "),a("ul",[a("li",[t._v("OS：Ubuntu Server X64 18.04 LTS")]),t._v(" "),a("li",[t._v("CPU：最低要求，1 CPU 2 核")]),t._v(" "),a("li",[t._v("内存：最低要求，2GB")]),t._v(" "),a("li",[t._v("磁盘：最低要求，20GB")])]),t._v(" "),a("h4",{attrs:{id:"节点配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#节点配置"}},[t._v("#")]),t._v(" 节点配置")]),t._v(" "),a("p",[t._v("创建三台虚拟机，节点配置如下：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("主机名")]),t._v(" "),a("th",[t._v("IP")]),t._v(" "),a("th",[t._v("角色")]),t._v(" "),a("th",[t._v("系统")]),t._v(" "),a("th",[t._v("CUP/内存")]),t._v(" "),a("th",[t._v("磁盘")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("k8s-master")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("Master")]),t._v(" "),a("td",[t._v("Ubuntu Server 18.04")]),t._v(" "),a("td",[t._v("2 核 2G")]),t._v(" "),a("td",[t._v("20G")])]),t._v(" "),a("tr",[a("td",[t._v("k8s-node-01")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("Node")]),t._v(" "),a("td",[t._v("Ubuntu Server 18.04")]),t._v(" "),a("td",[t._v("2 核 2G")]),t._v(" "),a("td",[t._v("20G")])]),t._v(" "),a("tr",[a("td",[t._v("k8s-node-02")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("Node")]),t._v(" "),a("td",[t._v("Ubuntu Server 18.04")]),t._v(" "),a("td",[t._v("2 核 2G")]),t._v(" "),a("td",[t._v("20G")])])])]),t._v(" "),a("h3",{attrs:{id:"_3-2-统一环境配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-统一环境配置"}},[t._v("#")]),t._v(" 3.2 统一环境配置")]),t._v(" "),a("blockquote",[a("p",[t._v("注意：以下步骤请在制作 VMWare 镜像时一并完成, 避免逐台安装的麻烦。")])]),t._v(" "),a("h4",{attrs:{id:"关闭交互空间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭交互空间"}},[t._v("#")]),t._v(" 关闭交互空间")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("swapoff -a\n")])])]),a("h4",{attrs:{id:"避免开机启动交换空间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#避免开机启动交换空间"}},[t._v("#")]),t._v(" 避免开机启动交换空间")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注释 /etc/fstab 中的 swap")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/fstab\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /etc/fstab: static file system information.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Use 'blkid' to print the universally unique identifier for a")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# device; this may be used with UUID= as a more robust way to name devices")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# that works even if disks are added and removed. See fstab(5).")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# <file system> <mount point>   <type>  <options>       <dump>  <pass>")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# / was on /dev/ubuntu-vg/ubuntu-lv during curtin installation")]),t._v("\n/dev/disk/by-id/dm-uuid-LVM-rcRcdAdAApoq0jWHr6b2lt7nzFCwTHvsdjqttVuxIlK6RMu4kQbZVprrsZ0H7yvf / ext4 defaults "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /boot was on /dev/sda2 during curtin installation")]),t._v("\n/dev/disk/by-uuid/87384c47-a26e-4950-8352-ad8b3c7dacfb /boot ext4 defaults "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#/swap.img      none    swap    sw      0       0")]),t._v("\n")])])]),a("h4",{attrs:{id:"关闭防火墙"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭防火墙"}},[t._v("#")]),t._v(" 关闭防火墙")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("ufw disable\n")])])]),a("h4",{attrs:{id:"使用-apt-安装-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-apt-安装-docker"}},[t._v("#")]),t._v(" 使用 apt 安装 Docker")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 更新软件源")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装所需依赖")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" -y "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" apt-transport-https ca-certificates "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" software-properties-common\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装 GPG 证书")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" apt-key "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" -\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 新增软件源信息")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" add-apt-repository "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu '),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("lsb_release -cs"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(' stable"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 再次更新软件源")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" -y update\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装 Docker CE 版")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" -y "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" docker-ce\n")])])]),a("h4",{attrs:{id:"验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[t._v("#")]),t._v(" 验证")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("docker version\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("Client: Docker Engine - Community\n Version:           "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("19.03")]),t._v(".8\n API version:       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.40")]),t._v("\n Go version:        go1.12.17\n Git commit:        afacb8b7f0\n Built:             Wed Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" 01:25:46 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("\n OS/Arch:           linux/amd64\n Experimental:      "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n\nServer: Docker Engine - Community\n Engine:\n  Version:          "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("19.03")]),t._v(".8\n  API version:      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.40")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("minimum version "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.12")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  Go version:       go1.12.17\n  Git commit:       afacb8b7f0\n  Built:            Wed Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" 01:24:19 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("\n  OS/Arch:          linux/amd64\n  Experimental:     "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n containerd:\n  Version:          "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.2")]),t._v(".13\n  GitCommit:        7ad184331fa3e55e52b890ea95e65ba581ae3429\n runc:\n  Version:          "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),t._v(".0-rc10\n  GitCommit:        dc9208a3303feef5b3839f4323d9beb36df0a9dd\n docker-init:\n  Version:          "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.18")]),t._v(".0\n  GitCommit:        fec3683\n")])])]),a("h4",{attrs:{id:"配置-docker-加速器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-docker-加速器"}},[t._v("#")]),t._v(" 配置 Docker 加速器")]),t._v(" "),a("p",[t._v("对于使用 "),a("strong",[t._v("systemd")]),t._v(" 的系统，请在 "),a("code",[t._v("/etc/docker/daemon.json")]),t._v(" 中写入如下内容（如果文件不存在请新建该文件）")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"registry-mirrors"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://registry.docker-cn.com"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("注意，一定要保证该文件符合 JSON 规范，否则 Docker 将不能启动。")])]),t._v(" "),a("p",[t._v("验证加速器是否配置成功：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl restart docker\ndocker info\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 出现如下语句即表示配置成功")]),t._v("\nRegistry Mirrors:\n https://registry.docker-cn.com/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),a("h4",{attrs:{id:"安装-kubeadm，kubelet，kubectl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-kubeadm，kubelet，kubectl"}},[t._v("#")]),t._v(" 安装 kubeadm，kubelet，kubectl")]),t._v(" "),a("p",[t._v("kubeadm 是 kubernetes 的集群安装工具，能够快速安装 kubernetes 集群。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("配置软件源")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装系统工具")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y apt-transport-https\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装 GPG 证书")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" apt-key "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" -\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 写入软件源；注意：我们用系统代号为 bionic，但目前阿里云不支持，所以沿用 16.04 的 xenial")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" EOF "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/etc/apt/sources.list.d/kubernetes.list\ndeb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main\nEOF\n")])])])]),t._v(" "),a("li",[a("p",[t._v("安装kubeadm，kubelet，kubectl")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update  \n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y kubelet kubeadm kubectl\n")])])])]),t._v(" "),a("li",[a("p",[t._v("设置 kubelet 自启动， 并启动 kubelet")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" kubelet "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" systemctl start kubelet\n")])])]),a("blockquote",[a("p",[a("strong",[t._v("kubeadm")]),t._v("：用于初始化 Kubernetes 集群")]),t._v(" "),a("p",[a("strong",[t._v("kubectl")]),t._v("：Kubernetes 的命令行工具，主要作用是部署和管理应用，查看各种资源，创建，删除和更新组件")]),t._v(" "),a("p",[a("strong",[t._v("kubelet")]),t._v("：主要负责启动 Pod 和容器")])])])]),t._v(" "),a("h4",{attrs:{id:"同步时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同步时间"}},[t._v("#")]),t._v(" 同步时间")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("设定时区")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("dpkg-reconfigure tzdata\n")])])]),a("p",[a("img",{attrs:{src:e(213),alt:""}})]),t._v(" "),a("p",[t._v("选择 Asia -> 再选择 Shanghai -> OK")]),t._v(" "),a("p",[a("img",{attrs:{src:e(214),alt:""}})])]),t._v(" "),a("li",[a("p",[t._v("时间同步")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装ntpdate工具")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" ntpdate\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将系统时间与网络同步")]),t._v("\nntpdate cn.pool.ntp.org\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将时间写入硬件")]),t._v("\nhwclock --systohc\n")])])])]),t._v(" "),a("li",[a("p",[t._v("查看时间是否已同步")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("date")]),t._v("\n")])])])])]),t._v(" "),a("h4",{attrs:{id:"修改-cloud-cfg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改-cloud-cfg"}},[t._v("#")]),t._v(" 修改 cloud.cfg")]),t._v(" "),a("p",[t._v("主要作用是防止重启后主机名修改还原问题")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/cloud/cloud.cfg\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 该配置默认为 false，修改为 true 即可")]),t._v("\npreserve_hostname: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n")])])]),a("h4",{attrs:{id:"克隆虚拟机环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#克隆虚拟机环境"}},[t._v("#")]),t._v(" 克隆虚拟机环境")]),t._v(" "),a("p",[t._v("在完成上面统一配置后，我们将虚拟机重启下。重启完毕后, 就可以将这台基础服务器关机, 并用此虚拟机作为 k8s 基础服务器镜像, 然后分表克隆出三台服务器节点, 并为它们单独配置 "),a("strong",[t._v("IP")]),t._v(" 和 "),a("strong",[t._v("主机名")])]),t._v(" "),a("h3",{attrs:{id:"_3-3-单独节点配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-单独节点配置"}},[t._v("#")]),t._v(" 3.3 单独节点配置")]),t._v(" "),a("p",[t._v("在同一局域网中主机名不应该相同，所以我们需要做修改，下列操作步骤为修改 "),a("strong",[t._v("18.04")]),t._v(" 版本的 Hostname，如果是 16.04 或以下版本则直接修改 "),a("code",[t._v("/etc/hostname")]),t._v(" 里的名称即可")]),t._v(" "),a("h4",{attrs:{id:"修改主机名（各个节点分别修改）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改主机名（各个节点分别修改）"}},[t._v("#")]),t._v(" 修改主机名（各个节点分别修改）")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用 hostnamectl 命令修改，其中 kubernetes-master 为新的主机名")]),t._v("\nhostnamectl set-hostname kubernetes-master\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置 hosts")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" /etc/hosts "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("EOF\n10.10.50.xx kubernetes-master\nEOF")]),t._v("\n")])])]),a("h4",{attrs:{id:"重启"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重启"}},[t._v("#")]),t._v(" 重启")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("reboot")]),t._v("\n")])])]),a("h3",{attrs:{id:"_3-4-kubernetes-集群安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-kubernetes-集群安装"}},[t._v("#")]),t._v(" 3.4 Kubernetes 集群安装")]),t._v(" "),a("h4",{attrs:{id:"概述-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述-2"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),a("p",[t._v("安装 kubernetes 主要是安装它的各个镜像，而 kubeadm 已经为我们集成好了运行 kubernetes 所需的基本镜像。但由于国内的网络原因，在搭建环境时，无法拉取到这些镜像。此时我们只需要修改为阿里云提供的镜像服务即可解决该问题。")]),t._v(" "),a("h4",{attrs:{id:"创建并修改配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建并修改配置"}},[t._v("#")]),t._v(" 创建并修改配置")]),t._v(" "),a("p",[t._v("在 kubernetes-master 节点上")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建工作目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /usr/local/kubernetes/cluster\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /usr/local/kubernetes/cluster/\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 导出配置文件")]),t._v("\nkubeadm config print init-defaults --kubeconfig ClusterConfiguration "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" kubeadm.yml\n\n")])])]),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改配置文件内容")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubeadm.k8s.io/v1beta2\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bootstrapTokens")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("groups")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("bootstrappers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("kubeadm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("token\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("token")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" abcdef.0123456789abcdef\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ttl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 24h0m0s\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("usages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" signing\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" authentication\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" InitConfiguration\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("localAPIEndpoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改主节点 IP 地址")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("advertiseAddress")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.10.50.38\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bindPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6443")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeRegistration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("criSocket")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /var/run/dockershim.sock\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("taints")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("effect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NoSchedule\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("role.kubernetes.io/master\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeoutForControlPlane")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 4m0s\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubeadm.k8s.io/v1beta2\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("certificatesDir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/kubernetes/pki\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("clusterName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("controllerManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dns")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CoreDNS\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("etcd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("local")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dataDir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /var/lib/etcd\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 国内不能访问 Google, 修改镜像为阿里云")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imageRepository")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" registry.aliyuncs.com/google_containers\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterConfiguration\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubernetesVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1.18.0\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networking")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dnsDomain")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cluster.local\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置 Pod 所在网段为我们虚拟机不重叠的网段（这里用的是 flannel 默认网段）")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSubnet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.244.0.0/16"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceSubnet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.96.0.0/12\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scheduler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"查看和拉取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看和拉取镜像"}},[t._v("#")]),t._v(" 查看和拉取镜像")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看所需镜像列表")]),t._v("\nkubeadm config images list --config kubeadm.yml\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 拉取镜像")]),t._v("\nkubeadm config images pull --config kubeadm.yml\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("root@kubernetes-master:/usr/local/kubernetes/cluster"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubeadm config images list --config kubeadm.yml")]),t._v("\nregistry.aliyuncs.com/google_containers/kube-apiserver:v1.18.0\nregistry.aliyuncs.com/google_containers/kube-controller-manager:v1.18.0\nregistry.aliyuncs.com/google_containers/kube-scheduler:v1.18.0\nregistry.aliyuncs.com/google_containers/kube-proxy:v1.18.0\nregistry.aliyuncs.com/google_containers/pause:3.2\nregistry.aliyuncs.com/google_containers/etcd:3.4.3-0\nregistry.aliyuncs.com/google_containers/coredns:1.6.7\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("root@kubernetes-master:/usr/local/kubernetes/cluster"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubeadm config images pull --config kubeadm.yml")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config/images"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Pulled registry.aliyuncs.com/google_containers/kube-apiserver:v1.18.0\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config/images"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Pulled registry.aliyuncs.com/google_containers/kube-controller-manager:v1.18.0\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config/images"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Pulled registry.aliyuncs.com/google_containers/kube-scheduler:v1.18.0\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config/images"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Pulled registry.aliyuncs.com/google_containers/kube-proxy:v1.18.0\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config/images"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Pulled registry.aliyuncs.com/google_containers/pause:3.2\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config/images"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Pulled registry.aliyuncs.com/google_containers/etcd:3.4.3-0\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config/images"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Pulled registry.aliyuncs.com/google_containers/coredns:1.6.7\n")])])]),a("h4",{attrs:{id:"安装-kubernetes-master主节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-kubernetes-master主节点"}},[t._v("#")]),t._v(" 安装 kubernetes master主节点")]),t._v(" "),a("p",[t._v("执行以下命令初始化主节点，该命令指定了初始化时需要使用的配置文件，其中添加 "),a("code",[t._v("--upload-certs")]),t._v(" 参数可以在后续执行加入节点时自动分发证书文件。追加的 "),a("code",[t._v("tee kubeadm-init.log")]),t._v(" 用以输出日志。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("root@kubernetes-master:/usr/local/kubernetes/cluster"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubeadm init --config=kubeadm.yml --upload-certs | tee kubeadm-init.log")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装信息如下：")]),t._v("\nW0422 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(":39:10.202126   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64944")]),t._v(" configset.go:202"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" WARNING: kubeadm cannot validate component configs "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" API "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("groups")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet.config.k8s.io kubeproxy.config.k8s.io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using Kubernetes version: v1.18.0\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running pre-flight checks\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("WARNING IsDockerSystemdCheck"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": detected "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cgroupfs"')]),t._v(" as the Docker cgroup driver. The recommended driver is "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"systemd"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" Please follow the guide at https://kubernetes.io/docs/setup/cri/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Pulling images required "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" setting up a Kubernetes cluster\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" This might take a minute or two, depending on the speed of your internet connection\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" You can also perform this action "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" beforehand using "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubeadm config images pull'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing kubelet environment "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" with flags to "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/kubelet/kubeadm-flags.env"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing kubelet configuration to "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/kubelet/config.yaml"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Starting the kubelet\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using certificateDir folder "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/kubernetes/pki"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ca"')]),t._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"apiserver"')]),t._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" apiserver serving cert is signed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" DNS names "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubernetes-master kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" and IPs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.96")]),t._v(".0.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.38"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"apiserver-kubelet-client"')]),t._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"front-proxy-ca"')]),t._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"front-proxy-client"')]),t._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"etcd/ca"')]),t._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"etcd/server"')]),t._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" etcd/server serving cert is signed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" DNS names "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubernetes-master localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" and IPs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.38 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1 ::1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"etcd/peer"')]),t._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" etcd/peer serving cert is signed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" DNS names "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubernetes-master localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" and IPs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.38 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1 ::1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"etcd/healthcheck-client"')]),t._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"apiserver-etcd-client"')]),t._v(" certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sa"')]),t._v(" key and public key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubeconfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using kubeconfig folder "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/kubernetes"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubeconfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"admin.conf"')]),t._v(" kubeconfig "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubeconfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubelet.conf"')]),t._v(" kubeconfig "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubeconfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"controller-manager.conf"')]),t._v(" kubeconfig "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubeconfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scheduler.conf"')]),t._v(" kubeconfig "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using manifest folder "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/kubernetes/manifests"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Creating static Pod manifest "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kube-apiserver"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Creating static Pod manifest "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kube-controller-manager"')]),t._v("\nW0422 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(":39:13.732379   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64944")]),t._v(" manifests.go:225"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" the default kube-apiserver authorization-mode is "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Node,RBAC"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" using "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Node,RBAC"')]),t._v("\nW0422 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(":39:13.733814   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64944")]),t._v(" manifests.go:225"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" the default kube-apiserver authorization-mode is "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Node,RBAC"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" using "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Node,RBAC"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Creating static Pod manifest "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kube-scheduler"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("etcd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Creating static Pod manifest "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v(" etcd "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/kubernetes/manifests"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("wait-control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Waiting "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the kubelet to boot up the control plane as static Pods from directory "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/kubernetes/manifests"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" This can take up to 4m0s\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("apiclient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" All control plane components are healthy after "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("26.003179")]),t._v(" seconds\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upload-config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Storing the configuration used "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" ConfigMap "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubeadm-config"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kube-system"')]),t._v(" Namespace\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Creating a ConfigMap "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubelet-config-1.18"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" namespace kube-system with the configuration "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the kubelets "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the cluster\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upload-certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Storing the certificates "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" Secret "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubeadm-certs"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kube-system"')]),t._v(" Namespace\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upload-certs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using certificate key:\ne2ae2e0a251263e68ee121fff04c8b4605d1cd50224a4085817f4375f6bb7273\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mark-control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Marking the node kubernetes-master as control-plane by adding the label "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"node-role.kubernetes.io/master=''\"")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mark-control-plane"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Marking the node kubernetes-master as control-plane by adding the taints "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("node-role.kubernetes.io/master:NoSchedule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bootstrap-token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using token: abcdef.0123456789abcdef\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bootstrap-token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bootstrap-token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" configured RBAC rules to allow Node Bootstrap tokens to get nodes\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bootstrap-token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" configured RBAC rules to allow Node Bootstrap tokens to post CSRs "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" order "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" nodes to get long term certificate credentials\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bootstrap-token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bootstrap-token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" configured RBAC rules to allow certificate rotation "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" all node client certificates "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the cluster\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bootstrap-token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Creating the "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cluster-info"')]),t._v(" ConfigMap "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kube-public"')]),t._v(" namespace\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-finalize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Updating "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/kubernetes/kubelet.conf"')]),t._v(" to point to a rotatable kubelet client certificate and key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("addons"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Applied essential addon: CoreDNS\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("addons"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Applied essential addon: kube-proxy\n\nYour Kubernetes control-plane has initialized successfully"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -i /etc/kubernetes/admin.conf "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube/config\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" -u"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" -g"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube/config\n\nYou should now deploy a pod network to the cluster.\nRun "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubectl apply -f [podnetwork].yaml"')]),t._v(" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" any number of worker nodes by running the following on each as root:\n\nkubeadm "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.38:6443 --token abcdef.0123456789abcdef "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --discovery-token-ca-cert-hash sha256:433b194618efc80f0cf6cdc5fa2fd8930c428c9bfb9e61b931a9cfe062b9c3b8 \n")])])]),a("h4",{attrs:{id:"配置-kubectl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-kubectl"}},[t._v("#")]),t._v(" 配置 kubectl")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 参考上面输出")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -i /etc/kubernetes/admin.conf "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube/config\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 非 ROOT 用户执行")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" -u"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" -g"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube/config\n")])])]),a("h4",{attrs:{id:"验证是否成功"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证是否成功"}},[t._v("#")]),t._v(" 验证是否成功")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("kubectl get node\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 能够打印出节点信息即表示成功")]),t._v("\nNAME                STATUS     ROLES    AGE     VERSION\nkubernetes-master   NotReady   master   4m12s   v1.18.2\n")])])]),a("p",[t._v("至此主节点配置完成。")]),t._v(" "),a("h4",{attrs:{id:"使用-kubeadm-配置-slave-节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-kubeadm-配置-slave-节点"}},[t._v("#")]),t._v(" 使用 kubeadm 配置 slave 节点")]),t._v(" "),a("p",[t._v("将 slave 节点加入到集群中很简单，只需要在 slave 服务器上安装 kubeadm，kubectl，kubelet 三个工具，然后使用 "),a("code",[t._v("kubeadm join")]),t._v(" 命令加入即可。准备工作如下：")]),t._v(" "),a("ul",[a("li",[t._v("修改主机名")]),t._v(" "),a("li",[t._v("配置软件源")]),t._v(" "),a("li",[t._v("安装三个工具")])]),t._v(" "),a("p",[t._v("由于之前章节已经操作完成，此处不再赘述。")]),t._v(" "),a("p",[t._v("这里我们只需要借助于上面 master 节点 kubeadm 生成的命令将 slave 加入集群即可。")]),t._v(" "),a("p",[t._v("分别在 kubernetes-node-01 和 kubernetes-node-02 节点上执行下面命令。")]),t._v(" "),a("h4",{attrs:{id:"将-slave-加入到集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将-slave-加入到集群"}},[t._v("#")]),t._v(" 将 slave 加入到集群")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubeadm join 10.10.50.38:6443 --token abcdef.0123456789abcdef --discovery-token-ca-cert-hash sha256:433b194618efc80f0cf6cdc5fa2fd8930c428c9bfb9e61b931a9cfe062b9c3b8 ")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 成功信息如下：")]),t._v("\nW0422 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(":54:12.792739   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("68348")]),t._v(" join.go:346"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" WARNING: JoinControlPane.controlPlane settings will be ignored when control-plane flag is not set.\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running pre-flight checks\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("WARNING IsDockerSystemdCheck"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": detected "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cgroupfs"')]),t._v(" as the Docker cgroup driver. The recommended driver is "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"systemd"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" Please follow the guide at https://kubernetes.io/docs/setup/cri/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Reading configuration from the cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" FYI: You can "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("look")]),t._v(" at this config "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" with "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubectl -n kube-system get cm kubeadm-config -oyaml'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Downloading configuration "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the kubelet from the "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubelet-config-1.18"')]),t._v(" ConfigMap "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the kube-system namespace\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing kubelet configuration to "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/kubelet/config.yaml"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing kubelet environment "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" with flags to "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/kubelet/kubeadm-flags.env"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Starting the kubelet\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Waiting "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the kubelet to perform the TLS Bootstrap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\nThis node has joined the cluster:\n* Certificate signing request was sent to apiserver and a response was received.\n* The Kubelet was informed of the new secure connection details.\n\nRun "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubectl get nodes'")]),t._v(" on the control-plane to see this node "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" the cluster.\n\n")])])]),a("p",[t._v("说明：")]),t._v(" "),a("ul",[a("li",[t._v("token\n"),a("ul",[a("li",[t._v("可以通过安装 master 时的日志查看 token 信息")]),t._v(" "),a("li",[t._v("可以通过 "),a("code",[t._v("kubeadm token list")]),t._v(" 命令打印出 token 信息")]),t._v(" "),a("li",[t._v("如果 token 过期，可以使用 "),a("code",[t._v("kubeadm token create")]),t._v(" 命令创建新的 token")])])]),t._v(" "),a("li",[t._v("discovery-token-ca-cert-hash\n"),a("ul",[a("li",[t._v("可以通过安装 master 时的日志查看 sha256 信息")]),t._v(" "),a("li",[t._v("可以通过 "),a("code",[t._v("openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'")]),t._v(" 命令查看 sha256 信息")])])])]),t._v(" "),a("h4",{attrs:{id:"验证是否成功-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证是否成功-2"}},[t._v("#")]),t._v(" 验证是否成功")]),t._v(" "),a("p",[t._v("回到 master 服务器")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("kubectl get nodes\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以看到如下信息证明 slave 加入 master 成功")]),t._v("\nNAME                 STATUS     ROLES    AGE     VERSION\nkubernetes-master    NotReady   master   18m     v1.18.2\nkubernetes-node-01   NotReady   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("   3m31s   v1.18.2\nkubernetes-node-02   NotReady   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("   35s     v1.18.2\n")])])]),a("blockquote",[a("p",[t._v("如果 slave 节点加入 master 时配置有问题可以在 slave 节点上使用 "),a("code",[t._v("kubeadm reset")]),t._v(" 重置配置再使用 "),a("code",[t._v("kubeadm join")]),t._v(" 命令重新加入即可。希望在 master 节点删除 node ，可以使用 "),a("code",[t._v("kubeadm delete nodes")]),t._v(" 删除。")])]),t._v(" "),a("h5",{attrs:{id:"查看-pod-状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看-pod-状态"}},[t._v("#")]),t._v(" 查看 pod 状态")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("kubectl get pod -n kube-system -o wide\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 信息如下：")]),t._v("\nNAME                                        READY   STATUS    RESTARTS   AGE     IP             NODE                 NOMINATED NODE   READINESS GATES\ncoredns-7ff77c879f-8xfdq                    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("/1     Pending   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          19m     "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\ncoredns-7ff77c879f-vfvtq                    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("/1     Pending   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          19m     "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\netcd-kubernetes-master                      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          19m     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.38    kubernetes-master    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-apiserver-kubernetes-master            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          19m     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.38    kubernetes-master    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-controller-manager-kubernetes-master   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          19m     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.38    kubernetes-master    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-proxy-p7qsf                            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          19m     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.38    kubernetes-master    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-proxy-v4c4s                            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          5m7s    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.221   kubernetes-node-01   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-proxy-v7cxf                            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          2m11s   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.135   kubernetes-node-02   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-scheduler-kubernetes-master            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          19m     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".50.38    kubernetes-master    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n")])])]),a("p",[t._v("可以看出 coredns 尚未运行，此时我们还需要安装网络插件。")]),t._v(" "),a("h3",{attrs:{id:"_3-5-kubernetes-网络配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-kubernetes-网络配置"}},[t._v("#")]),t._v(" 3.5 Kubernetes 网络配置")]),t._v(" "),a("h4",{attrs:{id:"概述-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述-3"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),a("p",[t._v("容器网络是容器选择连接到其他容器、主机和外部网络的机制。容器的 runtime 提供了各种网络模式，每种模式都会产生不同的体验。例如，Docker 默认情况下可以为容器配置以下网络：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("none：")]),t._v(" 将容器添加到一个容器专门的网络堆栈中，没有对外连接。")]),t._v(" "),a("li",[a("strong",[t._v("host：")]),t._v(" 将容器添加到主机的网络堆栈中，没有隔离。")]),t._v(" "),a("li",[a("strong",[t._v("default bridge：")]),t._v(" 默认网络模式。每个容器可以通过 IP 地址相互连接。")]),t._v(" "),a("li",[a("strong",[t._v("自定义网桥：")]),t._v(" 用户定义的网桥，具有更多的灵活性、隔离性和其他便利功能。")])]),t._v(" "),a("h4",{attrs:{id:"什么是-cni"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是-cni"}},[t._v("#")]),t._v(" 什么是 CNI")]),t._v(" "),a("p",[t._v("CNI(Container Network Interface) 是一个标准的，通用的接口。在容器平台，Docker，Kubernetes，Mesos 容器网络解决方案 flannel，calico，weave。只要提供一个标准的接口，就能为同样满足该协议的所有容器平台提供网络功能，而 CNI 正是这样的一个标准接口协议。")]),t._v(" "),a("h4",{attrs:{id:"kubernetes-中的-cni-插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-中的-cni-插件"}},[t._v("#")]),t._v(" Kubernetes 中的 CNI 插件")]),t._v(" "),a("p",[t._v("CNI 的初衷是创建一个框架，用于在配置或销毁容器时动态配置适当的网络配置和资源。插件负责为接口配置和管理 IP 地址，并且通常提供与 IP 管理、每个容器的 IP 分配、以及多主机连接相关的功能。容器运行时会调用网络插件，从而在容器启动时分配 IP 地址并配置网络，并在删除容器时再次调用它以清理这些资源。")]),t._v(" "),a("p",[t._v("运行时或协调器决定了容器应该加入哪个网络以及它需要调用哪个插件。然后，插件会将接口添加到容器网络命名空间中，作为一个 veth 对的一侧。接着，它会在主机上进行更改，包括将 veth 的其他部分连接到网桥。再之后，它会通过调用单独的 IPAM（IP地址管理）插件来分配 IP 地址并设置路由。")]),t._v(" "),a("p",[t._v("在 Kubernetes 中，kubelet 可以在适当的时间调用它找到的插件，为通过 kubelet 启动的 pod进行自动的网络配置。")]),t._v(" "),a("p",[t._v("Kubernetes 中可选的 CNI 插件如下：")]),t._v(" "),a("ul",[a("li",[t._v("Flannel")]),t._v(" "),a("li",[t._v("Calico")]),t._v(" "),a("li",[t._v("Canal")]),t._v(" "),a("li",[t._v("Weave")])]),t._v(" "),a("h4",{attrs:{id:"什么是-calico"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是-calico"}},[t._v("#")]),t._v(" 什么是 Calico")]),t._v(" "),a("p",[t._v("Calico 为容器和虚拟机提供了安全的网络连接解决方案，并经过了大规模生产验证（在公有云和跨数千个集群节点中），可与 Kubernetes，OpenShift，Docker，Mesos，DC / OS 和 OpenStack 集成。")]),t._v(" "),a("p",[t._v("Calico 还提供网络安全规则的动态实施。使用 Calico 的简单策略语言，您可以实现对容器，虚拟机工作负载和裸机主机端点之间通信的细粒度控制。")]),t._v(" "),a("h4",{attrs:{id:"安装网络插件-calico"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装网络插件-calico"}},[t._v("#")]),t._v(" 安装网络插件 Calico")]),t._v(" "),a("p",[t._v("参考官方文档安装：https://docs.projectcalico.org/getting-started/kubernetes/quickstart")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml\n")])])]),a("h4",{attrs:{id:"确定安装是否成功"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#确定安装是否成功"}},[t._v("#")]),t._v(" 确定安装是否成功")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("watch")]),t._v(" kubectl get pods --all-namespaces\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 需要等待所有状态为 Running，注意时间可能较久，3 - 5 分钟的样子")]),t._v("\nNAMESPACE     NAME                                        READY   STATUS    RESTARTS   AGE\nkube-system   calico-kube-controllers-555fc8cc5c-2m6xd    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          3m55s\nkube-system   calico-node-d6lnp                           "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          3m55s\nkube-system   calico-node-gtgpk                           "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          3m55s\nkube-system   calico-node-wpw8r                           "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          3m55s\nkube-system   coredns-7ff77c879f-8xfdq                    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          42m\nkube-system   coredns-7ff77c879f-vfvtq                    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          42m\nkube-system   etcd-kubernetes-master                      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          42m\nkube-system   kube-apiserver-kubernetes-master            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          42m\nkube-system   kube-controller-manager-kubernetes-master   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          42m\nkube-system   kube-proxy-p7qsf                            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          42m\nkube-system   kube-proxy-v4c4s                            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          28m\nkube-system   kube-proxy-v7cxf                            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          25m\nkube-system   kube-scheduler-kubernetes-master            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          42m\n")])])]),a("h4",{attrs:{id:"解决-imagepullbackoff"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决-imagepullbackoff"}},[t._v("#")]),t._v(" 解决 ImagePullBackOff")]),t._v(" "),a("p",[t._v("在使用 "),a("code",[t._v("watch kubectl get pods --all-namespaces")]),t._v(" 命令观察 Pods 状态时如果出现 "),a("code",[t._v("ImagePullBackOff")]),t._v(" 无法 Running 的情况，请尝试使用如下步骤处理：")]),t._v(" "),a("ul",[a("li",[t._v("Master 中删除 Nodes："),a("code",[t._v("kubectl delete nodes")])]),t._v(" "),a("li",[t._v("Slave 中重置配置："),a("code",[t._v("kubeadm reset")])]),t._v(" "),a("li",[t._v("Slave 重启计算机："),a("code",[t._v("reboot")])]),t._v(" "),a("li",[t._v("Slave 重新加入集群："),a("code",[t._v("kubeadm join")])])]),t._v(" "),a("p",[t._v("至此基本集群环境已部署完毕。")]),t._v(" "),a("h3",{attrs:{id:"_3-6-第一个-kubernetes-容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-第一个-kubernetes-容器"}},[t._v("#")]),t._v(" 3.6 第一个 Kubernetes 容器")]),t._v(" "),a("h4",{attrs:{id:"检查组件运行状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检查组件运行状态"}},[t._v("#")]),t._v(" 检查组件运行状态")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在 master 节点执行")]),t._v("\nkubectl get cs\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出如下")]),t._v("\nNAME                 STATUS    MESSAGE             ERROR\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 调度服务，主要作用是将 POD 调度到 Node")]),t._v("\nscheduler            Healthy   ok                  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 自动化修复服务，主要作用是 Node 宕机后自动修复 Node 回到正常的工作状态")]),t._v("\ncontroller-manager   Healthy   ok                  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务注册与发现")]),t._v("\netcd-0               Healthy   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"health"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n")])])]),a("h4",{attrs:{id:"检查-master-状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检查-master-状态"}},[t._v("#")]),t._v(" 检查 Master 状态")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl cluster-info")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 主节点状态")]),t._v("\nKubernetes master is running at https://10.10.50.38:6443\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# DNS 状态")]),t._v("\nKubeDNS is running at https://10.10.50.38:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\n\nTo further debug and diagnose cluster problems, use "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubectl cluster-info dump'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n")])])]),a("h4",{attrs:{id:"检查-nodes-状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检查-nodes-状态"}},[t._v("#")]),t._v(" 检查 Nodes 状态")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get nodes")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出如下，STATUS 为 Ready 即为正常状态")]),t._v("\nNAME                 STATUS   ROLES    AGE   VERSION\nkubernetes-master    Ready    master   49m   v1.18.2\nkubernetes-node-01   Ready    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("   34m   v1.18.2\nkubernetes-node-02   Ready    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("   31m   v1.18.2\n")])])]),a("h4",{attrs:{id:"运行第一个容器实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行第一个容器实例"}},[t._v("#")]),t._v(" 运行第一个容器实例")]),t._v(" "),a("p",[t._v("下面是 Deployment 示例, 使用 yaml 声明式方式。创建一个 ReplicaSet 展开两个 "),a("code",[t._v("nginx")]),t._v(" Pods：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vi nginx-deployment.yaml")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 内容如下")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("deployment\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("1.14.2\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f nginx-deployment.yaml")]),t._v("\n")])])]),a("h4",{attrs:{id:"查看全部-pods-的状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看全部-pods-的状态"}},[t._v("#")]),t._v(" 查看全部 Pods 的状态")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get pods -o wide")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出如下，需要等待一小段实践，STATUS 为 Running 即为运行成功")]),t._v("\nNAME                                READY   STATUS    RESTARTS   AGE    IP               NODE                 NOMINATED NODE   READINESS GATES\nnginx-deployment-6b474476c4-tpsdt   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          104s   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".140.69    kubernetes-node-02   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nnginx-deployment-6b474476c4-wkvm2   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          104s   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".141.195   kubernetes-node-01   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("h4",{attrs:{id:"查看已部署的服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看已部署的服务"}},[t._v("#")]),t._v(" 查看已部署的服务")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get deployment")]),t._v("\nNAME               READY   UP-TO-DATE   AVAILABLE   AGE\nnginx-deployment   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("/2     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("           6m4s\n\n")])])]),a("h4",{attrs:{id:"映射服务，让用户可以访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#映射服务，让用户可以访问"}},[t._v("#")]),t._v(" 映射服务，让用户可以访问")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl expose deployment nginx-deployment --port=80 --type=LoadBalancer")]),t._v("\nservice/nginx-deployment exposed\n")])])]),a("h4",{attrs:{id:"创建已发布服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建已发布服务"}},[t._v("#")]),t._v(" 创建已发布服务")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("root@kubernetes-master:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl get services")]),t._v("\nNAME               TYPE           CLUSTER-IP      EXTERNAL-IP   PORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("        AGE\nkubernetes         ClusterIP      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.96")]),t._v(".0.1       "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("/TCP        124m\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 由此可见，Nginx 服务已成功发布并将 80 端口映射为 32211")]),t._v("\nnginx-deployment   LoadBalancer   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.99")]),t._v(".226.196   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("pending"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(":32211/TCP   9s\n")])])]),a("h4",{attrs:{id:"查看服务详情"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看服务详情"}},[t._v("#")]),t._v(" 查看服务详情")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl describe service nginx-deployment")]),t._v("\nName:                     nginx-deployment\nNamespace:                default\nLabels:                   "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx\nAnnotations:              "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nSelector:                 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx\nType:                     LoadBalancer\nIP:                       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.99")]),t._v(".226.196\nPort:                     "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("unset"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/TCP\nTargetPort:               "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/TCP\nNodePort:                 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("unset"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("32211")]),t._v("/TCP\nEndpoints:                "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".140.68:80,10.244.140.69:80,10.244.141.195:80\nSession Affinity:         None\nExternal Traffic Policy:  Cluster\nEvents:                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("h4",{attrs:{id:"验证是否成功-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证是否成功-3"}},[t._v("#")]),t._v(" 验证是否成功")]),t._v(" "),a("p",[t._v("通过浏览器访问 Master 服务器:http://10.10.50.38:32211/")]),t._v(" "),a("p",[a("img",{attrs:{src:e(215),alt:""}})]),t._v(" "),a("p",[t._v("此时 Kubernetes 会以负载均衡的方式访问部署的 Nginx 服务，能够正常看到 Nginx 的欢迎页即表示成功。容器实际部署在其它 Node 节点上，通过访问 Node 节点的 IP:Port 也是可以的。")]),t._v(" "),a("h4",{attrs:{id:"停止服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#停止服务"}},[t._v("#")]),t._v(" 停止服务")]),t._v(" "),a("ul",[a("li",[t._v("删除已部署的服务")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl delete deployment nginx-deployment")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出如下")]),t._v("\ndeployment.extensions "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx-deployment"')]),t._v(" deleted\n")])])]),a("ul",[a("li",[t._v("删除已发布的服务")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl delete service nginx")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出如下")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx-deployment"')]),t._v(" deleted\n")])])]),a("h2",{attrs:{id:"第-4-章-kubernetes-核心功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第-4-章-kubernetes-核心功能"}},[t._v("#")]),t._v(" 第 4 章 Kubernetes 核心功能")]),t._v(" "),a("h3",{attrs:{id:"_4-1-调度"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-调度"}},[t._v("#")]),t._v(" 4.1 调度")]),t._v(" "),a("p",[t._v("Kubernetes 可以把用户提交的容器放到 Kubernetes 管理的集群的某一台节点上去。Kubernetes 的调度器是执行这项能力的组件，它会观察正在被调度的这个容器的大小、规格。")]),t._v(" "),a("p",[t._v("比如说它所需要的 CPU 以及它所需要的 memory，然后在集群中找一台相对比较空闲的机器来进行一次 placement，也就是一次放置的操作。在这个例子中，它可能会把红颜色的这个容器放置到第二个空闲的机器上，来完成一次调度的工作。")]),t._v(" "),a("p",[a("img",{attrs:{src:e(216),alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_4-2-自动修复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-自动修复"}},[t._v("#")]),t._v(" 4.2 自动修复")]),t._v(" "),a("p",[t._v("Kubernetes 有一个节点健康检查的功能，它会监测这个集群中所有的宿主机，当宿主机本身出现故障，或者软件出现故障的时候，这个节点健康检查会自动对它进行发现。")]),t._v(" "),a("p",[t._v("下面 Kubernetes 会把运行在这些失败节点上的容器进行自动迁移，迁移到一个正在健康运行的宿主机上，来完成集群内容器的一个自动恢复。")]),t._v(" "),a("p",[a("img",{attrs:{src:e(217),alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_4-3-水平伸缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-水平伸缩"}},[t._v("#")]),t._v(" 4.3 水平伸缩")]),t._v(" "),a("p",[t._v("Kubernetes 有业务负载检查的能力，它会监测业务上所承担的负载，如果这个业务本身的 CPU 利用率过高，或者响应时间过长，它可以对这个业务进行一次扩容。")]),t._v(" "),a("p",[t._v("比如说在下面的例子中，黄颜色的过度忙碌，Kubernetes 就可以把黄颜色负载从一份变为三份。接下来，它就可以通过负载均衡把原来打到第一个黄颜色上的负载平均分到三个黄颜色的负载上去，以此来提高响应的时间。")]),t._v(" "),a("p",[a("img",{attrs:{src:e(218),alt:""}})]),t._v(" "),a("h2",{attrs:{id:"第-5-章-kubernetes-架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第-5-章-kubernetes-架构"}},[t._v("#")]),t._v(" 第 5 章 Kubernetes 架构")]),t._v(" "),a("p",[t._v("Kubernetes 是一个开源的 "),a("strong",[t._v("Docker 容器编排系统")]),t._v("，它可以调度计算集群的节点，动态管理上面的作业，保证它们按用户期望的状态运行。通过使用「labels」和「pods」的概念，Kubernetes 将应用按逻辑单元进行分组，方便管理和服务发现。")]),t._v(" "),a("p",[a("img",{attrs:{src:e(219),alt:""}})]),t._v(" "),a("p",[t._v("Kubernetes 架构是一个比较典型的二层架构和 server-client 架构。Master 作为"),a("strong",[t._v("中央的管控节点")]),t._v("，会去与 "),a("strong",[t._v("Node")]),t._v(" 进行一个连接。")]),t._v(" "),a("p",[t._v("所有 UI 的、clients、这些 user 侧的组件，只会和 Master 进行连接，把希望的状态或者想执行的命令下发给 Master，Master 会把这些命令或者状态下发给相应的节点，进行最终的执行。")]),t._v(" "),a("p",[a("img",{attrs:{src:e(220),alt:""}})]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("pods：")]),t._v(" 是一组紧密关联的容器集合，它们共享 IPC(进程间通信)、Network(网络) 和 UTS namespace(UTS 命名空间是 Linux 命名空间的一个子系统，主要作用是完成对容器 Hostname 和 Domain 的隔离，同时保存内核名称、版本、以及底层体系结构类型等信息)，是 Kubernetes 调度的基本单位。")]),t._v(" "),a("li",[a("strong",[t._v("labels：")]),t._v(" 键值对(key/value)标签，可以被关联到如 Pod 这样的对象上，主要作用是给用户一个直观的感受，比如这个 Pod 是用来放置数据库的。")]),t._v(" "),a("li",[a("strong",[t._v("GUI：")]),t._v(" 用户图形界面，可以是 Web 用户界面，比如使用 "),a("code",[t._v("kubernetes-dashboard")]),t._v(" 组件，用户可以通过 Dashboard 在 Kubernetes 集群中部署容器化的应用，可以查看集群中应用的运行情况，同时也能够基于 Dashboard 创建或修改部署、任务、服务等 Kubernetes 的资源。通过部署向导，用户能够对部署进行扩缩容，进行滚动更新、重启 Pod 和部署新应用。当然，通过 Dashboard 也能够查看 Kubernetes 资源的状态。")]),t._v(" "),a("li",[a("strong",[t._v("kubectl：")]),t._v(" 用于管理 Kubernetes 集群的命令行工具。")]),t._v(" "),a("li",[a("strong",[t._v("kube-apiserver：")]),t._v(" 提供了资源操作的唯一入口，并提供认证、授权、访问控制、API 注册和发现等机制")]),t._v(" "),a("li",[a("strong",[t._v("Kubernetes Master：")]),t._v(" Kubernetes 集群主节点，主要由 "),a("code",[t._v("kube-apiserver")]),t._v("、"),a("code",[t._v("kube-scheduler")]),t._v("、"),a("code",[t._v("kube-controller-manager")]),t._v("、"),a("code",[t._v("etcd")]),t._v(" 四个模块组成。")]),t._v(" "),a("li",[a("strong",[t._v("Kubernetes Node：")]),t._v(" Kubernetes 集群子节点，主要由 "),a("code",[t._v("kubelet")]),t._v("、"),a("code",[t._v("kube-proxy")]),t._v("、"),a("code",[t._v("runtime")]),t._v(" 三个模块组成。")]),t._v(" "),a("li",[a("strong",[t._v("Image Registry：")]),t._v(" 镜像仓库，比如：Ducker HUB 或 Docker 私服。")])]),t._v(" "),a("h3",{attrs:{id:"_5-1-master"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-master"}},[t._v("#")]),t._v(" 5.1 Master")]),t._v(" "),a("p",[t._v("Master 是 Cluster 的大脑，它的主要职责是调度，即决定将应用放在哪里运行。Master 运行 Linux 操作系统，可以是物理机或者虚拟机。为了实现高可用，可以运行多个 Master。")]),t._v(" "),a("p",[t._v("Kubernetes 的 Master 包含四个主要的组件：API Server、Controller、Scheduler 以及 etcd。")]),t._v(" "),a("p",[a("img",{attrs:{src:e(221),alt:""}})]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("kube-apiserver")])]),t._v(" "),a("p",[t._v("顾名思义是用来处理 API 操作的，Kubernetes 中所有的组件都会和 API Server 进行连接，组件与组件之间一般不进行独立的连接，都依赖于 API Server 进行消息的传送；")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("kube-controller-manager")])]),t._v(" "),a("p",[t._v("用于执行大部分的集群层次的功能，它既执行生命周期功能(例如：命名空间创建和生命周期、事件垃圾收集、已终止垃圾收集、级联删除垃圾收集、node垃圾收集)，也执行API业务逻辑（例如：pod的弹性扩容）。控制管理提供自愈能力、扩容、应用生命周期管理、服务发现、路由、服务绑定和提供。Kubernetes默认提供Replication Controller、Node Controller、Namespace Controller、Service Controller、Endpoints Controller、Persistent Controller、DaemonSet Controller等控制器。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("kube-scheduler")])]),t._v(" "),a("p",[t._v("scheduler组件为容器自动选择运行的主机。依据请求资源的可用性，服务请求的质量等约束条件，scheduler监控未绑定的pod，并将其绑定至特定的node节点。Kubernetes也支持用户自己提供的调度器，Scheduler负责根据调度策略自动将Pod部署到合适Node中，调度策略分为预选策略和优选策略，Pod的整个调度过程分为两步：")]),t._v(" "),a("p",[t._v("1）预选Node：遍历集群中所有的Node，按照具体的预选策略筛选出符合要求的Node列表。如没有Node符合预选策略规则，该Pod就会被挂起，直到集群中出现符合要求的Node。")]),t._v(" "),a("p",[t._v("2）优选Node：预选Node列表的基础上，按照优选策略为待选的Node进行打分和排序，从中获取最优Node。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("etcd：")]),t._v(" CoreOS 基于 Raft 开发的分布式 key-value 存储，可用于服务发现、共享配置以及一致性保障（如数据库选主、分布式锁等）")])])]),t._v(" "),a("h3",{attrs:{id:"_5-2-node"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-node"}},[t._v("#")]),t._v(" 5.2 "),a("strong",[t._v("Node")])]),t._v(" "),a("p",[t._v("Node 的职责是运行容器应用。Node 由 Master 管理，Node 负责监控并汇报容器的状态，并根据 Master 的要求管理容器的生命周期。Node 运行在 Linux 操作系统，可以是物理机或者是虚拟机。")]),t._v(" "),a("p",[a("img",{attrs:{src:e(222),alt:""}})]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("Kubelet")])]),t._v(" "),a("p",[t._v("Kubelet是Kubernetes中最主要的控制器，它是Pod和Node API的主要实现者，Kubelet负责驱动容器执行层。在Kubernetes中，应用容器彼此是隔离的，并且与运行其的主机也是隔离的，这是对应用进行独立解耦管理的关键点。")]),t._v(" "),a("p",[t._v("在Kubernets中，Pod作为基本的执行单元，它可以拥有多个容器和存储数据卷，能够方便在每个容器中打包一个单一的应用，从而解耦了应用构建时和部署时的所关心的事项，已经能够方便在物理机/虚拟机之间进行迁移。API准入控制可以拒绝或者Pod，或者为Pod添加额外的调度约束，但是Kubelet才是Pod是否能够运行在特定Node上的最终裁决者，而不是scheduler或者DaemonSet。kubelet默认情况使用cAdvisor进行资源监控。"),a("strong",[t._v("负责管理Pod、容器、镜像、数据卷等，实现集群对节点的管理，并将容器的运行状态汇报给Kubernetes API Server")]),t._v("。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Container Runtime")])]),t._v(" "),a("p",[t._v("每一个Node都会运行一个Container Runtime，其负责下载镜像和运行容器。Kubernetes本身并不提供容器运行时环境，但提供了接口，可以插入所选择的容器运行时环境。kubelet使用Unix socket之上的gRPC框架与容器运行时进行通信，kubelet作为客户端，而CRI shim作为服务器。")]),t._v(" "),a("p",[a("img",{attrs:{src:e(223),alt:""}})]),t._v(" "),a("p",[t._v("protocol buffers API提供两个gRPC服务，ImageService和RuntimeService。ImageService提供拉取、查看、和移除镜像的RPC。RuntimeSerivce则提供管理Pods和容器生命周期管理的RPC，以及与容器进行交互(exec/attach/port-forward)。容器运行时能够同时管理镜像和容器（例如：Docker和Rkt），并且可以通过同一个套接字提供这两种服务。在Kubelet中，这个套接字通过*–container-runtime-endpoint"),a("em",[t._v("和")]),t._v("–image-service-endpoint*字段进行设置。Kubernetes CRI支持的容器运行时包括docker、rkt、cri-o、frankti、kata-containers和clear-containers等, 默认的容器运行时为 Docker。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Kube proxy")])]),t._v(" "),a("p",[t._v("基于一种公共访问策略（例如：负载均衡），服务提供了一种访问一群pod的途径。此方式通过创建一个虚拟的IP来实现，客户端能够访问此IP，并能够将服务透明的代理至Pod。每一个Node都会运行一个kube-proxy，kube proxy通过iptables规则引导访问至服务IP，并将重定向至正确的后端应用，通过这种方式kube-proxy提供了一个高可用的负载均衡解决方案。服务发现主要通过DNS实现。")]),t._v(" "),a("p",[t._v("在Kubernetes中，kube proxy负责为Pod创建代理服务；引到访问至服务；并实现服务到Pod的路由和转发，以及通过应用的负载均衡。")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);