<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一、HBase | PYY在线笔记文档</title>
    <meta name="description" content="PYY在线笔记文档">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/study/img/logo.png">
    
    <link rel="preload" href="/study/assets/css/0.styles.adf990bf.css" as="style"><link rel="preload" href="/study/assets/js/app.8e5125e6.js" as="script"><link rel="preload" href="/study/assets/js/2.5697f219.js" as="script"><link rel="preload" href="/study/assets/js/6.08474c8b.js" as="script"><link rel="prefetch" href="/study/assets/js/10.5343e346.js"><link rel="prefetch" href="/study/assets/js/11.617ff5c6.js"><link rel="prefetch" href="/study/assets/js/3.108a598f.js"><link rel="prefetch" href="/study/assets/js/4.63e37535.js"><link rel="prefetch" href="/study/assets/js/5.6bb28458.js"><link rel="prefetch" href="/study/assets/js/7.35245da0.js"><link rel="prefetch" href="/study/assets/js/8.bbe9ca78.js"><link rel="prefetch" href="/study/assets/js/9.6296c621.js">
    <link rel="stylesheet" href="/study/assets/css/0.styles.adf990bf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study/" class="home-link router-link-active"><img src="/study/img/logo.png" alt="PYY在线笔记文档" class="logo"> <span class="site-name can-hide">PYY在线笔记文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/study/大数据/" class="nav-link">
  大数据
</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/af08f637aff8" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/pyy-admin-x" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/study/大数据/" class="nav-link">
  大数据
</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/af08f637aff8" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/pyy-admin-x" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>大数据</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study/%E5%A4%A7%E6%95%B0%E6%8D%AE/" class="sidebar-link">介绍</a></li><li><a href="/study/大数据/Flume.html" class="sidebar-link">Flume</a></li><li><a href="/study/大数据/HBase.html" class="active sidebar-link">一、HBase</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/大数据/HBase.html#_1-概念特性" class="sidebar-link">1. 概念特性</a></li><li class="sidebar-sub-header"><a href="/study/大数据/HBase.html#_2-各种数据库之间的差别比较" class="sidebar-link">2. 各种数据库之间的差别比较</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/大数据/HBase.html#_2-1-hbase和hive区别" class="sidebar-link">2.1 HBase和Hive区别</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/大数据/HBase.html#_3-hbase-特性与表结构" class="sidebar-link">3. HBase 特性与表结构</a></li><li class="sidebar-sub-header"><a href="/study/大数据/HBase.html#_4-hbase-整体工作机制" class="sidebar-link">4. HBase 整体工作机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/大数据/HBase.html#_4-1-工作机制示意图" class="sidebar-link">4.1 工作机制示意图</a></li><li class="sidebar-sub-header"><a href="/study/大数据/HBase.html#_4-2-存储问题（分散存储）" class="sidebar-link">4.2 存储问题（分散存储）</a></li><li class="sidebar-sub-header"><a href="/study/大数据/HBase.html#_4-3-查询问题（分布式：分任务查询）" class="sidebar-link">4.3 查询问题（分布式：分任务查询）</a></li><li class="sidebar-sub-header"><a href="/study/大数据/HBase.html#_4-5-hbase工作机制补充—regionserver数据管理" class="sidebar-link">4.5 Hbase工作机制补充—regionserver数据管理</a></li><li class="sidebar-sub-header"><a href="/study/大数据/HBase.html#_4-4-服务器宕机问题（借助zookeeper实现ha）" class="sidebar-link">4.4 服务器宕机问题（借助Zookeeper实现HA）</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/大数据/HBase.html#_5-安装-hbase" class="sidebar-link">5. 安装 HBase</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/大数据/HBase.html#安装hbase" class="sidebar-link">安装HBase</a></li></ul></li></ul></li><li><a href="/study/大数据/Hadoop.html" class="sidebar-link">Hadoop</a></li><li><a href="/study/大数据/Hive.html" class="sidebar-link">Hive</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="一、hbase"><a href="#一、hbase" class="header-anchor">#</a> 一、HBase</h1> <p>官网：http://hbase.apache.org</p> <p><img src="/study/assets/img/hbase.93edf177.png" alt=""></p> <p>HDFS：Hadoop分布式文件系统，适合非结构化数据的存储以及读取。</p> <p>Apache HBase建立在HDFS之上的分布式、基于列存储的非关系型数据库；具有可靠、稳定、自动容错、多版本特性。</p> <p>HBase实际上是Google BigTable项目的开源实现，它适合于海量的大规模（数十亿行、数百万列）的结构化数据存储。</p> <p>当需要随机、实时读写访问大数据时,使用HBase。</p> <h2 id="_1-概念特性"><a href="#_1-概念特性" class="header-anchor">#</a> 1. 概念特性</h2> <p>HBASE是一个<strong>数据库</strong>----可以提供数据的实时<strong>随机读写</strong></p> <p>HBASE与mysql、oralce、db2、sqlserver等关系型数据库不同，它是一个NoSQL数据库（非关系型数据库）</p> <ul><li><p>Hbase的表模型与关系型数据库的表模型不同：</p></li> <li><p>Hbase的表没有固定的字段定义；</p></li> <li><p>Hbase的表中每行存储的都是一些key-value对</p></li> <li><p>Hbase的表中有列族的划分，用户可以指定将哪些kv插入哪个列族</p></li> <li><p>Hbase的表在物理存储上，是按照列族来分割的，不同列族的数据一定存储在不同的文件中</p></li> <li><p>Hbase的表中的每一行都固定有一个行键，而且每一行的行键在表中不能重复</p></li> <li><p>Hbase中的数据，包含行键，包含key，包含value，HBase中的数据都是字符串（底层存储采用的是byte[]），没有类型，hbase不负责为用户维护数据类型</p></li> <li><p>HBASE对事务的支持很差</p></li></ul> <p>HBASE相比于其他nosql数据库(mongodb、redis、cassendra、hazelcast)的特点：</p> <p><strong>Hbase的表数据存储在HDFS文件系统中</strong></p> <p>从而，hbase具备如下特性：存储容量可以线性扩展； 数据存储的安全性可靠性极高！</p> <h2 id="_2-各种数据库之间的差别比较"><a href="#_2-各种数据库之间的差别比较" class="header-anchor">#</a> 2. 各种数据库之间的差别比较</h2> <p><img src="/study/assets/img/hbase_sql.959a0d0b.png" alt=""></p> <h3 id="_2-1-hbase和hive区别"><a href="#_2-1-hbase和hive区别" class="header-anchor">#</a> 2.1 HBase和Hive区别</h3> <h4 id="_2-1-1-hive-数据仓库的理解"><a href="#_2-1-1-hive-数据仓库的理解" class="header-anchor">#</a> 2.1.1 Hive 数据仓库的理解</h4> <ol><li><p>仓库就是存放历史数据存的地方，反复对历史数据进行读操作，统计分析操作，历史数据不需要修改。</p></li> <li><p>Hive严格意义上来讲不能算是数据库。</p> <p>Hive与Hbase巨大的区别在于，Hive底层依赖的文件系统HDFS中的数据是用户提交的，没有固定的格式，可以理解成按照分隔符分割的简单文本，而不是精心设计的文件（如Mysql那样精心设计的文件加上mysql中共的软件系统，可以对数据进行随机的访问和修改操作），Hive只能对这些数据进行读取，分析，不能对修改和跟新数据。</p></li> <li><p>mysql也当然具备做为数据仓库的功能和能力，但是数据量太大是，mysql不适合，mysql适于联机事务处理（在线实时交互）。</p></li></ol> <h4 id="_2-1-2-hbase"><a href="#_2-1-2-hbase" class="header-anchor">#</a> 2.1.2 HBase</h4> <ol><li><p>同msyql一样，底层的文件系统的精心设计的，Hbase的底层文件系统也是HDFS。</p></li> <li><p>具有联机事务处理数据库的特性（<strong>快速</strong> <strong>实时</strong>操作数据库，增删改查）。</p></li> <li><p>Hbase本身的特性：</p> <ul><li>文件系统：HDFS（表可以很大很大）</li> <li>分布式系统</li> <li>nosql表结构</li></ul></li></ol> <h2 id="_3-hbase-特性与表结构"><a href="#_3-hbase-特性与表结构" class="header-anchor">#</a> 3. HBase 特性与表结构</h2> <p><img src="/study/assets/img/hbase_table.1b989bf7.png" alt="Hbase的逻辑结构"></p> <p><strong>列族</strong>：KV分为若干的大类：，如上表所示。</p> <ol><li>每个列族中的kv数据可以随意存放，key可以不同，没有严格要求，完全有用户决定，当然一般使用情况下，数据是规整的；</li></ol> <p>如：下表是可以的，但是为了数据的规整，一般不建议随意为key起名字，最好保持一致。</p> <table><thead><tr><th>rowkey</th> <th>base_info</th></tr></thead> <tbody><tr><td>001</td> <td>name:jj, age:12, sex:mal</td></tr> <tr><td>002</td> <td>nick:ls, age:15, xb:male</td></tr></tbody></table> <ol start="2"><li><p>同一个列祖中的kv的个数也是灵活的，可以省略某些kv</p> <p>**cell：**同一个数据可以保存多个值</p> <ul><li><p>一个kv就是一个cell</p></li> <li><p>一个key可有有多个版本的值</p></li> <li><p>时间戳作为版本</p></li></ul></li></ol> <h2 id="_4-hbase-整体工作机制"><a href="#_4-hbase-整体工作机制" class="header-anchor">#</a> 4. HBase 整体工作机制</h2> <h3 id="_4-1-工作机制示意图"><a href="#_4-1-工作机制示意图" class="header-anchor">#</a> 4.1 工作机制示意图</h3> <p><img src="/study/assets/img/hbase_jz.3ac5b219.png" alt=""></p> <p>Hbase集群中有两个角色</p> <p><strong>region server</strong></p> <p><strong>master</strong></p> <p>region server负责数据的逻辑处理（增删改查），<strong>region server对数据的操作是不经过master</strong>。某一个瞬间master挂了，regionserver还是可以正常服务的，但是一定时间之后，万一某一个regionserver挂了，该regionserver负责的任务得不到重新分配，就会出问题。</p> <h3 id="_4-2-存储问题（分散存储）"><a href="#_4-2-存储问题（分散存储）" class="header-anchor">#</a> 4.2 存储问题（分散存储）</h3> <p>按照region划分范围存储（region目录还细分为列族目录，列族目录下才存放具体的文件）</p> <h3 id="_4-3-查询问题（分布式：分任务查询）"><a href="#_4-3-查询问题（分布式：分任务查询）" class="header-anchor">#</a> 4.3 查询问题（分布式：分任务查询）</h3> <p>HBase底层文件系统是HDFS，HBase中的表最终也会落地HDFS，那么Hbase的一张表可以很大很大，表中的数据不断的增加增加存储也是可以的，但是怎么查询呢？</p> <p>当请求特别多的时候，一台HBase服务器（region server）是不行的，HBase是一个分布式的系统，当有多个Hbase提供服务的时候，某一次客户端的请求具体由那个服务器来处理呢？</p> <ul><li><p>当某一台服务器挂了，谁来接替它的工作，如何接替？</p> <p>​	**解决：**服务器需要分任务（分布式系统里肯定是要分任务的）</p> <p>​	一台服务器，负责Hbase中某个表的某一个部分。</p></li> <li><p>如何界定部分？</p> <p>​	需要<strong>划分范围：<strong>按照</strong>行健范围</strong></p></li></ul> <p>这样通过分任务之后就是一个<strong>分布式系统。<strong>不同的regionServer可以</strong>并行</strong>的去访问hdfs中的数据（表数据）<strong>，<strong>这样还有一个问题，若某一张表中的所有数据都存在同一个HDFS中的文件中，即使是负责同一张表的不同范围regionserver，大量的并行请求也会同时访问同一个hdfs文件，这会造成性能上的瓶颈，所以表中的数据在HDFS中是按照</strong>region划分范围存储（region目录还细分为列族目录，列族目录下才存放具体的文件）</strong>, 这样<strong>同一个表的不同region范围的数据落地HDFS中不同的文件中</strong>。否则会造成即是分了任务一个dataNode被频繁的访问。</p> <h3 id="_4-5-hbase工作机制补充—regionserver数据管理"><a href="#_4-5-hbase工作机制补充—regionserver数据管理" class="header-anchor">#</a> 4.5 Hbase工作机制补充—regionserver数据管理</h3> <p>首先在hbase的表中插入一些数据，然后来观察一下hdfs中存的数据，发现hdfs下并没有数据，但是scan明明可以查到数据的，这是怎么回事呢？</p> <p><img src="https://img2018.cnblogs.com/blog/1020536/201810/1020536-20181016094210414-521552116.png" alt="img"></p> <h4 id="_4-2-1-客户端读写数据时的路由流程"><a href="#_4-2-1-客户端读写数据时的路由流程" class="header-anchor">#</a> 4.2.1 客户端读写数据时的路由流程</h4> <p><strong>问题描述</strong>：客户端怎么知道他要访问的某个region在那一台regionserver上呢？</p> <p>master是不会保存哪些region在哪些regionserver上的，否则就是有状态的节点了，一旦master挂了，regionserver立刻无法提供服务，而事实不是这样。</p> <p>上述信息就是所谓的索引信息，master是不会保存索引信息的，索引信息是保存在系统索引表中的。</p> <ol><li><p>索引表当然也存在于hdfs中，且只有一个region；</p></li> <li><p>谁来负责查询索引表</p></li></ol> <p>下图所示，索引表数据的查询由hdp-02机器上的regionserver负责，那么客户端怎样知道meta数据由hdp-02负责</p> <p><img src="/study/assets/img/hbase_regin.3283b72d.png" alt=""></p> <p><strong>zookeeper上会记录元数据索引表，有哪一台regionserver负责管理。</strong>　客户单端，每次访问数据之前，先查询zookeeper。</p> <p><img src="/study/assets/img/hbase_zk.1a45a579.png" alt=""></p> <p>下图为Zookeeper节点<strong>meta-region-server的信息</strong></p> <p><strong>访问流程：</strong></p> <ol><li><p>客户端去Zookeeper上查询，负责索引表数据的regionserver；</p></li> <li><p>找该台regionserver服务器，查询出客户端要访问的region数据由哪一台regionserver负责；</p></li> <li><p>客户端找具体的regionserver要数据.</p></li></ol> <p><strong>总结：</strong></p> <ol><li><p>Hbase表中的数据是存放在hdfs中的。</p></li> <li><p>regionserver只负责逻辑功能，对数据进行增删改查，不存储它负责的region的数据。</p></li> <li><p>一个regionserver可以负责多个表的多个region。</p></li> <li><p>region是regionServer管理数据的基本单元。</p></li> <li><p>客户端查找数据不经过master。</p></li> <li><p>客观端查找数据一定经过Zookeeper。</p></li></ol> <h3 id="_4-4-服务器宕机问题（借助zookeeper实现ha）"><a href="#_4-4-服务器宕机问题（借助zookeeper实现ha）" class="header-anchor">#</a> 4.4 服务器宕机问题（借助Zookeeper实现HA）</h3> <p><strong>master对regionserver的监管，状态协调</strong></p> <ol><li><p>所有的状态信息记录在Zookeeper里。</p></li> <li><p>master<strong>负责监管</strong>region server的状态，知道每一个regionserver负责哪些表的哪些region，不负责帮用户查数据，一旦发现某个region server发生故障，会找另外的一台机器来接替该region server负责的region区域。</p></li> <li><p>master通过Zookeeper来获取regionserver的状态。</p></li> <li><p>master通过Zookeeper监听region server，maste是没有状态的节点，master存在单点故障的风险；通过主备容灾实现HA机制。</p></li></ol> <p><strong>master HA</strong></p> <p><strong>状态信息记录在Zookeeper里。</strong></p> <p>可以在集群中找任意一台机器启动一个备用的master，新启的这个master会处于backup状态</p> <h2 id="_5-安装-hbase"><a href="#_5-安装-hbase" class="header-anchor">#</a> 5. 安装 HBase</h2> <h3 id="安装hbase"><a href="#安装hbase" class="header-anchor">#</a> 安装HBase</h3> <p>HBase是Google Bigtable的开源实现，它利用Hadoop HDFS作为其文件存储系统，利用Hadoop MapReduce来处理HBase中的海量数据，利用Zookeeper作为协同服务。所以安装HBase之前还需要安装zookeeper和hdfs。</p> <p>如果是Apache hadoop就下载相应文件并修改配置文件安装。我用的是cloudera hadoop就直接在集群管理界面添加服务。</p> <p><img src="https:////upload-images.jianshu.io/upload_images/10086112-82374970c9ed6826.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1122/format/webp" alt="img"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/study/大数据/Flume.html" class="prev">
        Flume
      </a></span> <span class="next"><a href="/study/大数据/Hadoop.html">
        Hadoop
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/study/assets/js/app.8e5125e6.js" defer></script><script src="/study/assets/js/2.5697f219.js" defer></script><script src="/study/assets/js/6.08474c8b.js" defer></script>
  </body>
</html>
