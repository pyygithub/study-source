<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hadoop 笔记 | PYY在线笔记文档</title>
    <meta name="description" content="PYY在线笔记文档">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/study/img/logo.png">
    
    <link rel="preload" href="/study/assets/css/0.styles.adf990bf.css" as="style"><link rel="preload" href="/study/assets/js/app.79e8d9f9.js" as="script"><link rel="preload" href="/study/assets/js/2.ee6e2511.js" as="script"><link rel="preload" href="/study/assets/js/4.762faecb.js" as="script"><link rel="prefetch" href="/study/assets/js/3.0a7cdb18.js"><link rel="prefetch" href="/study/assets/js/5.e593674e.js"><link rel="prefetch" href="/study/assets/js/6.96a2b106.js"><link rel="prefetch" href="/study/assets/js/7.fa2462d9.js"><link rel="prefetch" href="/study/assets/js/8.0152cbfd.js">
    <link rel="stylesheet" href="/study/assets/css/0.styles.adf990bf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study/" class="home-link router-link-active"><img src="/study/img/logo.png" alt="PYY在线笔记文档" class="logo"> <span class="site-name can-hide">PYY在线笔记文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/study/大数据/" class="nav-link">
  大数据
</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/af08f637aff8" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/pyy-admin-x" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/study/大数据/" class="nav-link">
  大数据
</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/af08f637aff8" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/pyy-admin-x" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>大数据</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study/%E5%A4%A7%E6%95%B0%E6%8D%AE/" class="sidebar-link">介绍</a></li><li><a href="/study/大数据/Hadoop 笔记.html" class="active sidebar-link">Hadoop 笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#大数据概念" class="sidebar-link">大数据概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#什么是大数据？" class="sidebar-link">什么是大数据？</a></li><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#大数据特点？" class="sidebar-link">大数据特点？</a></li><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#面临了哪些问题-如何解决？" class="sidebar-link">面临了哪些问题,如何解决？</a></li><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#大数据应用场景" class="sidebar-link">大数据应用场景</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#hadoop-的诞生" class="sidebar-link">Hadoop 的诞生</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#hadoop-的起源" class="sidebar-link">Hadoop 的起源</a></li><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#hadoop-的历史版本" class="sidebar-link">Hadoop 的历史版本</a></li><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#hadoop-生态圈" class="sidebar-link">Hadoop 生态圈</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#大数据解决方案" class="sidebar-link">大数据解决方案</a></li><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#hdfs-分布式系统配置" class="sidebar-link">HDFS 分布式系统配置</a></li><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#hdfs-体系架构" class="sidebar-link">HDFS 体系架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#什么是block块" class="sidebar-link">什么是Block块</a></li><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#什么是机架感知？" class="sidebar-link">什么是机架感知？</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#hdfs-命令行客户端基本操作" class="sidebar-link">HDFS 命令行客户端基本操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#客户端理解" class="sidebar-link">客户端理解</a></li><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#hdfs-命令行客户端的常用操作命令" class="sidebar-link">HDFS 命令行客户端的常用操作命令</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#hdfs-的-javaapi" class="sidebar-link">HDFS 的 JavaAPI</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#开发环境准备" class="sidebar-link">开发环境准备</a></li><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#文件上传" class="sidebar-link">文件上传</a></li><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#下载文件" class="sidebar-link">下载文件</a></li><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#创建文件夹" class="sidebar-link">创建文件夹</a></li><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#删除文件" class="sidebar-link">删除文件</a></li><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#递归查询目录下所有文件列表" class="sidebar-link">递归查询目录下所有文件列表</a></li><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#判断文件是否存在" class="sidebar-link">判断文件是否存在</a></li><li class="sidebar-sub-header"><a href="/study/大数据/Hadoop 笔记.html#回收站" class="sidebar-link">回收站</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="hadoop-笔记"><a href="#hadoop-笔记" class="header-anchor">#</a> Hadoop 笔记</h1> <h2 id="大数据概念"><a href="#大数据概念" class="header-anchor">#</a> 大数据概念</h2> <h3 id="什么是大数据？"><a href="#什么是大数据？" class="header-anchor">#</a> 什么是大数据？</h3> <blockquote><p>KB - MB - GB - TB - PB - EB - ZB - YB - DB - NB</p></blockquote> <p>一般来说达到 TB ，或日增达到 GB 就属于大数据了
MySQL 单表超过 500万 条数据</p> <h3 id="大数据特点？"><a href="#大数据特点？" class="header-anchor">#</a> 大数据特点？</h3> <p><strong>大数据的 5V 特性：</strong></p> <ul><li><p><strong>Volume：巨大的数据量</strong>
集中储存/集中计算已经无法处理巨大的数据量。
数据量呈指数增长：地震、录井 、石油钻塔的传感器一个月产生的数据量比全球所有的电影加在一起还要多。
新浪微博用户数2.5亿+，高峰每天几亿条。</p></li> <li><p><strong>Variety：非结构化数据多样性</strong>
文本/图片/视频/文档等，如诸如微地震，电磁以及光纤分布式温度监测（DTS） 。</p></li> <li><p><strong>Velocity：数据增长速度快</strong>
用户基数庞大/设备数量众多/实时海量/数据指数级别增长。</p></li> <li><p><strong>Valueless：数据价值密度低</strong>
每个钻井平台有 40,000 传感器,但是通常只有 10% 的数据使用到。
每个深水钻井平台的投资可达到$150M,能有效利用所有的数据非常关键,关系到安全与优化运营 。</p></li> <li><p><strong>Veracity：数据质量</strong>
数据的准确性和可信赖度，即数据的质量。</p></li></ul> <h3 id="面临了哪些问题-如何解决？"><a href="#面临了哪些问题-如何解决？" class="header-anchor">#</a> 面临了哪些问题,如何解决？</h3> <ul><li>数据如何存储 - HDFS</li> <li>数据如何计算 - MapReduce</li> <li>资源如何管理（CPU 内存 网络资源）- YARN</li></ul> <h3 id="大数据应用场景"><a href="#大数据应用场景" class="header-anchor">#</a> 大数据应用场景</h3> <ul><li><p><strong>个人推荐</strong>
根据用户喜好，推荐相关兴趣内容
千人一面：范围广、精度粗
一人一面：范围小、精度高
一人千面：兴趣内容范围大、精度高</p></li> <li><p><strong>风控</strong>
金融系统、银行、互联网金融 - 实时流处理</p></li> <li><p><strong>成本预测</strong>
根据近期销售和市场数据，预测成本，做出规划</p></li> <li><p><strong>气候预测</strong>
根据以往气象信息，预测近期气象变化，和推测之后气候异常</p></li> <li><p><strong>人工智能</strong>
无人汽车：百度、特斯拉、Google
智能助手：小爱、小度
物流机器人</p></li></ul> <h2 id="hadoop-的诞生"><a href="#hadoop-的诞生" class="header-anchor">#</a> Hadoop 的诞生</h2> <p>由 Apache 组织提供的一个开源的大数据解决方案。</p> <h3 id="hadoop-的起源"><a href="#hadoop-的起源" class="header-anchor">#</a> Hadoop 的起源</h3> <ul><li><p>2003-2004年，Google公布了部分GFS和MapReduce思想的细节，受此启发的Doug Cutting等人用2年的业余时间实现了DFS和MapReduce机制，使Nutch性能飙升。然后Yahoo招安Doug Gutting及其项目。</p></li> <li><p>2005年，Hadoop作为Lucene的子项目Nutch的一部分正式引入Apache基金会。</p></li> <li><p>2006年2月被分离出来，成为一套完整独立的软件，起名为Hadoop。Hadoop名字不是一个缩写，而是一个生造出来的词。是Hadoop之父Doug Cutting儿子毛绒玩具象命名的。</p></li> <li><p>Hadoop的成长过程
Lucene–&gt;Nutch—&gt;Hadoop</p></li> <li><p>总结起来，Hadoop起源于Google的三大论文</p> <ul><li>GFS：Google的分布式文件系统Google File System</li> <li>MapReduce：Google的MapReduce开源分布式并行计算框架</li> <li>BigTable：一个大型的分布式数据库</li></ul></li> <li><p>演变关系
GFS—-&gt;HDFS
Google MapReduce—-&gt;Hadoop MapReduce
BigTable—-&gt;HBase</p></li></ul> <p>狭义上来说，hadoop就是单独指代hadoop这个软件，
广义上来说，hadoop指代大数据的一个生态圈，包括很多其他的软件</p> <h3 id="hadoop-的历史版本"><a href="#hadoop-的历史版本" class="header-anchor">#</a> Hadoop 的历史版本</h3> <ul><li><strong>0.x系列版本</strong>：hadoop当中最早的一个开源版本，在此基础上演变而来的1.x以及2.x的版本</li> <li><strong>1.x版本系列</strong>：hadoop版本当中的第二代开源版本，主要修复0.x版本的一些bug等</li> <li><strong>2.x版本系列</strong>：架构产生重大变化，引入了yarn平台等许多新特性</li></ul> <h3 id="hadoop-生态圈"><a href="#hadoop-生态圈" class="header-anchor">#</a> Hadoop 生态圈</h3> <ul><li><strong>HDFS</strong>：Hadoop Distribute FileSystem</li> <li><strong>MapReduce</strong>：Hadoop中的分布式计算框架，实现对海量数据的并行分析和计算。</li> <li><strong>Hbase</strong>：基于HDFS的列式存储的 NoSQL 数据库。</li> <li><strong>Hive</strong>：简化大数据开发，可以将 SQL 语法翻译成 MR 任务。</li> <li><strong>Flume</strong>：分布式的日志收集系统，用于收集海量数据，将其存储到 FS 中。</li> <li><strong>Kafka</strong>：分布式的消息系统，实现分布式解耦和海量数据缓冲。</li> <li><strong>Zookeeper</strong>：分布式协调服务，用于服务注册中心、配置中心、集群选举、状态监测、分布式锁等。</li></ul> <h2 id="大数据解决方案"><a href="#大数据解决方案" class="header-anchor">#</a> 大数据解决方案</h2> <ul><li><strong>MR</strong>：代表基于<strong>磁盘</strong>的大数据离线批处理的解决方案 - 延迟较高</li> <li><strong>Spark</strong>：代表基于<strong>内存</strong>的大数据静态批处理的解决方案 - 几乎是MR的10倍以上</li> <li><strong>Storm/Spark Streaming/Flink/Kafka Streaming</strong>：实时流处理框架，达到对记录级别的数据显示和毫秒级处理</li></ul> <h2 id="hdfs-分布式系统配置"><a href="#hdfs-分布式系统配置" class="header-anchor">#</a> HDFS 分布式系统配置</h2> <p><strong>核心配置参数：</strong></p> <ul><li>指定 hadoop 的默认文件系统为：hdfs</li> <li>指定 hdfs 的 namenode 节点是哪台机器</li> <li>指定 namenode 软件存储元数据的本地目录</li> <li>指定 datanode 软件存储文件块的本地目录</li></ul> <ol><li><p>环境配置文件hadoop-env.sh</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># The java implementation to use.</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/opt/soft/jdk1.8.0_211
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_CONF_DIR</span><span class="token operator">=</span><span class="token variable">${HADOOP_CONF_DIR<span class="token operator">:-</span>$PWD}</span> <span class="token comment">#Hadoop配置文件的存放目录</span>
</code></pre></div></li> <li><p>核心配置文件 core-site.xml</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- fs.defaultFS: 默认文件系统 hdfs  --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.defaultFS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>hdfs://hdp-01:9000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>HDFS配置文件hdfs-site.xml</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- namenode 地址 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.namenode.http-address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>hdp-01:50070<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- secondary namenode 地址 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.namenode.http-address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>hdp-01:50090<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token comment">&lt;!-- 指定 namenode 软件存储元数据的本地目录 格式化节点时会自动生成--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.namenode.name.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/root/hdpdata/name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 指定 datanode 软件存储文件块的本地目录 格式化节点时会自动生成   --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.datanode.data.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/root/hdpdata/data<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> 

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>配置datanode集群节点文件 slaves</p> <div class="language-shell extra-class"><pre class="language-shell"><code>hdp-01
hdp-02
hdp-03
</code></pre></div></li> <li><p>配置好以上信息后，我们就可以将hadoop的包分发给其他的节点了</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">scp</span> -r hadoop-2.x.x root@hdp02:<span class="token punctuation">(</span>目标路径<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>启动集群</p> <p>在主节点上运行</p> <div class="language- extra-class"><pre class="language-text"><code>hadoop namenode -format
</code></pre></div><p>运行完成后，节点会自动生成刚刚配置的工作目录</p> <div class="language- extra-class"><pre class="language-text"><code>start-dfs.sh
</code></pre></div></li> <li><p>浏览器输入http://x.x.x.x:50070查看集群运行情况</p> <p><img src="/study/assets/img/namenode.f626aa82.png" alt="namenode"></p></li> <li><p>最终服务器分布：</p> <table><thead><tr><th>服务器地址</th> <th>端口</th> <th>服务</th></tr></thead> <tbody><tr><td>hdp-01</td> <td>50070<br>50090</td> <td>namenode<br>secondaryNamenode<br>datanode</td></tr> <tr><td>hdp-02</td> <td>50010/50075</td> <td>datanode</td></tr> <tr><td>hdp-03</td> <td>50010/50075</td> <td>datanode</td></tr></tbody></table></li> <li><p><strong>问题总结</strong></p> <ul><li>防火墙设置
为了防止发生一些奇怪的错误，请务必关闭所有节点的防火墙，他可能会导致浏览器无法获取集群信息和文件上传集群失败</li> <li>hosts文件配置和主机名
因为这是完全分布式的集群，所以配置hosts文件至关重要，不然你的私钥配置和以后节点的格式化都会出错，他将会提示你无法解析主机名</li> <li>请在关闭所有HDFS服务后在执行<code>-format</code>格式化命令
如果存在节点未关闭，而你运行了格式化命令，这可能导致该节点与其他节点的目录ID不一致，从而导致“网络分区”问题</li></ul></li></ol> <h2 id="hdfs-体系架构"><a href="#hdfs-体系架构" class="header-anchor">#</a> HDFS 体系架构</h2> <p><a href="https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-hdfs/HdfsDesign.html" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>HDFS 是一种能够运行在商业硬件上的分布式文件系统，与目前市面上文件系统有很多相似之处，但是又是不同的软件系统。在HDFS中，使用的架构主从架构（Active|Standby），针对的是<strong>NameNode</strong>的高可用。</p> <ol><li><p><strong>NameNode</strong></p> <ul><li>存储文件的元数据如<code>文件名、文件目录结构、文件属性(生成时间、福本数、文件权限) ，以及每个文件的块列表和块所在的DataNode映射</code></li> <li>负责管理 DataNode</li> <li>控制外界客户端对文件系统的访问。</li> <li>NameNode会启动一个（或者说一个集群中，只有一个NameNode节点运行）</li></ul></li> <li><p>**DataNode **
在本地文件系统存储文件块数据，以及块数据的校验和，负责响应客户端对块的读写请求。</p></li> <li><p><strong>Block</strong>
数据块，是对文件拆分的最小单元（默认情况下一个块大小128MB，每个数据块有3个副本）</p></li> <li><p><strong>rack</strong></p> <p>机架，使用机架对存储节点进行物理编排，用于优化存储和计算</p> <p><img src="/study/assets/img/HDFS.fa7eae62.png" alt="img"></p></li></ol> <h3 id="什么是block块"><a href="#什么是block块" class="header-anchor">#</a> 什么是Block块</h3> <ul><li><p>概述</p> <p>hadoop集群中文件的存储都是以块的形式存储在hdfs中，且一般默认都会有三个备份分别存储在集中中不同的datanode节点上。</p></li> <li><p>默认值</p> <p>从2.7.3版本开始 block size 默认值大小为 128M，之前版本默认值为64M</p></li> <li><p>如何修改 block 块的大小？</p> <p>可以通过修改 hdfs-site.xml中的 dfs.blocksize 对应的值</p> <p>注意: 在修改HDFS的数据块大小时，首先停掉集群hadoop的运行，修改完毕后重新启动。</p></li> <li><p>block块的大小设置规则</p> <p>在实际应用中，hdfs block块的大小设置为多少合适呢？为什么有的是64M，有个的是128M、256M、512M呢？</p> <p>首先我们先来了解几个概念：</p> <ol><li>寻址时间：HDFS 中找到目标文件block所花费的时间。</li> <li>原理：文件块越大，寻址时间越短，但磁盘传输时间越长；文件块越小，寻址时间越长，但磁盘传输时间越短。</li></ol></li> <li><p>block不能设置过大，也不能设置过小</p> <ol><li>如果设置过大，一方面从磁盘传输数据的时间会明显大于寻址时间，导致程序处理这块数据时，变得非常慢；另一方面，MapReduce 中map任务通常一次只处理一个块中的数据，如果过大运行速度也会很慢。</li> <li>如果设置过小，一方面存放大小小文件会占用NameNode中大量内存来存储元数据，而NameNode的内存是有限的，不可取；另一方面块过小，寻址时间增长，导致程序一直在找block的开始位置。因此，块适当设置大一些，减少寻址时间，那么传输一个有多个块组成的文件时间<strong>主要取决于磁盘的传输速度</strong>。</li></ol></li> <li><p>设置多大合适？</p> <ol><li><p>HDFS中平均寻址时间大概为 10ms；</p></li> <li><p>经过大量的测试发现，寻址时间为传输时间的1%时，为最佳状态，所以最佳的传输时间为：</p> <p>10ms/0.01 = 1000s = 1s</p></li> <li><p>目前磁盘的传输普遍为100MB/s，最佳block大小计算：</p> <p>100MB/s*1s=100MB</p> <p>所以我们设置block大小为 128MB。</p></li> <li><p>实际中，磁盘的传输速率为 200MB/s时，一般设定block块大小为256MB；磁盘传输速率为400MB/s时，一般设定block大小为512MB.</p></li> <li><p>g</p></li></ol></li></ul> <h3 id="什么是机架感知？"><a href="#什么是机架感知？" class="header-anchor">#</a> 什么是机架感知？</h3> <ul><li><p>背景</p> <p>分布式的集群通常包含非常多的机器，由于受到机架槽位和交换机网口的限制，通常大型的分布式集群都会跨好多个机架，由多个机架上的机器共同组成分布式集群。机架内的机器之间的网络速度通常都会高于跨机架机器之间的网络速度，并且机架之间机器的网络通信通常受到上层交换机网络带宽的限制。</p></li> <li><p>存储策略</p> <p><strong>Hadoop在设计时考虑到数据的安全和高效，数据文件默认在HDFS上存放三份，存储策略为：</strong></p> <p>第一个block副本放在客户端所在的数据节点上（如果客户端不在集群范围内，则从整个集群中随机选择一个合适的数据节点来存放）。</p> <p>第二个副本放置在与第一个副本所在节点相同的机架内的其它数据节点上</p> <p>第三个副本放置在不同机架节点上</p> <p>如果副本数  &gt;= 4时：</p> <p>前三个副本按照上面原则存放，从第四个副本开始，随机选取dataNode节点存放（每个节点只保留一份副本，每个rack不超过两个副本）</p> <p>这样如果本地数据损坏，节点可以从同一机架内的相邻节点拿到数据，速度肯定比从跨机架节点上获取数据的速度快；</p> <p>同时，如果整个机架的网络出现异常，也能保障可以在其它机架节点上找到数据。</p> <p>为了降低整体的带宽消耗和读取延时，HDFS会尽量让读取程序读取离它最近的副本。</p> <p>如果在读取程序的同一个机架上有一个副本，那么就读取该副本。</p> <p>如果在一个HDFS集群跨越多个数据中心，那么客户端也将读取本地数据中心的副本。</p> <p>那么Hadoop是如何确定任意两个节点为于同一个机架，还是跨机架的呢？答案就是<strong>机架感知</strong>。</p> <p>默认情况下，hadoop的机架感知是没有被开启的。所有机器hadoop都默认同一个机架下，名为“、default-rack&quot;,这种情况下，任何一台 datanode 机器，不管物理上是否属于同一个机架，都会被认为在同一个机架下，此时，就很容易出现增添机架间网络负载的情况。因为此时hadoop集群的HDFS在选机器的时候，是随机选择的，也就是说，很可能在写数据的时候，hadoop将第一块数据的block1写在 rack1上，然后随机的选择将block2写入到rack2上。</p> <p>此时，两个rack之间产生了数据传输的流量，再接下来，在随机的情况下，又将block3重新又写回到rack2，此时，两个rack之间又产生了一次数据流量。</p> <p>在job处理的数据量非常大的时候，或者hadoop推送的数据量非常大的时候，这种情况会造成rack之间的网络流量成倍的上升，成为性能的瓶颈，进而影响作业的性能甚至于整个集群的服务。</p></li> <li><p>配置</p> <p>具体配置可参考：https://blog.csdn.net/zhongqi2513/article/details/73695229</p></li></ul> <h2 id="hdfs-命令行客户端基本操作"><a href="#hdfs-命令行客户端基本操作" class="header-anchor">#</a> HDFS 命令行客户端基本操作</h2> <h3 id="客户端理解"><a href="#客户端理解" class="header-anchor">#</a> 客户端理解</h3> <p>HDFS 的客户端有多种形式：</p> <ul><li>网页形式</li> <li>命令行形式</li></ul> <p>客户端在哪里运行，没有约束，只要运行客户端的机器能够跟 HDFS 集群联网。</p> <blockquote><p>注意：文件的切块大小和存储的福本数量，都是由客户端决定的！</p></blockquote> <p>所谓客户端决定，是通过配置参数类定的。HDFS 的客户端会读取以下两个参数，来决定切块大小和副本数量：</p> <ul><li>切块大小参数：dfs.blocksize</li> <li>副本数量的参数：dfs.replication</li></ul> <p>上面两个参数在 hdfs-site.xml 中配置：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.blocksize<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>128m<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.replication<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="hdfs-命令行客户端的常用操作命令"><a href="#hdfs-命令行客户端的常用操作命令" class="header-anchor">#</a> HDFS 命令行客户端的常用操作命令</h3> <ol><li><p>查看 HDFS 目录信息</p> <div class="language-shell extra-class"><pre class="language-shell"><code>hadoop fs -ls /hdfs目录
</code></pre></div></li> <li><p>在 HDFS 中创建文件夹</p> <div class="language-sh extra-class"><pre class="language-sh"><code>hadoop fs -mkdir -p /aa/bb/cc
</code></pre></div></li> <li><p>移动 HDFS 中的文件（改名）</p> <div class="language-sh extra-class"><pre class="language-sh"><code>hadoop fs -mv /hdfs路径	/hdfs另一个路径
</code></pre></div></li> <li><p>上传文件到 HDFS 中</p> <div class="language-sh extra-class"><pre class="language-sh"><code>hadoop fs -put /本地文件 /hdfs目录
hadoop fs -copyFromLocal/本地文件	/hdfs目录   <span class="token comment">## copyFromLocak == put</span>
hadoop fs -moveFromLocal/本地文件	/hdfs目录		<span class="token comment">## 从本地移动到hdfs</span>
</code></pre></div></li> <li><p>下载文件到客户端本地</p> <div class="language-sh extra-class"><pre class="language-sh"><code>hadoop fs -get /hdfs中的文件	/本地目录
hadoop fs -copyToLocal/hdfs中的文件	/本地目录	<span class="token comment">## copyToLocal == get</span>
hadoop fs -moveToLocal/hdfs中的文件 /本地目录	<span class="token comment">## 从 hdfs 中移动到本地</span>
</code></pre></div></li> <li><p>删除 HDFS 中的文件或文件夹</p> <div class="language-sh extra-class"><pre class="language-sh"><code>hadoop fs <span class="token function">rm</span> -r /hdfs目录或文件
</code></pre></div></li> <li><p>修改文件的权限</p> <div class="language-sh extra-class"><pre class="language-sh"><code>hadoop fs -chown user:group /hdfs文件
hadoop fs -chmod <span class="token number">777</span> /hdfs文件
</code></pre></div></li> <li><p>追加内容到已有文件</p> <div class="language-sh extra-class"><pre class="language-sh"><code>hadoop fs -appendToFile /本地文件	/hdfs文件
</code></pre></div></li> <li><p>显示文本文件内容</p> <div class="language-sh extra-class"><pre class="language-sh"><code>hadoop fs -cat /hdfs文件
hadoop fs -tail /hdfs文件 
</code></pre></div></li></ol> <h2 id="hdfs-的-javaapi"><a href="#hdfs-的-javaapi" class="header-anchor">#</a> HDFS 的 JavaAPI</h2> <h3 id="开发环境准备"><a href="#开发环境准备" class="header-anchor">#</a> 开发环境准备</h3> <ol><li>在本地解决Hadoop安装包</li> <li>在环境变量中配置：HADOOP_HOME</li> <li>创建 SpringBoot 工程,引入 Hadoop 依赖包</li></ol> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- hadoop-hdfs --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-hdfs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.10.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- hadoop-common --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.10.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="文件上传"><a href="#文件上传" class="header-anchor">#</a> 文件上传</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>conf</span><span class="token punctuation">.</span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>fs</span><span class="token punctuation">.</span><span class="token class-name">FSDataOutputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>fs</span><span class="token punctuation">.</span><span class="token class-name">FileSystem</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>fs</span><span class="token punctuation">.</span><span class="token class-name">Path</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">IOUtils</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">After</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">Before</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">File</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">FileInputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">FileNotFoundException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token class-name">Configuration</span> configuration<span class="token punctuation">;</span>
    <span class="token class-name">FileSystem</span> fs<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Before</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;HADOOP_USER_NAME&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 手动设置连接信息</span>
        <span class="token comment">//configuration.set(&quot;fs.defaultFS&quot;, &quot;&quot;)</span>
        configuration<span class="token punctuation">.</span><span class="token function">addResource</span><span class="token punctuation">(</span><span class="token string">&quot;core-site.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        configuration<span class="token punctuation">.</span><span class="token function">addResource</span><span class="token punctuation">(</span><span class="token string">&quot;hdfs-site.xml &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        fs <span class="token operator">=</span> <span class="token class-name">FileSystem</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">upload1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        fs<span class="token punctuation">.</span><span class="token function">copyFromLocalFile</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/本地文件&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">upload2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">FileInputStream</span> inputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;/本地文件&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FSDataOutputStream</span> outputStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/a.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">copyBytes</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span> outputStream<span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>权限不足解决方案</strong></p> <div class="language-java extra-class"><pre class="language-java"><code>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>security<span class="token punctuation">.</span><span class="token class-name">AccessControlException</span><span class="token operator">:</span> <span class="token class-name">Permission</span> denied<span class="token operator">:</span> user<span class="token operator">=</span>wolf<span class="token punctuation">,</span> access<span class="token operator">=</span>WRITE<span class="token punctuation">,</span> inode<span class="token operator">=</span><span class="token string">&quot;/&quot;</span><span class="token operator">:</span>root<span class="token operator">:</span>supergroup<span class="token operator">:</span>drwxr<span class="token operator">-</span>xr<span class="token operator">-</span>x
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><ul><li><p>方案一：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;HADOOP_USER_NAME&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>方案二：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>java -jar xxxx -DHADOOP_USER_NAME<span class="token operator">=</span>root
</code></pre></div></li> <li><p>方案三：</p> <blockquote><p>将权限检查机制关闭：ect/hadoop/hdfs-site.xml:</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.permissions.enabled<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span>
	<span class="token attr-name">&lt;value</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul> <h3 id="下载文件"><a href="#下载文件" class="header-anchor">#</a> 下载文件</h3> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">download1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        fs<span class="token punctuation">.</span><span class="token function">copyToLocalFile</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/hdfs文件&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/本地目录&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">download2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">FileInputStream</span> inputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;hdfs文件&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FSDataOutputStream</span> outputStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/本地目录&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">copyBytes</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span> outputStream<span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="创建文件夹"><a href="#创建文件夹" class="header-anchor">#</a> 创建文件夹</h3> <div class="language-java extra-class"><pre class="language-java"><code>		<span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        fs<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/a/b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="删除文件"><a href="#删除文件" class="header-anchor">#</a> 删除文件</h3> <div class="language-java extra-class"><pre class="language-java"><code>		<span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 递归删除</span>
        <span class="token keyword">boolean</span> delete <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="递归查询目录下所有文件列表"><a href="#递归查询目录下所有文件列表" class="header-anchor">#</a> 递归查询目录下所有文件列表</h3> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">RemoteIterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LocatedFileStatus</span><span class="token punctuation">&gt;</span></span> remoteIterator <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>remoteIterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">LocatedFileStatus</span> fileStatus <span class="token operator">=</span> remoteIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> name <span class="token operator">=</span> fileStatus<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="判断文件是否存在"><a href="#判断文件是否存在" class="header-anchor">#</a> 判断文件是否存在</h3> <div class="language-java extra-class"><pre class="language-java"><code>		<span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exist</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> exists <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/a.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>exists<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="回收站"><a href="#回收站" class="header-anchor">#</a> 回收站</h3> <div class="language-java extra-class"><pre class="language-java"><code>		<span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">trash</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Trash</span> trash <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Trash</span><span class="token punctuation">(</span>fs<span class="token punctuation">,</span> configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> b <span class="token operator">=</span> trash<span class="token punctuation">.</span><span class="token function">moveToTrash</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;/a.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>·</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/study/%E5%A4%A7%E6%95%B0%E6%8D%AE/" class="prev router-link-active">
        介绍
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/study/assets/js/app.79e8d9f9.js" defer></script><script src="/study/assets/js/2.ee6e2511.js" defer></script><script src="/study/assets/js/4.762faecb.js" defer></script>
  </body>
</html>
