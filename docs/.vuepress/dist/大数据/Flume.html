<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Flume | PYY在线笔记文档</title>
    <meta name="description" content="PYY在线笔记文档">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/study/img/logo.png">
    
    <link rel="preload" href="/study/assets/css/0.styles.adf990bf.css" as="style"><link rel="preload" href="/study/assets/js/app.1ed1a485.js" as="script"><link rel="preload" href="/study/assets/js/2.0088ba89.js" as="script"><link rel="preload" href="/study/assets/js/5.4c3c36d6.js" as="script"><link rel="prefetch" href="/study/assets/js/10.ce685076.js"><link rel="prefetch" href="/study/assets/js/11.5e0f56c0.js"><link rel="prefetch" href="/study/assets/js/12.b98389c0.js"><link rel="prefetch" href="/study/assets/js/13.63647638.js"><link rel="prefetch" href="/study/assets/js/14.412c011b.js"><link rel="prefetch" href="/study/assets/js/15.54facbdb.js"><link rel="prefetch" href="/study/assets/js/16.c3d2e03c.js"><link rel="prefetch" href="/study/assets/js/17.168a2547.js"><link rel="prefetch" href="/study/assets/js/18.34ffd3b4.js"><link rel="prefetch" href="/study/assets/js/19.7fb6933a.js"><link rel="prefetch" href="/study/assets/js/20.2f77e69b.js"><link rel="prefetch" href="/study/assets/js/21.025c2b93.js"><link rel="prefetch" href="/study/assets/js/3.4f0babfc.js"><link rel="prefetch" href="/study/assets/js/4.76b3a244.js"><link rel="prefetch" href="/study/assets/js/6.ced6947b.js"><link rel="prefetch" href="/study/assets/js/7.bcf8ef67.js"><link rel="prefetch" href="/study/assets/js/8.00769b1f.js"><link rel="prefetch" href="/study/assets/js/9.dd124e6e.js">
    <link rel="stylesheet" href="/study/assets/css/0.styles.adf990bf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study/" class="home-link router-link-active"><img src="/study/img/logo.png" alt="PYY在线笔记文档" class="logo"> <span class="site-name can-hide">PYY在线笔记文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/study/大数据/" class="nav-link">
  大数据
</a></div><div class="nav-item"><a href="/study/DevOps/" class="nav-link">
  DevOps
</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/af08f637aff8" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/pyy-admin-x" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/study/大数据/" class="nav-link">
  大数据
</a></div><div class="nav-item"><a href="/study/DevOps/" class="nav-link">
  DevOps
</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/af08f637aff8" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/pyy-admin-x" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Dev Ops</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>大数据</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study/大数据/Hadoop.html" class="sidebar-link">Hadoop</a></li><li><a href="/study/%E5%A4%A7%E6%95%B0%E6%8D%AE/" class="sidebar-link">介绍</a></li><li><a href="/study/大数据/Azkaban.html" class="sidebar-link">Azkaban</a></li><li><a href="/study/大数据/ElasticSearch.html" class="sidebar-link">ElasticSearch</a></li><li><a href="/study/大数据/Flume.html" class="active sidebar-link">Flume</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/大数据/Flume.html#flume-介绍" class="sidebar-link">Flume 介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/大数据/Flume.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/study/大数据/Flume.html#运行机制" class="sidebar-link">运行机制</a></li><li class="sidebar-sub-header"><a href="/study/大数据/Flume.html#flume采集系统结构图" class="sidebar-link">Flume采集系统结构图</a></li></ul></li><li class="sidebar-sub-header"><a href="/study/大数据/Flume.html#flume-实战案例" class="sidebar-link">Flume 实战案例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study/大数据/Flume.html#实时采集新出现的文件到hdfs中去" class="sidebar-link">实时采集新出现的文件到HDFS中去</a></li><li class="sidebar-sub-header"><a href="/study/大数据/Flume.html#追加数据实时采集到hdfs" class="sidebar-link">追加数据实时采集到HDFS</a></li><li class="sidebar-sub-header"><a href="/study/大数据/Flume.html#多级-agent-串联" class="sidebar-link">多级 agent 串联</a></li></ul></li></ul></li><li><a href="/study/大数据/HBase.html" class="sidebar-link">HBase</a></li><li><a href="/study/大数据/Hive.html" class="sidebar-link">Hive</a></li><li><a href="/study/大数据/Hue.html" class="sidebar-link">Hue</a></li><li><a href="/study/大数据/Kafka.html" class="sidebar-link">Kafka</a></li><li><a href="/study/大数据/Oozie.html" class="sidebar-link">Oozie</a></li><li><a href="/study/大数据/Sqoop.html" class="sidebar-link">Sqoop</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="flume"><a href="#flume" class="header-anchor">#</a> Flume</h1> <h2 id="flume-介绍"><a href="#flume-介绍" class="header-anchor">#</a> Flume 介绍</h2> <p>官网：http://flume.apache.org</p> <p><img src="/study/assets/img/flume-logo.8ce83c82.png" alt=""></p> <h3 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h3> <ul><li><p>Flume是一个分布式、可靠、和高可用的海量日志采集、聚合和传输的系统。</p></li> <li><p>Flume可以采集文件，socket数据包、文件、文件夹、kafka等各种形式源数据，又可以将采集到的数据(下沉sink)输出到HDFS、hbase、hive、kafka等众多外部存储系统中</p></li> <li><p>一般的采集需求，通过对flume的简单配置即可实现</p></li> <li><p>Flume针对特殊场景也具备良好的自定义扩展能力，因此,flume可以适用于大部分的日常数据采集场景 。</p> <p><img src="/study/assets/img/flume.cb5a167c.png" alt=""></p></li></ul> <h3 id="运行机制"><a href="#运行机制" class="header-anchor">#</a> 运行机制</h3> <ul><li><p>Flume分布式系统中最核心的角色是agent，flume 采集系统就是由一个个 agent 所连接起来形成</p></li> <li><p>每一个 agent 相当于一个数据传递员，内部有三个组件：</p> <ol><li><p><strong>Source</strong>：采集组件，用于跟数据源对接，以获取数据</p></li> <li><p><strong>Channel</strong>：传输通道组件，用于从source将数据传递到sink （event：head、body）</p></li> <li><p><strong>Sink</strong>：下沉组件，用于往下一级agent传递数据或者往最终存储系统传递数据</p></li></ol></li></ul> <h3 id="flume采集系统结构图"><a href="#flume采集系统结构图" class="header-anchor">#</a> Flume采集系统结构图</h3> <ul><li>简单结构：单个 agent 采集数据</li></ul> <p><img src="/study/assets/img/flume1.684ece9a.png" alt=""></p> <ul><li><p>复杂结构：多级 Agent 之间串联 采集数据</p> <p><img src="/study/assets/img/flume2.14d0ec9a.png" alt=""></p></li></ul> <h2 id="flume-实战案例"><a href="#flume-实战案例" class="header-anchor">#</a> <strong>Flume</strong> 实战案例</h2> <h3 id="实时采集新出现的文件到hdfs中去"><a href="#实时采集新出现的文件到hdfs中去" class="header-anchor">#</a> 实时采集新出现的文件到HDFS中去</h3> <p><img src="/study/assets/img/flume_demo1.74d6256a.png" alt=""></p> <h4 id="step-1-下载解压修改配置文件"><a href="#step-1-下载解压修改配置文件" class="header-anchor">#</a> <strong>Step 1:</strong> 下载解压修改配置文件</h4> <p>下载地址： http://archive.apache.org/dist/flume/1.8.0/apache-flume-1.8.0-bin.tar.gz</p> <p>Flume的安装非常简单，只需要解压即可，当然，前提是已有hadoop环境</p> <p>上传安装包到数据源所在节点上，或者通过CDH安装配置Flume。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#cd /export/softwares/ </span>
<span class="token comment">#tar -zxvf apache-flume-1.8.0-bin.tar.gz -C ../servers/ </span>
<span class="token comment">#cd /export/servers/apache-flume-1.8.0-bin/conf </span>
<span class="token comment">#cp flume-env.sh.template flume-env.sh </span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#vim flume-env.sh </span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/opt/slft/jdk1.8.0_141
</code></pre></div><h4 id="step-2-开发配置文件"><a href="#step-2-开发配置文件" class="header-anchor">#</a> <strong>Step 2:</strong> 开发配置文件</h4> <p>根据数据采集的需求配置采集方案，描述在配置文件中(文件名可任意自定义)</p> <p>配置我们的网络收集的配置文件</p> <p>在flume的conf目录下新建一个配置文件（采集方案）</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#vim /export/servers/apache-flume-1.8.0-bin/conf/dir-hdfs.conf</span>
</code></pre></div><div class="language-conf extra-class"><pre class="language-text"><code># 定义三大组件名称
ag1.sources  = source1
ag1.channels = channel1
ag1.sinks  = sink1

# 配置 source 组件
ag1.sources.source1.type  = spooldir
ag1.sources.source1.spoolDir = /root/access_log/
ag1.sources.source1.fileSuffix = .FINISHED

# channel配置
ag1.channels.channel1.type   = memory
ag1.channels.channel1.capacity = 100 
ag1.channels.channel1.transactionCapacity = 600

# 配置 sink 组件
ag1.sinks.sink1.type  = hdfs
ag1.sinks.sink1.hdfs.path = hdfs://node-00:8020/access_log/%y-%m-%d/%H-%M
ag1.sinks.sink1.hdfs.filePrefix = app_log
ag1.sinks.sink1.hdfs.fileSuffix = .log
ag1.sinks.sink1.hdfs.batchSize = 100
ag1.sinks.sink1.hdfs.fileType =  DataStream
ag1.sinks.sink1.hdfs.wirteFormat = Text

## roll：滚动切换：控制写文件的切换规则
ag1.sinks.sink1.hdfs.rollSize = 102400
ag1.sinks.sink1.hdfs.rollCount = 10000
ag1.sinks.sink1.hdfs.rollInterval = 60

## 控制生成目录的规则
ag1.sinks.sink1.hdfs.round = true
ag1.sinks.sink1.hdfs.roundValue = 10
ag1.sinks.sink1.hdfs.roundUnit = minute
ag1.sinks.sink1.hdfs.useLocalTimeStamp = true


# 绑定source、channel、sink之间的联系
ag1.sources.source1.channels = channel1
ag1.sinks.sink1.channel      = channel1
</code></pre></div><h4 id="step-3-启动配置文件"><a href="#step-3-启动配置文件" class="header-anchor">#</a> <strong>Step 3:</strong> 启动配置文件</h4> <p>指定采集方案配置文件，在相应的节点上启动 flume agent</p> <p>启动agent去采集数据</p> <p>测试阶段启动命令：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#bin/flume-ng agent -c conf -f conf/dir-hdfs.conf -n ag1 -Dflume.root.logger=INFO,console</span>
</code></pre></div><p>生产阶段启动命令：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#nohup bin/flume-ng agent -c conf -f conf/dir-hdfa.conf -n ag1 &gt; 1&gt;/dev/null 2&gt;&amp;1 &amp;</span>
</code></pre></div><ul><li>-c conf 指定flume自身的配置文件所在目录</li> <li>-f conf/netcat-logger.con 指定我们所描述的采集方案</li> <li>-n a1 指定我们这个agent的名字</li></ul> <h4 id="step-4-查看执行结果"><a href="#step-4-查看执行结果" class="header-anchor">#</a> <strong>Step 4:</strong> 查看执行结果</h4> <p><img src="/study/assets/img/flume_demo1_rst.edb100d2.png" alt=""></p> <h3 id="追加数据实时采集到hdfs"><a href="#追加数据实时采集到hdfs" class="header-anchor">#</a> 追加数据实时采集到HDFS</h3> <p>采集需求：业务系统使用log4j生成日志，内容不断增加，需要把追加到日志文件中的数据实时采集到HDFS</p> <p><img src="data:image/png;base64,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" alt=""></p> <p>根据需求，首先定义一下3个要素：</p> <ul><li>采集源，即 source -- 监控文件内容更新： exec ‘tail -F file'</li> <li>下沉目标，即 sink -- HDFS 文件系统： hdfs sink</li> <li>source 和 sink 之间的传递通道 - channel，可用 file channel 也可以用 内存channel</li></ul> <h4 id="具体配置同上"><a href="#具体配置同上" class="header-anchor">#</a> 具体配置同上</h4> <h4 id="在flume的conf目录下新建一个配置文件（采集方案）"><a href="#在flume的conf目录下新建一个配置文件（采集方案）" class="header-anchor">#</a> 在flume的conf目录下新建一个配置文件（采集方案）</h4> <div class="language- extra-class"><pre class="language-text"><code># 定义三大组件名称
ag1.sources  = source1
ag1.channels = channel1
ag1.sinks  = sink1

# 配置 source 组件
ag1.sources.source1.type  = exec
ag1.sources.source1.command = tail -F /root/log/access.log

# channel配置
ag1.channels.channel1.type   = memory
ag1.channels.channel1.capacity = 100 
ag1.channels.channel1.transactionCapacity = 600

# 配置 sink 组件
ag1.sinks.sink1.type  = hdfs
ag1.sinks.sink1.hdfs.path = hdfs://node-00:8020/log/%y-%m-%d/%H-%M
ag1.sinks.sink1.hdfs.filePrefix = app_log
ag1.sinks.sink1.hdfs.fileSuffix = .log
ag1.sinks.sink1.hdfs.batchSize = 100
ag1.sinks.sink1.hdfs.fileType =  DataStream
ag1.sinks.sink1.hdfs.wirteFormat = Text

## roll：滚动切换：控制写文件的切换规则
ag1.sinks.sink1.hdfs.rollSize = 102400
ag1.sinks.sink1.hdfs.rollCount = 10000
ag1.sinks.sink1.hdfs.rollInterval = 60

## 控制生成目录的规则
ag1.sinks.sink1.hdfs.round = true
ag1.sinks.sink1.hdfs.roundValue = 10
ag1.sinks.sink1.hdfs.roundUnit = minute
ag1.sinks.sink1.hdfs.useLocalTimeStamp = true

# 绑定source、channel、sink之间的联系
ag1.sources.source1.channels = channel1
ag1.sinks.sink1.channel      = channel1
</code></pre></div><h4 id="执行结果"><a href="#执行结果" class="header-anchor">#</a> 执行结果</h4> <p><img src="/study/assets/img/flume_demo2_rst.6b51384b.png" alt=""></p> <h3 id="多级-agent-串联"><a href="#多级-agent-串联" class="header-anchor">#</a> 多级 agent 串联</h3> <p><img src="/study/assets/img/flume_demo3.629198ec.png" alt=""></p> <h4 id="step-1-配置-avro-sink-类型-agent"><a href="#step-1-配置-avro-sink-类型-agent" class="header-anchor">#</a> Step 1 配置 avro sink 类型 Agent</h4> <p>从tail命令获取数据发送到avro端口
另一个节点可配置一个avro源来中继数据，发送外部存储</p> <p>采集配置文件，tail-avro.conf</p> <div class="language- extra-class"><pre class="language-text"><code>##################
# Name the components on this agent
a1.sources = r1
a1.sinks = k1
a1.channels = c1

# Describe/configure the source
a1.sources.r1.type = exec
a1.sources.r1.command = tail -F /root/log/access.log


# Describe the sink
a1.sinks.k1.type = avro
a1.sinks.k1.hostname = node-02
a1.sinks.k1.port = 4141
a1.sinks.k1.batch-size = 2


# Use a channel which buffers events in memory
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# Bind the source and sink to the channel
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
</code></pre></div><h4 id="step-2-从avro端口接收数据，下沉到hdfs"><a href="#step-2-从avro端口接收数据，下沉到hdfs" class="header-anchor">#</a> Step 2 从avro端口接收数据，下沉到hdfs</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#bin/flume-ng agent -c conf -f conf/avro-m-log.conf -n a1 -Dflume.root.logger=INFO,console</span>
</code></pre></div><p>采集配置文件，avro-hdfs.conf</p> <div class="language- extra-class"><pre class="language-text"><code># Name the components on this agent
a1.sources = r1
a1.sinks = k1
a1.channels = c1

# Describe/configure the source
##source中的avro组件是一个接收者服务
a1.sources.r1.type = avro
a1.sources.r1.bind = node-02
a1.sources.r1.port = 4141


# Describe the sink
a1.sinks.k1.type = hdfs
a1.sinks.k1.hdfs.path = /flume/taildata/%y-%m-%d/
a1.sinks.k1.hdfs.filePrefix = tail-
a1.sinks.k1.hdfs.round = true
a1.sinks.k1.hdfs.roundValue = 24
a1.sinks.k1.hdfs.roundUnit = hour
a1.sinks.k1.hdfs.rollInterval = 0
a1.sinks.k1.hdfs.rollSize = 0
a1.sinks.k1.hdfs.rollCount = 50
a1.sinks.k1.hdfs.batchSize = 10
a1.sinks.k1.hdfs.useLocalTimeStamp = true
#生成的文件类型，默认是Sequencefile，可用DataStream，则为普通文本
a1.sinks.k1.hdfs.fileType = DataStream

# Use a channel which buffers events in memory
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# Bind the source and sink to the channel
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1

</code></pre></div><h4 id="step-3-发送数据："><a href="#step-3-发送数据：" class="header-anchor">#</a> Step 3 发送数据：</h4> <div class="language- extra-class"><pre class="language-text"><code>$ bin/flume-ng avro-client -H localhost -p 4141 -F /usr/logs/log.10
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/study/大数据/ElasticSearch.html" class="prev">
        ElasticSearch
      </a></span> <span class="next"><a href="/study/大数据/HBase.html">
        HBase
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/study/assets/js/app.1ed1a485.js" defer></script><script src="/study/assets/js/2.0088ba89.js" defer></script><script src="/study/assets/js/5.4c3c36d6.js" defer></script>
  </body>
</html>
